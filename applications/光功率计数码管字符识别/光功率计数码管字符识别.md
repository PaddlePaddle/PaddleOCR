# å…‰åŠŸç‡è®¡æ•°ç ç®¡å­—ç¬¦è¯†åˆ«

æœ¬æ¡ˆä¾‹å°†ä½¿ç”¨OCRæŠ€æœ¯è‡ªåŠ¨è¯†åˆ«å…‰åŠŸç‡è®¡æ˜¾ç¤ºå±æ–‡å­—ï¼Œé€šè¿‡æœ¬ç« æ‚¨å¯ä»¥æŒæ¡ï¼š

- PaddleOCRå¿«é€Ÿä½¿ç”¨
- æ•°æ®åˆæˆæ–¹æ³•
- æ•°æ®æŒ–æ˜æ–¹æ³•
- åŸºäºç°æœ‰æ•°æ®å¾®è°ƒ

## 1. èƒŒæ™¯ä»‹ç»

å…‰åŠŸç‡è®¡ï¼ˆoptical power meter ï¼‰æ˜¯æŒ‡ç”¨äºæµ‹é‡ç»å¯¹å…‰åŠŸç‡æˆ–é€šè¿‡ä¸€æ®µå…‰çº¤çš„å…‰åŠŸç‡ç›¸å¯¹æŸè€—çš„ä»ªå™¨ã€‚åœ¨å…‰çº¤ç³»ç»Ÿä¸­ï¼Œæµ‹é‡å…‰åŠŸç‡æ˜¯æœ€åŸºæœ¬çš„ï¼Œéå¸¸åƒç”µå­å­¦ä¸­çš„ä¸‡ç”¨è¡¨ï¼›åœ¨å…‰çº¤æµ‹é‡ä¸­ï¼Œå…‰åŠŸç‡è®¡æ˜¯é‡è´Ÿè·å¸¸ç”¨è¡¨ã€‚

<img src="https://bkimg.cdn.bcebos.com/pic/a08b87d6277f9e2f999f5e3e1c30e924b899f35a?x-bce-process=image/watermark,image_d2F0ZXIvYmFpa2U5Mg==,g_7,xp_5,yp_5/format,f_auto" width="400">

ç›®å‰å…‰åŠŸç‡è®¡ç¼ºå°‘å°†æ•°æ®ç›´æ¥è¾“å‡ºçš„åŠŸèƒ½ï¼Œéœ€è¦äººå·¥è¯»æ•°ã€‚è¿™ä¸€é¡¹å·¥ä½œå•è°ƒé‡å¤ï¼Œå¦‚æœå¯ä»¥ä½¿ç”¨æœºå™¨æ›¿ä»£äººå·¥ï¼Œå°†èŠ‚çº¦å¤§é‡æˆæœ¬ã€‚é’ˆå¯¹ä¸Šè¿°é—®é¢˜ï¼Œå¸Œæœ›é€šè¿‡æ‘„åƒå¤´æ‹ç…§->æ™ºèƒ½è¯»æ•°çš„æ–¹å¼é«˜æ•ˆåœ°å®Œæˆæ­¤ä»»åŠ¡ã€‚

ä¸ºå®ç°æ™ºèƒ½è¯»æ•°ï¼Œé€šå¸¸ä¼šé‡‡å–æ–‡æœ¬æ£€æµ‹+æ–‡æœ¬è¯†åˆ«çš„æ–¹æ¡ˆï¼š

ç¬¬ä¸€æ­¥ï¼Œä½¿ç”¨æ–‡æœ¬æ£€æµ‹æ¨¡å‹å®šä½å‡ºå…‰åŠŸç‡è®¡ä¸­çš„æ•°å­—éƒ¨åˆ†ï¼›

ç¬¬äºŒæ­¥ï¼Œä½¿ç”¨æ–‡æœ¬è¯†åˆ«æ¨¡å‹è·å¾—å‡†ç¡®çš„æ•°å­—å’Œå•ä½ä¿¡æ¯ã€‚

æœ¬é¡¹ç›®ä¸»è¦ä»‹ç»å¦‚ä½•å®Œæˆç¬¬äºŒæ­¥æ–‡æœ¬è¯†åˆ«éƒ¨åˆ†ï¼ŒåŒ…æ‹¬ï¼šçœŸå®è¯„ä¼°é›†çš„å»ºç«‹ã€è®­ç»ƒæ•°æ®çš„åˆæˆã€åŸºäº PP-OCRv3 å’Œ SVTR_Tiny ä¸¤ä¸ªæ¨¡å‹è¿›è¡Œè®­ç»ƒï¼Œä»¥åŠè¯„ä¼°å’Œæ¨ç†ã€‚

æœ¬é¡¹ç›®éš¾ç‚¹å¦‚ä¸‹ï¼š

- å…‰åŠŸç‡è®¡æ•°ç ç®¡å­—ç¬¦æ•°æ®è¾ƒå°‘ï¼Œéš¾ä»¥è·å–ã€‚
- æ•°ç ç®¡ä¸­å°æ•°ç‚¹å åƒç´ è¾ƒå°‘ï¼Œå®¹æ˜“æ¼è¯†åˆ«ã€‚

é’ˆå¯¹ä»¥ä¸Šé—®é¢˜ï¼Œ æœ¬ä¾‹é€‰ç”¨ PP-OCRv3 å’Œ SVTR_Tiny ä¸¤ä¸ªé«˜ç²¾åº¦æ¨¡å‹è®­ç»ƒï¼ŒåŒæ—¶æä¾›äº†çœŸå®æ•°æ®æŒ–æ˜æ¡ˆä¾‹å’Œæ•°æ®åˆæˆæ¡ˆä¾‹ã€‚åŸºäº PP-OCRv3 æ¨¡å‹ï¼Œåœ¨æ„å»ºçš„çœŸå®è¯„ä¼°é›†ä¸Šç²¾åº¦ä» 52% æå‡è‡³ 72%ï¼ŒSVTR_Tiny æ¨¡å‹ç²¾åº¦å¯è¾¾åˆ° 78.9%ã€‚

aistudioé¡¹ç›®é“¾æ¥: [å…‰åŠŸç‡è®¡æ•°ç ç®¡å­—ç¬¦è¯†åˆ«](https://aistudio.baidu.com/aistudio/projectdetail/4049044?contributionType=1)

## 2. PaddleOCR å¿«é€Ÿä½¿ç”¨

PaddleOCR æ—¨åœ¨æ‰“é€ ä¸€å¥—ä¸°å¯Œã€é¢†å…ˆã€ä¸”å®ç”¨çš„OCRå·¥å…·åº“ï¼ŒåŠ©åŠ›å¼€å‘è€…è®­ç»ƒå‡ºæ›´å¥½çš„æ¨¡å‹ï¼Œå¹¶åº”ç”¨è½åœ°ã€‚

![](https://github.com/PaddlePaddle/PaddleOCR/raw/release/2.5/doc/imgs_results/ch_ppocr_mobile_v2.0/test_add_91.jpg)


å®˜æ–¹æä¾›äº†é€‚ç”¨äºé€šç”¨åœºæ™¯çš„é«˜ç²¾è½»é‡æ¨¡å‹ï¼Œé¦–å…ˆä½¿ç”¨å®˜æ–¹æä¾›çš„ PP-OCRv3 æ¨¡å‹é¢„æµ‹å›¾ç‰‡ï¼ŒéªŒè¯ä¸‹å½“å‰æ¨¡å‹åœ¨å…‰åŠŸç‡è®¡åœºæ™¯ä¸Šçš„æ•ˆæœã€‚

- å‡†å¤‡ç¯å¢ƒ

```
python3 -m pip install -U pip
python3 -m pip install paddleocr
```


- æµ‹è¯•æ•ˆæœ

æµ‹è¯•å›¾ï¼š

![](https://ai-studio-static-online.cdn.bcebos.com/8dca91f016884e16ad9216d416da72ea08190f97d87b4be883f15079b7ebab9a)


```
paddleocr --lang=ch --det=Fase --image_dir=data
```

å¾—åˆ°å¦‚ä¸‹æµ‹è¯•ç»“æœï¼š

```
('.7000', 0.6885431408882141)
```

å‘ç°æ•°å­—è¯†åˆ«è¾ƒå‡†ï¼Œç„¶è€Œå¯¹è´Ÿå·å’Œå°æ•°ç‚¹è¯†åˆ«ä¸å‡†ç¡®ã€‚ ç”±äºPP-OCRv3çš„è®­ç»ƒæ•°æ®å¤§å¤šä¸ºé€šç”¨åœºæ™¯æ•°æ®ï¼Œåœ¨ç‰¹å®šçš„åœºæ™¯ä¸Šæ•ˆæœå¯èƒ½ä¸å¤Ÿå¥½ã€‚å› æ­¤éœ€è¦åŸºäºåœºæ™¯æ•°æ®è¿›è¡Œå¾®è°ƒã€‚

ä¸‹é¢å°±ä¸»è¦ä»‹ç»å¦‚ä½•åœ¨å…‰åŠŸç‡è®¡ï¼ˆæ•°ç ç®¡ï¼‰åœºæ™¯ä¸Šå¾®è°ƒè®­ç»ƒã€‚


## 3. å¼€å§‹è®­ç»ƒ

### 3.1 æ•°æ®å‡†å¤‡

ç‰¹å®šçš„å·¥ä¸šåœºæ™¯å¾€å¾€å¾ˆéš¾è·å–å¼€æºçš„çœŸå®æ•°æ®é›†ï¼Œå…‰åŠŸç‡è®¡ä¹Ÿæ˜¯å¦‚æ­¤ã€‚åœ¨å®é™…å·¥ä¸šåœºæ™¯ä¸­ï¼Œå¯ä»¥é€šè¿‡æ‘„åƒå¤´é‡‡é›†çš„æ–¹æ³•æ”¶é›†å¤§é‡çœŸå®æ•°æ®ï¼Œæœ¬ä¾‹ä¸­é‡ç‚¹ä»‹ç»æ•°æ®åˆæˆæ–¹æ³•å’ŒçœŸå®æ•°æ®æŒ–æ˜æ–¹æ³•ï¼Œå¦‚ä½•åˆ©ç”¨æœ‰é™çš„æ•°æ®ä¼˜åŒ–æ¨¡å‹ç²¾åº¦ã€‚

æ•°æ®é›†åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†ï¼šåˆæˆæ•°æ®ï¼ŒçœŸå®æ•°æ®ï¼Œ å…¶ä¸­åˆæˆæ•°æ®ç”± text_renderer å·¥å…·æ‰¹é‡ç”Ÿæˆå¾—åˆ°ï¼Œ çœŸå®æ•°æ®é€šè¿‡çˆ¬è™«ç­‰æ–¹å¼åœ¨ç™¾åº¦å›¾ç‰‡ä¸­æœç´¢å¹¶ä½¿ç”¨ PPOCRLabel æ ‡æ³¨å¾—åˆ°ã€‚


- åˆæˆæ•°æ®

æœ¬ä¾‹ä¸­æ•°æ®åˆæˆå·¥å…·ä½¿ç”¨çš„æ˜¯ [text_renderer](https://github.com/Sanster/text_renderer)ï¼Œ è¯¥å·¥å…·å¯ä»¥åˆæˆç”¨äºæ–‡æœ¬è¯†åˆ«è®­ç»ƒçš„æ–‡æœ¬è¡Œæ•°æ®:

![](https://github.com/oh-my-ocr/text_renderer/raw/master/example_data/effect_layout_image/char_spacing_compact.jpg)

![](https://github.com/oh-my-ocr/text_renderer/raw/master/example_data/effect_layout_image/color_image.jpg)


```
export https_proxy=http://172.19.57.45:3128
git clone https://github.com/oh-my-ocr/text_renderer
```

```
import os
python3 setup.py develop
python3 -m pip install -r docker/requirements.txt
python3 main.py \
    --config example_data/example.py \
    --dataset img \
    --num_processes 2 \
    --log_period 10
```

ç»™å®šå­—ä½“å’Œè¯­æ–™ï¼Œå°±å¯ä»¥åˆæˆè¾ƒä¸ºä¸°å¯Œæ ·å¼çš„æ–‡æœ¬è¡Œæ•°æ®ã€‚ å…‰åŠŸç‡è®¡è¯†åˆ«åœºæ™¯ï¼Œç›®æ ‡æ˜¯æ­£ç¡®è¯†åˆ«æ•°ç ç®¡æ–‡æœ¬ï¼Œå› æ­¤éœ€è¦æ”¶é›†éƒ¨åˆ†æ•°ç ç®¡å­—ä½“ï¼Œè®­ç»ƒè¯­æ–™ï¼Œç”¨äºåˆæˆæ–‡æœ¬è¯†åˆ«æ•°æ®ã€‚

å°†æ”¶é›†å¥½çš„è¯­æ–™å­˜æ”¾åœ¨ example_data è·¯å¾„ä¸‹ï¼š

```
ln -s ./fonts/DS* text_renderer/example_data/font/
ln -s ./corpus/digital.txt text_renderer/example_data/text/
```

ä¿®æ”¹ text_renderer/example_data/font_list/font_list.txt ,é€‰æ‹©éœ€è¦çš„å­—ä½“å¼€å§‹åˆæˆï¼š

```
python3 main.py \
    --config example_data/digital_example.py \
    --dataset img \
    --num_processes 2 \
    --log_period 10
```

åˆæˆå›¾ç‰‡ä¼šè¢«å­˜åœ¨ç›®å½• text_renderer/example_data/digital/chn_data ä¸‹

æŸ¥çœ‹åˆæˆçš„æ•°æ®æ ·ä¾‹ï¼š

![](https://ai-studio-static-online.cdn.bcebos.com/7d5774a273f84efba5b9ce7fd3f86e9ef24b6473e046444db69fa3ca20ac0986)


- çœŸå®æ•°æ®æŒ–æ˜

æ¨¡å‹è®­ç»ƒéœ€è¦ä½¿ç”¨çœŸå®æ•°æ®ä½œä¸ºè¯„ä»·æŒ‡æ ‡ï¼Œå¦åˆ™å¾ˆå®¹æ˜“è¿‡æ‹Ÿåˆåˆ°ç®€å•çš„åˆæˆæ•°æ®ä¸­ã€‚æ²¡æœ‰å¼€æºæ•°æ®çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥åˆ©ç”¨éƒ¨åˆ†æ— æ ‡æ³¨æ•°æ®+æ ‡æ³¨å·¥å…·è·å¾—çœŸå®æ•°æ®ã€‚


1. æ•°æ®æœé›†

ä½¿ç”¨[çˆ¬è™«å·¥å…·](https://github.com/Joeclinton1/google-images-download.git)è·å¾—æ— æ ‡æ³¨æ•°æ®

2. [PPOCRLabel](https://github.com/PaddlePaddle/PaddleOCR/tree/release/2.5/PPOCRLabel) å®ŒæˆåŠè‡ªåŠ¨æ ‡æ³¨

PPOCRLabelæ˜¯ä¸€æ¬¾é€‚ç”¨äºOCRé¢†åŸŸçš„åŠè‡ªåŠ¨åŒ–å›¾å½¢æ ‡æ³¨å·¥å…·ï¼Œå†…ç½®PP-OCRæ¨¡å‹å¯¹æ•°æ®è‡ªåŠ¨æ ‡æ³¨å’Œé‡æ–°è¯†åˆ«ã€‚ä½¿ç”¨Python3å’ŒPyQT5ç¼–å†™ï¼Œæ”¯æŒçŸ©å½¢æ¡†æ ‡æ³¨ã€è¡¨æ ¼æ ‡æ³¨ã€ä¸è§„åˆ™æ–‡æœ¬æ ‡æ³¨ã€å…³é”®ä¿¡æ¯æ ‡æ³¨æ¨¡å¼ï¼Œå¯¼å‡ºæ ¼å¼å¯ç›´æ¥ç”¨äºPaddleOCRæ£€æµ‹å’Œè¯†åˆ«æ¨¡å‹çš„è®­ç»ƒã€‚

![](https://github.com/PaddlePaddle/PaddleOCR/raw/release/2.5/PPOCRLabel/data/gif/steps_en.gif)


æ”¶é›†å®Œæ•°æ®åå°±å¯ä»¥è¿›è¡Œåˆ†é…äº†ï¼ŒéªŒè¯é›†ä¸­ä¸€èˆ¬éƒ½æ˜¯çœŸå®æ•°æ®ï¼Œè®­ç»ƒé›†ä¸­åŒ…å«åˆæˆæ•°æ®+çœŸå®æ•°æ®ã€‚æœ¬ä¾‹ä¸­æ ‡æ³¨äº†155å¼ å›¾ç‰‡ï¼Œå…¶ä¸­è®­ç»ƒé›†å’ŒéªŒè¯é›†çš„æ•°ç›®ä¸º100å’Œ55ã€‚


æœ€ç»ˆ `data` æ–‡ä»¶å¤¹åº”åŒ…å«ä»¥ä¸‹å‡ éƒ¨åˆ†ï¼š

```
|-data
  |- synth_train.txt
  |- real_train.txt
  |- real_eval.txt
  |- synthetic_data
      |- word_001.png
      |- word_002.jpg
      |- word_003.jpg
      | ...
  |- real_data
      |- word_001.png
      |- word_002.jpg
      |- word_003.jpg
      | ...
  ...
```

### 3.2 æ¨¡å‹é€‰æ‹©

æœ¬æ¡ˆä¾‹æä¾›äº†2ç§æ–‡æœ¬è¯†åˆ«æ¨¡å‹ï¼šPP-OCRv3 è¯†åˆ«æ¨¡å‹ å’Œ SVTR_Tinyï¼š

[PP-OCRv3 è¯†åˆ«æ¨¡å‹](https://github.com/PaddlePaddle/PaddleOCR/blob/release/2.5/doc/doc_ch/PP-OCRv3_introduction.md)ï¼šPP-OCRv3çš„è¯†åˆ«æ¨¡å—æ˜¯åŸºäºæ–‡æœ¬è¯†åˆ«ç®—æ³•SVTRä¼˜åŒ–ã€‚SVTRä¸å†é‡‡ç”¨RNNç»“æ„ï¼Œé€šè¿‡å¼•å…¥Transformersç»“æ„æ›´åŠ æœ‰æ•ˆåœ°æŒ–æ˜æ–‡æœ¬è¡Œå›¾åƒçš„ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œä»è€Œæå‡æ–‡æœ¬è¯†åˆ«èƒ½åŠ›ã€‚å¹¶è¿›è¡Œäº†ä¸€ç³»åˆ—ç»“æ„æ”¹è¿›åŠ é€Ÿæ¨¡å‹é¢„æµ‹ã€‚

[SVTR_Tiny](https://arxiv.org/abs/2205.00159):SVTRæå‡ºäº†ä¸€ç§ç”¨äºåœºæ™¯æ–‡æœ¬è¯†åˆ«çš„å•è§†è§‰æ¨¡å‹ï¼Œè¯¥æ¨¡å‹åœ¨patch-wise image tokenizationæ¡†æ¶å†…ï¼Œå®Œå…¨æ‘’å¼ƒäº†åºåˆ—å»ºæ¨¡ï¼Œåœ¨ç²¾åº¦å…·æœ‰ç«äº‰åŠ›çš„å‰æä¸‹ï¼Œæ¨¡å‹å‚æ•°é‡æ›´å°‘ï¼Œé€Ÿåº¦æ›´å¿«ã€‚

ä»¥ä¸Šä¸¤ä¸ªç­–ç•¥åœ¨è‡ªå»ºä¸­æ–‡æ•°æ®é›†ä¸Šçš„ç²¾åº¦å’Œé€Ÿåº¦å¯¹æ¯”å¦‚ä¸‹ï¼š

| ID | ç­–ç•¥ |  æ¨¡å‹å¤§å° | ç²¾åº¦ | é¢„æµ‹è€—æ—¶ï¼ˆCPU + MKLDNN)|
|-----|-----|--------|----| --- |
| 01 | PP-OCRv2 | 8M | 74.8% | 8.54ms |
| 02 | SVTR_Tiny | 21M | 80.1% | 97ms |
| 03 | SVTR_LCNet(h32) | 12M | 71.9% | 6.6ms |
| 04 | SVTR_LCNet(h48) | 12M | 73.98% | 7.6ms |
| 05 | + GTC | 12M | 75.8% | 7.6ms |
| 06 | + TextConAug | 12M | 76.3% | 7.6ms |
| 07 | + TextRotNet | 12M | 76.9% | 7.6ms |
| 08 | + UDML | 12M | 78.4% | 7.6ms |
| 09 | + UIM | 12M | 79.4% | 7.6ms |


### 3.3 å¼€å§‹è®­ç»ƒ

é¦–å…ˆä¸‹è½½ PaddleOCR ä»£ç åº“

```
git clone -b release/2.5 https://github.com/PaddlePaddle/PaddleOCR.git
```

PaddleOCRæä¾›äº†è®­ç»ƒè„šæœ¬ã€è¯„ä¼°è„šæœ¬å’Œé¢„æµ‹è„šæœ¬ï¼Œæœ¬èŠ‚å°†ä»¥ PP-OCRv3 ä¸­æ–‡è¯†åˆ«æ¨¡å‹ä¸ºä¾‹ï¼š

**Step1ï¼šä¸‹è½½é¢„è®­ç»ƒæ¨¡å‹**

é¦–å…ˆä¸‹è½½ pretrain modelï¼Œæ‚¨å¯ä»¥ä¸‹è½½è®­ç»ƒå¥½çš„æ¨¡å‹åœ¨è‡ªå®šä¹‰æ•°æ®ä¸Šè¿›è¡Œfinetune

```
cd PaddleOCR/
# ä¸‹è½½PP-OCRv3 ä¸­æ–‡é¢„è®­ç»ƒæ¨¡å‹
wget -P ./pretrain_models/ https://paddleocr.bj.bcebos.com/PP-OCRv3/chinese/ch_PP-OCRv3_rec_train.tar
# è§£å‹æ¨¡å‹å‚æ•°
cd pretrain_models
tar -xf ch_PP-OCRv3_rec_train.tar && rm -rf ch_PP-OCRv3_rec_train.tar
```

**Step2ï¼šè‡ªå®šä¹‰å­—å…¸æ–‡ä»¶**

æ¥ä¸‹æ¥éœ€è¦æä¾›ä¸€ä¸ªå­—å…¸ï¼ˆ{word_dict_name}.txtï¼‰ï¼Œä½¿æ¨¡å‹åœ¨è®­ç»ƒæ—¶ï¼Œå¯ä»¥å°†æ‰€æœ‰å‡ºç°çš„å­—ç¬¦æ˜ å°„ä¸ºå­—å…¸çš„ç´¢å¼•ã€‚

å› æ­¤å­—å…¸éœ€è¦åŒ…å«æ‰€æœ‰å¸Œæœ›è¢«æ­£ç¡®è¯†åˆ«çš„å­—ç¬¦ï¼Œ{word_dict_name}.txtéœ€è¦å†™æˆå¦‚ä¸‹æ ¼å¼ï¼Œå¹¶ä»¥ `utf-8` ç¼–ç æ ¼å¼ä¿å­˜ï¼š

```
0
1
2
3
4
5
6
7
8
9
-
.
```

word_dict.txt æ¯è¡Œæœ‰ä¸€ä¸ªå•å­—ï¼Œå°†å­—ç¬¦ä¸æ•°å­—ç´¢å¼•æ˜ å°„åœ¨ä¸€èµ·ï¼Œâ€œ3.14â€ å°†è¢«æ˜ å°„æˆ [3, 11, 1, 4]

* å†…ç½®å­—å…¸

PaddleOCRå†…ç½®äº†ä¸€éƒ¨åˆ†å­—å…¸ï¼Œå¯ä»¥æŒ‰éœ€ä½¿ç”¨ã€‚

`ppocr/utils/ppocr_keys_v1.txt` æ˜¯ä¸€ä¸ªåŒ…å«6623ä¸ªå­—ç¬¦çš„ä¸­æ–‡å­—å…¸

`ppocr/utils/ic15_dict.txt` æ˜¯ä¸€ä¸ªåŒ…å«36ä¸ªå­—ç¬¦çš„è‹±æ–‡å­—å…¸

* è‡ªå®šä¹‰å­—å…¸

å†…ç½®å­—å…¸é¢å‘é€šç”¨åœºæ™¯ï¼Œå…·ä½“çš„å·¥ä¸šåœºæ™¯ä¸­ï¼Œå¯èƒ½éœ€è¦è¯†åˆ«ç‰¹æ®Šå­—ç¬¦ï¼Œæˆ–è€…åªéœ€è¯†åˆ«æŸå‡ ä¸ªå­—ç¬¦ï¼Œæ­¤æ—¶è‡ªå®šä¹‰å­—å…¸ä¼šæ›´æå‡æ¨¡å‹ç²¾åº¦ã€‚ä¾‹å¦‚åœ¨å…‰åŠŸç‡è®¡åœºæ™¯ä¸­ï¼Œéœ€è¦è¯†åˆ«æ•°å­—å’Œå•ä½ã€‚

éå†çœŸå®æ•°æ®æ ‡ç­¾ä¸­çš„å­—ç¬¦ï¼Œåˆ¶ä½œå­—å…¸`digital_dict.txt`å¦‚ä¸‹æ‰€ç¤ºï¼š

```
-
.
0
1
2
3
4
5
6
7
8
9
B
E
F
H
L
N
T
W
d
k
m
n
o
z
```




**Step3ï¼šä¿®æ”¹é…ç½®æ–‡ä»¶**

ä¸ºäº†æ›´å¥½çš„ä½¿ç”¨é¢„è®­ç»ƒæ¨¡å‹ï¼Œè®­ç»ƒæ¨èä½¿ç”¨[ch_PP-OCRv3_rec_distillation.yml](../../configs/rec/PP-OCRv3/ch_PP-OCRv3_rec_distillation.yml)é…ç½®æ–‡ä»¶ï¼Œå¹¶å‚è€ƒä¸‹åˆ—è¯´æ˜ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼š

ä»¥ `ch_PP-OCRv3_rec_distillation.yml` ä¸ºä¾‹ï¼š
```
Global:
  ...
  # æ·»åŠ è‡ªå®šä¹‰å­—å…¸ï¼Œå¦‚ä¿®æ”¹å­—å…¸è¯·å°†è·¯å¾„æŒ‡å‘æ–°å­—å…¸
  character_dict_path: ppocr/utils/dict/digital_dict.txt
  ...
  # è¯†åˆ«ç©ºæ ¼
  use_space_char: True


Optimizer:
  ...
  # æ·»åŠ å­¦ä¹ ç‡è¡°å‡ç­–ç•¥
  lr:
    name: Cosine
    learning_rate: 0.001
  ...

...

Train:
  dataset:
    # æ•°æ®é›†æ ¼å¼ï¼Œæ”¯æŒLMDBDataSetä»¥åŠSimpleDataSet
    name: SimpleDataSet
    # æ•°æ®é›†è·¯å¾„
    data_dir: ./data/
    # è®­ç»ƒé›†æ ‡ç­¾æ–‡ä»¶
    label_file_list:
    - ./train_data/digital_img/digital_train.txt  #11w
    - ./train_data/digital_img/real_train.txt     #100
    - ./train_data/digital_img/dbm_img/dbm.txt    #3w
    ratio_list:
    - 0.3
    - 1.0
    - 1.0
    transforms:
      ...
      - RecResizeImg:
          # ä¿®æ”¹ image_shape ä»¥é€‚åº”é•¿æ–‡æœ¬
          image_shape: [3, 48, 320]
      ...
  loader:
    ...
    # å•å¡è®­ç»ƒçš„batch_size
    batch_size_per_card: 256
    ...

Eval:
  dataset:
    # æ•°æ®é›†æ ¼å¼ï¼Œæ”¯æŒLMDBDataSetä»¥åŠSimpleDataSet
    name: SimpleDataSet
    # æ•°æ®é›†è·¯å¾„
    data_dir: ./data
    # éªŒè¯é›†æ ‡ç­¾æ–‡ä»¶
    label_file_list:
    - ./train_data/digital_img/real_val.txt
    transforms:
      ...
      - RecResizeImg:
          # ä¿®æ”¹ image_shape ä»¥é€‚åº”é•¿æ–‡æœ¬
          image_shape: [3, 48, 320]
      ...
  loader:
    # å•å¡éªŒè¯çš„batch_size
    batch_size_per_card: 256
    ...
```
**æ³¨æ„ï¼Œè®­ç»ƒ/é¢„æµ‹/è¯„ä¼°æ—¶çš„é…ç½®æ–‡ä»¶è¯·åŠ¡å¿…ä¸è®­ç»ƒä¸€è‡´ã€‚**

**Step4ï¼šå¯åŠ¨è®­ç»ƒ**

*å¦‚æœæ‚¨å®‰è£…çš„æ˜¯cpuç‰ˆæœ¬ï¼Œè¯·å°†é…ç½®æ–‡ä»¶ä¸­çš„ `use_gpu` å­—æ®µä¿®æ”¹ä¸ºfalse*

```
# GPUè®­ç»ƒ æ”¯æŒå•å¡ï¼Œå¤šå¡è®­ç»ƒ
# è®­ç»ƒæ•°ç ç®¡æ•°æ® è®­ç»ƒæ—¥å¿—ä¼šè‡ªåŠ¨ä¿å­˜ä¸º "{save_model_dir}" ä¸‹çš„train.log

#å•å¡è®­ç»ƒï¼ˆè®­ç»ƒå‘¨æœŸé•¿ï¼Œä¸å»ºè®®ï¼‰
python3 tools/train.py -c configs/rec/PP-OCRv3/ch_PP-OCRv3_rec_distillation.yml -o Global.pretrained_model=./pretrain_models/ch_PP-OCRv3_rec_train/best_accuracy

#å¤šå¡è®­ç»ƒï¼Œé€šè¿‡--gpuså‚æ•°æŒ‡å®šå¡å·
python3 -m paddle.distributed.launch --gpus '0,1,2,3'  tools/train.py -c configs/rec/PP-OCRv3/ch_PP-OCRv3_rec_distillation.yml -o Global.pretrained_model=./pretrain_models/en_PP-OCRv3_rec_train/best_accuracy
```


PaddleOCRæ”¯æŒè®­ç»ƒå’Œè¯„ä¼°äº¤æ›¿è¿›è¡Œ, å¯ä»¥åœ¨ `configs/rec/PP-OCRv3/ch_PP-OCRv3_rec_distillation.yml` ä¸­ä¿®æ”¹ `eval_batch_step` è®¾ç½®è¯„ä¼°é¢‘ç‡ï¼Œé»˜è®¤æ¯500ä¸ªiterè¯„ä¼°ä¸€æ¬¡ã€‚è¯„ä¼°è¿‡ç¨‹ä¸­é»˜è®¤å°†æœ€ä½³accæ¨¡å‹ï¼Œä¿å­˜ä¸º `output/ch_PP-OCRv3_rec_distill/best_accuracy` ã€‚

å¦‚æœéªŒè¯é›†å¾ˆå¤§ï¼Œæµ‹è¯•å°†ä¼šæ¯”è¾ƒè€—æ—¶ï¼Œå»ºè®®å‡å°‘è¯„ä¼°æ¬¡æ•°ï¼Œæˆ–è®­ç»ƒå®Œå†è¿›è¡Œè¯„ä¼°ã€‚

### SVTR_Tiny è®­ç»ƒ

SVTR_Tiny è®­ç»ƒæ­¥éª¤ä¸ä¸Šé¢ä¸€è‡´ï¼ŒSVTRæ”¯æŒçš„é…ç½®å’Œæ¨¡å‹è®­ç»ƒæƒé‡å¯ä»¥å‚è€ƒ[ç®—æ³•ä»‹ç»æ–‡æ¡£](https://github.com/PaddlePaddle/PaddleOCR/blob/release/2.5/doc/doc_ch/algorithm_rec_svtr.md)

**Step1ï¼šä¸‹è½½é¢„è®­ç»ƒæ¨¡å‹**

```
# ä¸‹è½½ SVTR_Tiny ä¸­æ–‡è¯†åˆ«é¢„è®­ç»ƒæ¨¡å‹å’Œé…ç½®æ–‡ä»¶
wget https://paddleocr.bj.bcebos.com/PP-OCRv3/chinese/rec_svtr_tiny_none_ctc_ch_train.tar
# è§£å‹æ¨¡å‹å‚æ•°
tar -xf rec_svtr_tiny_none_ctc_ch_train.tar && rm -rf rec_svtr_tiny_none_ctc_ch_train.tar
```
**Step2ï¼šè‡ªå®šä¹‰å­—å…¸æ–‡ä»¶**

å­—å…¸ä¾ç„¶ä½¿ç”¨è‡ªå®šä¹‰çš„ digital_dict.txt

**Step3ï¼šä¿®æ”¹é…ç½®æ–‡ä»¶**

é…ç½®æ–‡ä»¶ä¸­å¯¹åº”ä¿®æ”¹å­—å…¸è·¯å¾„å’Œæ•°æ®è·¯å¾„

**Step4ï¼šå¯åŠ¨è®­ç»ƒ**

```
## å•å¡è®­ç»ƒ
python tools/train.py -c rec_svtr_tiny_none_ctc_ch_train/rec_svtr_tiny_6local_6global_stn_ch.yml \
           -o Global.pretrained_model=./rec_svtr_tiny_none_ctc_ch_train/best_accuracy
```

### 3.4 éªŒè¯æ•ˆæœ

å¦‚éœ€è·å–å·²è®­ç»ƒæ¨¡å‹ï¼Œè¯·æ‰«ç å¡«å†™é—®å·ï¼ŒåŠ å…¥PaddleOCRå®˜æ–¹äº¤æµç¾¤è·å–å…¨éƒ¨OCRå‚ç±»æ¨¡å‹ä¸‹è½½é“¾æ¥ã€ã€ŠåŠ¨æ‰‹å­¦OCRã€‹ç”µå­ä¹¦ç­‰å…¨å¥—OCRå­¦ä¹ èµ„æ–™ğŸ
<div align="left">
<img src="https://ai-studio-static-online.cdn.bcebos.com/dd721099bd50478f9d5fb13d8dd00fad69c22d6848244fd3a1d3980d7fefc63e"  width = "150" height = "150" />
</div>
å°†ä¸‹è½½æˆ–è®­ç»ƒå®Œæˆçš„æ¨¡å‹æ”¾ç½®åœ¨å¯¹åº”ç›®å½•ä¸‹å³å¯å®Œæˆæ¨¡å‹æ¨ç†

* æŒ‡æ ‡è¯„ä¼°

è®­ç»ƒä¸­æ¨¡å‹å‚æ•°é»˜è®¤ä¿å­˜åœ¨`Global.save_model_dir`ç›®å½•ä¸‹ã€‚åœ¨è¯„ä¼°æŒ‡æ ‡æ—¶ï¼Œéœ€è¦è®¾ç½®`Global.checkpoints`æŒ‡å‘ä¿å­˜çš„å‚æ•°æ–‡ä»¶ã€‚è¯„ä¼°æ•°æ®é›†å¯ä»¥é€šè¿‡ `configs/rec/PP-OCRv3/ch_PP-OCRv3_rec_distillation.yml`  ä¿®æ”¹Evalä¸­çš„ `label_file_path` è®¾ç½®ã€‚

```
# GPU è¯„ä¼°ï¼Œ Global.checkpoints ä¸ºå¾…æµ‹æƒé‡
python3 -m paddle.distributed.launch --gpus '0' tools/eval.py -c configs/rec/PP-OCRv3/ch_PP-OCRv3_rec_distillation.yml -o Global.checkpoints={path/to/weights}/best_accuracy
```

* æµ‹è¯•è¯†åˆ«æ•ˆæœ

ä½¿ç”¨ PaddleOCR è®­ç»ƒå¥½çš„æ¨¡å‹ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹è„šæœ¬è¿›è¡Œå¿«é€Ÿé¢„æµ‹ã€‚

é»˜è®¤é¢„æµ‹å›¾ç‰‡å­˜å‚¨åœ¨ `infer_img` é‡Œï¼Œé€šè¿‡ `-o Global.checkpoints` åŠ è½½è®­ç»ƒå¥½çš„å‚æ•°æ–‡ä»¶ï¼š

æ ¹æ®é…ç½®æ–‡ä»¶ä¸­è®¾ç½®çš„ `save_model_dir` å’Œ `save_epoch_step` å­—æ®µï¼Œä¼šæœ‰ä»¥ä¸‹å‡ ç§å‚æ•°è¢«ä¿å­˜ä¸‹æ¥ï¼š

```
output/rec/
â”œâ”€â”€ best_accuracy.pdopt  
â”œâ”€â”€ best_accuracy.pdparams  
â”œâ”€â”€ best_accuracy.states  
â”œâ”€â”€ config.yml  
â”œâ”€â”€ iter_epoch_3.pdopt  
â”œâ”€â”€ iter_epoch_3.pdparams  
â”œâ”€â”€ iter_epoch_3.states  
â”œâ”€â”€ latest.pdopt  
â”œâ”€â”€ latest.pdparams  
â”œâ”€â”€ latest.states  
â””â”€â”€ train.log
```

å…¶ä¸­ best_accuracy.* æ˜¯è¯„ä¼°é›†ä¸Šçš„æœ€ä¼˜æ¨¡å‹ï¼›iter_epoch_x.* æ˜¯ä»¥ `save_epoch_step` ä¸ºé—´éš”ä¿å­˜ä¸‹æ¥çš„æ¨¡å‹ï¼›latest.* æ˜¯æœ€åä¸€ä¸ªepochçš„æ¨¡å‹ã€‚

```
# é¢„æµ‹è‹±æ–‡ç»“æœ
python3 tools/infer_rec.py -c configs/rec/PP-OCRv3/ch_PP-OCRv3_rec_distillation.yml -o Global.pretrained_model={path/to/weights}/best_accuracy  Global.infer_img=test_digital.png
```

é¢„æµ‹å›¾ç‰‡ï¼š

![](https://ai-studio-static-online.cdn.bcebos.com/8dca91f016884e16ad9216d416da72ea08190f97d87b4be883f15079b7ebab9a)


å¾—åˆ°è¾“å…¥å›¾åƒçš„é¢„æµ‹ç»“æœï¼š

```
infer_img: test_digital.png
        result: ('-70.00', 0.9998967)
```
