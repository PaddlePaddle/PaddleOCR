# å¤šæ¨¡æ€è¡¨å•è¯†åˆ«
- [å¤šæ¨¡æ€è¡¨å•è¯†åˆ«](#å¤šæ¨¡æ€è¡¨å•è¯†åˆ«)
  - [1 é¡¹ç›®è¯´æ˜](#1-é¡¹ç›®è¯´æ˜)
  - [2 å®‰è£…è¯´æ˜](#2-å®‰è£…è¯´æ˜)
  - [3 æ•°æ®å‡†å¤‡](#3-æ•°æ®å‡†å¤‡)
    - [3.1 ä¸‹è½½å¤„ç†å¥½çš„æ•°æ®é›†](#31-ä¸‹è½½å¤„ç†å¥½çš„æ•°æ®é›†)
    - [3.2 è½¬æ¢ä¸ºPaddleOCRæ£€æµ‹å’Œè¯†åˆ«æ ¼å¼](#32-è½¬æ¢ä¸ºpaddleocræ£€æµ‹å’Œè¯†åˆ«æ ¼å¼)
  - [4 OCR](#4-ocr)
    - [4.1 æ–‡æœ¬æ£€æµ‹](#41-æ–‡æœ¬æ£€æµ‹)
      - [4.1.1 æ–¹æ¡ˆ1ï¼šé¢„è®­ç»ƒæ¨¡å‹](#411-æ–¹æ¡ˆ1é¢„è®­ç»ƒæ¨¡å‹)
      - [4.1.2 æ–¹æ¡ˆ2ï¼šXFUNDæ•°æ®é›†+fine-tune](#412-æ–¹æ¡ˆ2xfundæ•°æ®é›†fine-tune)
    - [4.2 æ–‡æœ¬è¯†åˆ«](#42-æ–‡æœ¬è¯†åˆ«)
      - [4.2.1 æ–¹æ¡ˆ1ï¼šé¢„è®­ç»ƒæ¨¡å‹](#421-æ–¹æ¡ˆ1é¢„è®­ç»ƒæ¨¡å‹)
      - [4.2.2 æ–¹æ¡ˆ2ï¼šXFUNDæ•°æ®é›†+finetune](#422-æ–¹æ¡ˆ2xfundæ•°æ®é›†finetune)
      - [4.2.3 æ–¹æ¡ˆ3ï¼šXFUNDæ•°æ®é›†+finetune+çœŸå®é€šç”¨è¯†åˆ«æ•°æ®](#423-æ–¹æ¡ˆ3xfundæ•°æ®é›†finetuneçœŸå®é€šç”¨è¯†åˆ«æ•°æ®)
  - [5 æ–‡æ¡£è§†è§‰é—®ç­”(DOC-VQA)](#5-æ–‡æ¡£è§†è§‰é—®ç­”doc-vqa)
    - [5.1 SER](#51-ser)
      - [5.1.1 æ¨¡å‹è®­ç»ƒ](#511-æ¨¡å‹è®­ç»ƒ)
      - [5.1.2 æ¨¡å‹è¯„ä¼°](#512-æ¨¡å‹è¯„ä¼°)
      - [5.1.3 æ¨¡å‹é¢„æµ‹](#513-æ¨¡å‹é¢„æµ‹)
    - [5.2 RE](#52-re)
      - [5.2.1 æ¨¡å‹è®­ç»ƒ](#521-æ¨¡å‹è®­ç»ƒ)
      - [5.2.2 æ¨¡å‹è¯„ä¼°](#522-æ¨¡å‹è¯„ä¼°)
      - [5.2.3 æ¨¡å‹é¢„æµ‹](#523-æ¨¡å‹é¢„æµ‹)
  - [6 å¯¼å‡ºExcel](#6-å¯¼å‡ºexcel)
  - [è·å¾—æ¨¡å‹](#è·å¾—æ¨¡å‹)
  - [æ›´å¤šèµ„æº](#æ›´å¤šèµ„æº)
  - [å‚è€ƒé“¾æ¥](#å‚è€ƒé“¾æ¥)

## 1 é¡¹ç›®è¯´æ˜

è®¡ç®—æœºè§†è§‰åœ¨é‡‘èé¢†åŸŸçš„åº”ç”¨è¦†ç›–æ–‡å­—è¯†åˆ«ã€å›¾åƒè¯†åˆ«ã€è§†é¢‘è¯†åˆ«ç­‰ï¼Œå…¶ä¸­æ–‡å­—è¯†åˆ«ï¼ˆOCRï¼‰æ˜¯é‡‘èé¢†åŸŸä¸­çš„æ ¸å¿ƒAIèƒ½åŠ›ï¼Œå…¶åº”ç”¨è¦†ç›–å®¢æˆ·æœåŠ¡ã€é£é™©é˜²æ§ã€è¿è¥ç®¡ç†ç­‰å„é¡¹ä¸šåŠ¡ï¼Œé’ˆå¯¹çš„å¯¹è±¡åŒ…æ‹¬é€šç”¨å¡è¯ç¥¨æ®è¯†åˆ«ï¼ˆé“¶è¡Œå¡ã€èº«ä»½è¯ã€è¥ä¸šæ‰§ç…§ç­‰ï¼‰ã€é€šç”¨æ–‡æœ¬è¡¨æ ¼è¯†åˆ«ï¼ˆå°åˆ·ä½“ã€å¤šè¯­è¨€ã€æ‰‹å†™ä½“ç­‰ï¼‰ä»¥åŠä¸€äº›é‡‘èç‰¹è‰²ç¥¨æ®å‡­è¯ã€‚é€šè¿‡å› æ­¤å¦‚æœèƒ½å¤Ÿåœ¨ç»“æ„åŒ–ä¿¡æ¯æå–æ—¶åŒæ—¶åˆ©ç”¨æ–‡å­—ã€é¡µé¢å¸ƒå±€ç­‰ä¿¡æ¯ï¼Œä¾¿å¯å¢å¼ºä¸åŒç‰ˆå¼ä¸‹çš„æ³›åŒ–æ€§ã€‚

è¡¨å•è¯†åˆ«æ—¨åœ¨è¯†åˆ«å„ç§å…·æœ‰è¡¨æ ¼æ€§è´¨çš„è¯ä»¶ã€æˆ¿äº§è¯ã€è¥ä¸šæ‰§ç…§ã€ä¸ªäººä¿¡æ¯è¡¨ã€å‘ç¥¨ç­‰å…³é”®é”®å€¼å¯¹(å¦‚å§“å-å¼ ä¸‰)ï¼Œå…¶å¹¿æ³›åº”ç”¨äºé“¶è¡Œã€è¯åˆ¸ã€å…¬å¸è´¢åŠ¡ç­‰é¢†åŸŸï¼Œå…·æœ‰å¾ˆé«˜çš„å•†ä¸šä»·å€¼ã€‚æœ¬æ¬¡èŒƒä¾‹é¡¹ç›®å¼€æºäº†å…¨æµç¨‹è¡¨å•è¯†åˆ«æ–¹æ¡ˆï¼Œèƒ½å¤Ÿåœ¨å¤šä¸ªåœºæ™¯å¿«é€Ÿå®ç°è¿ç§»èƒ½åŠ›ã€‚è¡¨å•è¯†åˆ«é€šå¸¸å­˜åœ¨ä»¥ä¸‹éš¾ç‚¹ï¼š

- äººå·¥æ‘˜å½•å·¥ä½œæ•ˆç‡ä½ï¼›
- å›½å†…å¸¸è§è¡¨å•ç‰ˆå¼å¤šï¼›
- ä¼ ç»ŸæŠ€æœ¯æ–¹æ¡ˆæ³›åŒ–æ•ˆæœä¸æ»¡è¶³ã€‚


è¡¨å•è¯†åˆ«åŒ…å«ä¸¤å¤§é˜¶æ®µï¼šOCRé˜¶æ®µå’Œæ–‡æ¡£è§†è§‰é—®ç­”é˜¶æ®µã€‚

å…¶ä¸­ï¼ŒOCRé˜¶æ®µé€‰å–äº†PaddleOCRçš„PP-OCRv2æ¨¡å‹ï¼Œä¸»è¦ç”±æ–‡æœ¬æ£€æµ‹å’Œæ–‡æœ¬è¯†åˆ«ä¸¤ä¸ªæ¨¡å—ç»„æˆã€‚DOC-VQAæ–‡æ¡£è§†è§‰é—®ç­”é˜¶æ®µåŸºäºPaddleNLPè‡ªç„¶è¯­è¨€å¤„ç†ç®—æ³•åº“å®ç°çš„LayoutXLMæ¨¡å‹ï¼Œæ”¯æŒåŸºäºå¤šæ¨¡æ€æ–¹æ³•çš„è¯­ä¹‰å®ä½“è¯†åˆ«(Semantic Entity Recognition, SER)ä»¥åŠå…³ç³»æŠ½å–(Relation Extraction, RE)ä»»åŠ¡ã€‚æœ¬æ¡ˆä¾‹æµç¨‹å¦‚ **å›¾1** æ‰€ç¤ºï¼š

<center><img src='https://ai-studio-static-online.cdn.bcebos.com/9bd844b970f94e5ba0bc0c5799bd819ea9b1861bb306471fabc2d628864d418e'></center>
<center>å›¾1 å¤šæ¨¡æ€è¡¨å•è¯†åˆ«æµç¨‹å›¾</center>

æ³¨ï¼šæ¬¢è¿å†AIStudioé¢†å–å…è´¹ç®—åŠ›ä½“éªŒçº¿ä¸Šå®è®­ï¼Œé¡¹ç›®é“¾æ¥: [å¤šæ¨¡æ€è¡¨å•è¯†åˆ«](https://aistudio.baidu.com/aistudio/projectdetail/3884375?contributionType=1)

## 2 å®‰è£…è¯´æ˜


ä¸‹è½½PaddleOCRæºç ï¼Œä¸Šè¿°AIStudioé¡¹ç›®ä¸­å·²ç»å¸®å¤§å®¶æ‰“åŒ…å¥½çš„PaddleOCR(å·²ç»ä¿®æ”¹å¥½é…ç½®æ–‡ä»¶)ï¼Œæ— éœ€ä¸‹è½½è§£å‹å³å¯ï¼Œåªéœ€å®‰è£…ä¾èµ–ç¯å¢ƒ~


```python
unzip -q PaddleOCR.zip
```


```python
# å¦‚ä»éœ€å®‰è£…orå®‰è£…æ›´æ–°ï¼Œå¯ä»¥æ‰§è¡Œä»¥ä¸‹æ­¥éª¤
# git clone https://github.com/PaddlePaddle/PaddleOCR.git -b dygraph
# git clone https://gitee.com/PaddlePaddle/PaddleOCR
```


```python
# å®‰è£…ä¾èµ–åŒ…
pip install -U pip
pip install -r /home/aistudio/PaddleOCR/requirements.txt
pip install paddleocr

pip install yacs gnureadline paddlenlp==2.2.1
pip install xlsxwriter
```

## 3 æ•°æ®å‡†å¤‡

è¿™é‡Œä½¿ç”¨[XFUNæ•°æ®é›†](https://github.com/doc-analysis/XFUND)åšä¸ºå®éªŒæ•°æ®é›†ã€‚ XFUNæ•°æ®é›†æ˜¯å¾®è½¯æå‡ºçš„ä¸€ä¸ªç”¨äºKIEä»»åŠ¡çš„å¤šè¯­è¨€æ•°æ®é›†ï¼Œå…±åŒ…å«ä¸ƒä¸ªæ•°æ®é›†ï¼Œæ¯ä¸ªæ•°æ®é›†åŒ…å«149å¼ è®­ç»ƒé›†å’Œ50å¼ éªŒè¯é›†

åˆ†åˆ«ä¸ºï¼šZH(ä¸­æ–‡)ã€JA(æ—¥è¯­)ã€ES(è¥¿ç­ç‰™)ã€FR(æ³•è¯­)ã€IT(æ„å¤§åˆ©)ã€DE(å¾·è¯­)ã€PT(è‘¡è„ç‰™)

æœ¬æ¬¡å®éªŒé€‰å–ä¸­æ–‡æ•°æ®é›†ä½œä¸ºæˆ‘ä»¬çš„æ¼”ç¤ºæ•°æ®é›†ã€‚æ³•è¯­æ•°æ®é›†ä½œä¸ºå®è·µè¯¾ç¨‹çš„æ•°æ®é›†ï¼Œæ•°æ®é›†æ ·ä¾‹å›¾å¦‚ **å›¾2** æ‰€ç¤ºã€‚

<center><img src="https://ai-studio-static-online.cdn.bcebos.com/0f84137778cd4ab6899c64109d452290e9c678ccf01744978bc9c0647adbba45" width="1000" ></center>
<center>å›¾2 æ•°æ®é›†æ ·ä¾‹ï¼Œå·¦ä¸­æ–‡ï¼Œå³æ³•è¯­</center>

### 3.1 ä¸‹è½½å¤„ç†å¥½çš„æ•°æ®é›†


å¤„ç†å¥½çš„XFUNDä¸­æ–‡æ•°æ®é›†ä¸‹è½½åœ°å€ï¼š[https://paddleocr.bj.bcebos.com/dataset/XFUND.tar](https://paddleocr.bj.bcebos.com/dataset/XFUND.tar) ,å¯ä»¥è¿è¡Œå¦‚ä¸‹æŒ‡ä»¤å®Œæˆä¸­æ–‡æ•°æ®é›†ä¸‹è½½å’Œè§£å‹ã€‚

<center><img src="https://ai-studio-static-online.cdn.bcebos.com/31e3dbee31d441d2a36d45b5af660e832dfa2f437f4d49a1914312a15b6a29a7"></center>
<center>å›¾3 ä¸‹è½½æ•°æ®é›†</center>


```python
wget https://paddleocr.bj.bcebos.com/dataset/XFUND.tar
tar -xf XFUND.tar

# XFUNå…¶ä»–æ•°æ®é›†ä½¿ç”¨ä¸‹é¢çš„ä»£ç è¿›è¡Œè½¬æ¢
# ä»£ç é“¾æ¥ï¼šhttps://github.com/PaddlePaddle/PaddleOCR/blob/release%2F2.4/ppstructure/vqa/helper/trans_xfun_data.py
# %cd PaddleOCR
# python3 ppstructure/vqa/tools/trans_xfun_data.py --ori_gt_path=path/to/json_path --output_path=path/to/save_path
# %cd ../
```

è¿è¡Œä¸Šè¿°æŒ‡ä»¤ååœ¨ /home/aistudio/PaddleOCR/ppstructure/vqa/XFUND ç›®å½•ä¸‹æœ‰2ä¸ªæ–‡ä»¶å¤¹ï¼Œç›®å½•ç»“æ„å¦‚ä¸‹æ‰€ç¤ºï¼š

```bash
/home/aistudio/PaddleOCR/ppstructure/vqa/XFUND
  â””â”€ zh_train/        		 	è®­ç»ƒé›†
      â”œâ”€â”€ image/				å›¾ç‰‡å­˜æ”¾æ–‡ä»¶å¤¹
      â”œâ”€â”€ xfun_normalize_train.json 	æ ‡æ³¨ä¿¡æ¯
  â””â”€ zh_val/        		 	éªŒè¯é›†
      â”œâ”€â”€ image/			å›¾ç‰‡å­˜æ”¾æ–‡ä»¶å¤¹
      â”œâ”€â”€ xfun_normalize_val.json 	æ ‡æ³¨ä¿¡æ¯

```

è¯¥æ•°æ®é›†çš„æ ‡æ³¨æ ¼å¼ä¸º

```bash
{
    "height": 3508, # å›¾åƒé«˜åº¦
    "width": 2480,  # å›¾åƒå®½åº¦
    "ocr_info": [
        {
            "text": "é‚®æ”¿åœ°å€:",  # å•ä¸ªæ–‡æœ¬å†…å®¹
            "label": "question", # æ–‡æœ¬æ‰€å±ç±»åˆ«
            "bbox": [261, 802, 483, 859], # å•ä¸ªæ–‡æœ¬æ¡†
            "id": 54,  # æ–‡æœ¬ç´¢å¼•
            "linking": [[54, 60]], # å½“å‰æ–‡æœ¬å’Œå…¶ä»–æ–‡æœ¬çš„å…³ç³» [question, answer]
            "words": []
        },
        {
            "text": "æ¹–å—çœæ€€åŒ–å¸‚å¸‚è¾–åŒº",
            "label": "answer",
            "bbox": [487, 810, 862, 859],
            "id": 60,
            "linking": [[54, 60]],
            "words": []
        }
    ]
}
```

### 3.2 è½¬æ¢ä¸ºPaddleOCRæ£€æµ‹å’Œè¯†åˆ«æ ¼å¼

ä½¿ç”¨XFUNDè®­ç»ƒPaddleOCRæ£€æµ‹å’Œè¯†åˆ«æ¨¡å‹ï¼Œéœ€è¦å°†æ•°æ®é›†æ ¼å¼æ”¹ä¸ºè®­ç»ƒéœ€æ±‚çš„æ ¼å¼ã€‚

<center><img src="https://ai-studio-static-online.cdn.bcebos.com/9a709f19e7174725a8cfb09fd922ade74f8e9eb73ae1438596cbb2facef9c24a"></center>
<center>å›¾4 è½¬æ¢ä¸ºOCRæ ¼å¼</center>

- **æ–‡æœ¬æ£€æµ‹** æ ‡æ³¨æ–‡ä»¶æ ¼å¼å¦‚ä¸‹ï¼Œä¸­é—´ç”¨'\t'åˆ†éš”ï¼š

" å›¾åƒæ–‡ä»¶å                    json.dumpsç¼–ç çš„å›¾åƒæ ‡æ³¨ä¿¡æ¯"
ch4_test_images/img_61.jpg    [{"transcription": "MASA", "points": [[310, 104], [416, 141], [418, 216], [312, 179]]}, {...}]

json.dumpsç¼–ç å‰çš„å›¾åƒæ ‡æ³¨ä¿¡æ¯æ˜¯åŒ…å«å¤šä¸ªå­—å…¸çš„listï¼Œå­—å…¸ä¸­çš„ `points` è¡¨ç¤ºæ–‡æœ¬æ¡†çš„å››ä¸ªç‚¹çš„åæ ‡(x, y)ï¼Œä»å·¦ä¸Šè§’çš„ç‚¹å¼€å§‹é¡ºæ—¶é’ˆæ’åˆ—ã€‚ `transcription` è¡¨ç¤ºå½“å‰æ–‡æœ¬æ¡†çš„æ–‡å­—ï¼Œ***å½“å…¶å†…å®¹ä¸ºâ€œ###â€æ—¶ï¼Œè¡¨ç¤ºè¯¥æ–‡æœ¬æ¡†æ— æ•ˆï¼Œåœ¨è®­ç»ƒæ—¶ä¼šè·³è¿‡ã€‚***

- **æ–‡æœ¬è¯†åˆ«** æ ‡æ³¨æ–‡ä»¶çš„æ ¼å¼å¦‚ä¸‹ï¼Œ txtæ–‡ä»¶ä¸­é»˜è®¤è¯·å°†å›¾ç‰‡è·¯å¾„å’Œå›¾ç‰‡æ ‡ç­¾ç”¨'\t'åˆ†å‰²ï¼Œå¦‚ç”¨å…¶ä»–æ–¹å¼åˆ†å‰²å°†é€ æˆè®­ç»ƒæŠ¥é”™ã€‚

```
" å›¾åƒæ–‡ä»¶å                 å›¾åƒæ ‡æ³¨ä¿¡æ¯ "

train_data/rec/train/word_001.jpg   ç®€å•å¯ä¾èµ–
train_data/rec/train/word_002.jpg   ç”¨ç§‘æŠ€è®©å¤æ‚çš„ä¸–ç•Œæ›´ç®€å•
...
```




```python
unzip -q /home/aistudio/data/data140302/XFUND_ori.zip -d /home/aistudio/data/data140302/
```

å·²ç»æä¾›è½¬æ¢è„šæœ¬ï¼Œæ‰§è¡Œå¦‚ä¸‹ä»£ç å³å¯è½¬æ¢æˆåŠŸï¼š


```python
%cd /home/aistudio/
python trans_xfund_data.py
```

## 4 OCR

é€‰ç”¨é£æ¡¨OCRå¼€å‘å¥—ä»¶[PaddleOCR](https://github.com/PaddlePaddle/PaddleOCR/blob/dygraph/README_ch.md)ä¸­çš„PP-OCRv2æ¨¡å‹è¿›è¡Œæ–‡æœ¬æ£€æµ‹å’Œè¯†åˆ«ã€‚PP-OCRv2åœ¨PP-OCRçš„åŸºç¡€ä¸Šï¼Œè¿›ä¸€æ­¥åœ¨5ä¸ªæ–¹é¢é‡ç‚¹ä¼˜åŒ–ï¼Œæ£€æµ‹æ¨¡å‹é‡‡ç”¨CMLååŒäº’å­¦ä¹ çŸ¥è¯†è’¸é¦ç­–ç•¥å’ŒCopyPasteæ•°æ®å¢å¹¿ç­–ç•¥ï¼›è¯†åˆ«æ¨¡å‹é‡‡ç”¨LCNetè½»é‡çº§éª¨å¹²ç½‘ç»œã€UDML æ”¹è¿›çŸ¥è¯†è’¸é¦ç­–ç•¥å’Œ[Enhanced CTC loss](https://github.com/PaddlePaddle/PaddleOCR/blob/dygraph/doc/doc_ch/enhanced_ctc_loss.md)æŸå¤±å‡½æ•°æ”¹è¿›ï¼Œè¿›ä¸€æ­¥åœ¨æ¨ç†é€Ÿåº¦å’Œé¢„æµ‹æ•ˆæœä¸Šå–å¾—æ˜æ˜¾æå‡ã€‚æ›´å¤šç»†èŠ‚è¯·å‚è€ƒPP-OCRv2[æŠ€æœ¯æŠ¥å‘Š](https://arxiv.org/abs/2109.03144)ã€‚

### 4.1 æ–‡æœ¬æ£€æµ‹

æˆ‘ä»¬ä½¿ç”¨2ç§æ–¹æ¡ˆè¿›è¡Œè®­ç»ƒã€è¯„ä¼°ï¼š
-  **PP-OCRv2ä¸­è‹±æ–‡è¶…è½»é‡æ£€æµ‹é¢„è®­ç»ƒæ¨¡å‹**
-  **XFUNDæ•°æ®é›†+fine-tune**

#### 4.1.1 æ–¹æ¡ˆ1ï¼šé¢„è®­ç»ƒæ¨¡å‹

**1ï¼‰ä¸‹è½½é¢„è®­ç»ƒæ¨¡å‹**

<center><img src="https://ai-studio-static-online.cdn.bcebos.com/2aff41ee8fce4e9bac8295cc00720217bde2aeee7ee7473689848bed0b6fde05"></center>
<center>å›¾5 æ–‡æœ¬æ£€æµ‹æ–¹æ¡ˆ1-ä¸‹è½½é¢„è®­ç»ƒæ¨¡å‹</center>


PaddleOCRå·²ç»æä¾›äº†PP-OCRç³»åˆ—æ¨¡å‹ï¼Œéƒ¨åˆ†æ¨¡å‹å±•ç¤ºå¦‚ä¸‹è¡¨æ‰€ç¤ºï¼š

| æ¨¡å‹ç®€ä»‹                              | æ¨¡å‹åç§°                | æ¨èåœºæ™¯        | æ£€æµ‹æ¨¡å‹                                                     | æ–¹å‘åˆ†ç±»å™¨                                                   | è¯†åˆ«æ¨¡å‹                                                     |
| ------------------------------------- | ----------------------- | --------------- | ------------------------------------------------------------ | ------------------------------------------------------------ | ------------------------------------------------------------ |
| ä¸­è‹±æ–‡è¶…è½»é‡PP-OCRv2æ¨¡å‹ï¼ˆ13.0Mï¼‰     | ch_PP-OCRv2_xx          | ç§»åŠ¨ç«¯&æœåŠ¡å™¨ç«¯ | [æ¨ç†æ¨¡å‹](https://paddleocr.bj.bcebos.com/PP-OCRv2/chinese/ch_PP-OCRv2_det_infer.tar) / [è®­ç»ƒæ¨¡å‹](https://paddleocr.bj.bcebos.com/PP-OCRv2/chinese/ch_PP-OCRv2_det_distill_train.tar) | [æ¨ç†æ¨¡å‹](https://paddleocr.bj.bcebos.com/dygraph_v2.0/ch/ch_ppocr_mobile_v2.0_cls_infer.tar) / [é¢„è®­ç»ƒæ¨¡å‹](https://paddleocr.bj.bcebos.com/dygraph_v2.0/ch/ch_ppocr_mobile_v2.0_cls_train.tar) | [æ¨ç†æ¨¡å‹](https://paddleocr.bj.bcebos.com/PP-OCRv2/chinese/ch_PP-OCRv2_rec_infer.tar) / [è®­ç»ƒæ¨¡å‹](https://paddleocr.bj.bcebos.com/PP-OCRv2/chinese/ch_PP-OCRv2_rec_train.tar) |
| ä¸­è‹±æ–‡è¶…è½»é‡PP-OCR mobileæ¨¡å‹ï¼ˆ9.4Mï¼‰ | ch_ppocr_mobile_v2.0_xx | ç§»åŠ¨ç«¯&æœåŠ¡å™¨ç«¯ | [æ¨ç†æ¨¡å‹](https://paddleocr.bj.bcebos.com/dygraph_v2.0/ch/ch_ppocr_mobile_v2.0_det_infer.tar) / [é¢„è®­ç»ƒæ¨¡å‹](https://paddleocr.bj.bcebos.com/dygraph_v2.0/ch/ch_ppocr_mobile_v2.0_det_train.tar) | [æ¨ç†æ¨¡å‹](https://paddleocr.bj.bcebos.com/dygraph_v2.0/ch/ch_ppocr_mobile_v2.0_cls_infer.tar) / [é¢„è®­ç»ƒæ¨¡å‹](https://paddleocr.bj.bcebos.com/dygraph_v2.0/ch/ch_ppocr_mobile_v2.0_cls_train.tar) | [æ¨ç†æ¨¡å‹](https://paddleocr.bj.bcebos.com/dygraph_v2.0/ch/ch_ppocr_mobile_v2.0_rec_infer.tar) / [é¢„è®­ç»ƒæ¨¡å‹](https://paddleocr.bj.bcebos.com/dygraph_v2.0/ch/ch_ppocr_mobile_v2.0_rec_pre.tar) |
| ä¸­è‹±æ–‡é€šç”¨PP-OCR serveræ¨¡å‹ï¼ˆ143.4Mï¼‰ | ch_ppocr_server_v2.0_xx | æœåŠ¡å™¨ç«¯        | [æ¨ç†æ¨¡å‹](https://paddleocr.bj.bcebos.com/dygraph_v2.0/ch/ch_ppocr_server_v2.0_det_infer.tar) / [é¢„è®­ç»ƒæ¨¡å‹](https://paddleocr.bj.bcebos.com/dygraph_v2.0/ch/ch_ppocr_server_v2.0_det_train.tar) | [æ¨ç†æ¨¡å‹](https://paddleocr.bj.bcebos.com/dygraph_v2.0/ch/ch_ppocr_mobile_v2.0_cls_infer.tar) / [é¢„è®­ç»ƒæ¨¡å‹](https://paddleocr.bj.bcebos.com/dygraph_v2.0/ch/ch_ppocr_mobile_v2.0_cls_train.tar) | [æ¨ç†æ¨¡å‹](https://paddleocr.bj.bcebos.com/dygraph_v2.0/ch/ch_ppocr_server_v2.0_rec_infer.tar) / [é¢„è®­ç»ƒæ¨¡å‹](https://paddleocr.bj.bcebos.com/dygraph_v2.0/ch/ch_ppocr_server_v2.0_rec_pre.tar) |

æ›´å¤šæ¨¡å‹ä¸‹è½½ï¼ˆåŒ…æ‹¬å¤šè¯­è¨€ï¼‰ï¼Œå¯ä»¥å‚è€ƒ[PP-OCR ç³»åˆ—æ¨¡å‹ä¸‹è½½](./doc/doc_ch/models_list.md)


è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨PP-OCRv2ä¸­è‹±æ–‡è¶…è½»é‡æ£€æµ‹æ¨¡å‹ï¼Œä¸‹è½½å¹¶è§£å‹é¢„è®­ç»ƒæ¨¡å‹ï¼š




```python
%cd /home/aistudio/PaddleOCR/pretrain/
wget https://paddleocr.bj.bcebos.com/PP-OCRv2/chinese/ch_PP-OCRv2_det_distill_train.tar
tar -xf ch_PP-OCRv2_det_distill_train.tar && rm -rf ch_PP-OCRv2_det_distill_train.tar
% cd ..
```

**2ï¼‰æ¨¡å‹è¯„ä¼°** 

<center><img src="https://ai-studio-static-online.cdn.bcebos.com/75b0e977dfb74a83851f8828460759f337b1b7a0c33c47a08a30f3570e1e2e74"></center>
<center>å›¾6 æ–‡æœ¬æ£€æµ‹æ–¹æ¡ˆ1-æ¨¡å‹è¯„ä¼°</center>

æ¥ç€ä½¿ç”¨ä¸‹è½½çš„è¶…è½»é‡æ£€æµ‹æ¨¡å‹åœ¨XFUNDéªŒè¯é›†ä¸Šè¿›è¡Œè¯„ä¼°ï¼Œç”±äºè’¸é¦éœ€è¦åŒ…å«å¤šä¸ªç½‘ç»œï¼Œç”šè‡³å¤šä¸ªStudentç½‘ç»œï¼Œåœ¨è®¡ç®—æŒ‡æ ‡çš„æ—¶å€™åªéœ€è¦è®¡ç®—ä¸€ä¸ªStudentç½‘ç»œçš„æŒ‡æ ‡å³å¯ï¼Œkeyå­—æ®µè®¾ç½®ä¸ºStudentåˆ™è¡¨ç¤ºåªè®¡ç®—Studentç½‘ç»œçš„ç²¾åº¦ã€‚

```
Metric:
  name: DistillationMetric
  base_metric_name: DetMetric
  main_indicator: hmean
  key: "Student"
```
é¦–å…ˆä¿®æ”¹é…ç½®æ–‡ä»¶`configs/det/ch_PP-OCRv2/ch_PP-OCRv2_det_distill.yml`ä¸­çš„ä»¥ä¸‹å­—æ®µï¼š
```
Eval.dataset.data_dirï¼šæŒ‡å‘éªŒè¯é›†å›¾ç‰‡å­˜æ”¾ç›®å½•
Eval.dataset.label_file_listï¼šæŒ‡å‘éªŒè¯é›†æ ‡æ³¨æ–‡ä»¶
```


ç„¶ååœ¨XFUNDéªŒè¯é›†ä¸Šè¿›è¡Œè¯„ä¼°ï¼Œå…·ä½“ä»£ç å¦‚ä¸‹ï¼š


```python
%cd /home/aistudio/PaddleOCR
python tools/eval.py \
    -c configs/det/ch_PP-OCRv2/ch_PP-OCRv2_det_distill.yml \
    -o Global.checkpoints="./pretrain_models/ch_PP-OCRv2_det_distill_train/best_accuracy"
```

ä½¿ç”¨é¢„è®­ç»ƒæ¨¡å‹è¿›è¡Œè¯„ä¼°ï¼ŒæŒ‡æ ‡å¦‚ä¸‹æ‰€ç¤ºï¼š

| æ–¹æ¡ˆ | hmeans |
| -------- | -------- |
| PP-OCRv2ä¸­è‹±æ–‡è¶…è½»é‡æ£€æµ‹é¢„è®­ç»ƒæ¨¡å‹     | 77.26%     |

ä½¿ç”¨æ–‡æœ¬æ£€æµ‹é¢„è®­ç»ƒæ¨¡å‹åœ¨XFUNDéªŒè¯é›†ä¸Šè¯„ä¼°ï¼Œè¾¾åˆ°77%å·¦å³ï¼Œå……åˆ†è¯´æ˜ppocræä¾›çš„é¢„è®­ç»ƒæ¨¡å‹å…·æœ‰æ³›åŒ–èƒ½åŠ›ã€‚

#### 4.1.2 æ–¹æ¡ˆ2ï¼šXFUNDæ•°æ®é›†+fine-tune

PaddleOCRæä¾›çš„è’¸é¦é¢„è®­ç»ƒæ¨¡å‹åŒ…å«äº†å¤šä¸ªæ¨¡å‹çš„å‚æ•°ï¼Œæˆ‘ä»¬æå–Studentæ¨¡å‹çš„å‚æ•°ï¼Œåœ¨XFUNDæ•°æ®é›†ä¸Šè¿›è¡Œfinetuneï¼Œå¯ä»¥å‚è€ƒå¦‚ä¸‹ä»£ç ï¼š

```python
import paddle
# åŠ è½½é¢„è®­ç»ƒæ¨¡å‹
all_params = paddle.load("pretrain/ch_PP-OCRv2_det_distill_train/best_accuracy.pdparams")
# æŸ¥çœ‹æƒé‡å‚æ•°çš„keys
# print(all_params.keys())
# å­¦ç”Ÿæ¨¡å‹çš„æƒé‡æå–
s_params = {key[len("student_model."):]: all_params[key] for key in all_params if "student_model." in key}
# æŸ¥çœ‹å­¦ç”Ÿæ¨¡å‹æƒé‡å‚æ•°çš„keys
print(s_params.keys())
# ä¿å­˜
paddle.save(s_params, "pretrain/ch_PP-OCRv2_det_distill_train/student.pdparams")
```

**1)æ¨¡å‹è®­ç»ƒ**

<center><img src="https://ai-studio-static-online.cdn.bcebos.com/560c44b8dd604da7987bd25da0a882156ffcfb7f6bcb44108fe9bde77512e572"></center>
<center>å›¾7 æ–‡æœ¬æ£€æµ‹æ–¹æ¡ˆ2-æ¨¡å‹è®­ç»ƒ</center>


ä¿®æ”¹é…ç½®æ–‡ä»¶`configs/det/ch_PP-OCRv2_det_student.yml`ä¸­çš„ä»¥ä¸‹å­—æ®µï¼š
```
Global.pretrained_modelï¼šæŒ‡å‘é¢„è®­ç»ƒæ¨¡å‹è·¯å¾„
Train.dataset.data_dirï¼šæŒ‡å‘è®­ç»ƒé›†å›¾ç‰‡å­˜æ”¾ç›®å½•
Train.dataset.label_file_listï¼šæŒ‡å‘è®­ç»ƒé›†æ ‡æ³¨æ–‡ä»¶
Eval.dataset.data_dirï¼šæŒ‡å‘éªŒè¯é›†å›¾ç‰‡å­˜æ”¾ç›®å½•
Eval.dataset.label_file_listï¼šæŒ‡å‘éªŒè¯é›†æ ‡æ³¨æ–‡ä»¶
Optimizer.lr.learning_rateï¼šè°ƒæ•´å­¦ä¹ ç‡ï¼Œæœ¬å®éªŒè®¾ç½®ä¸º0.005
Train.dataset.transforms.EastRandomCropData.sizeï¼šè®­ç»ƒå°ºå¯¸æ”¹ä¸º[1600, 1600]
Eval.dataset.transforms.DetResizeForTestï¼šè¯„ä¼°å°ºå¯¸ï¼Œæ·»åŠ å¦‚ä¸‹å‚æ•°
       limit_side_len: 1600
       limit_type: 'min'

```
æ‰§è¡Œä¸‹é¢å‘½ä»¤å¯åŠ¨è®­ç»ƒï¼š


```python
CUDA_VISIBLE_DEVICES=0 python tools/train.py \
        -c configs/det/ch_PP-OCRv2/ch_PP-OCRv2_det_student.yml
```

**2ï¼‰æ¨¡å‹è¯„ä¼°** 

<center><img src="https://ai-studio-static-online.cdn.bcebos.com/5a75137c5f924dfeb6956b5818812298cc3dc7992ac84954b4175be9adf83c77"></center>
<center>å›¾8 æ–‡æœ¬æ£€æµ‹æ–¹æ¡ˆ2-æ¨¡å‹è¯„ä¼°</center>

ä½¿ç”¨è®­ç»ƒå¥½çš„æ¨¡å‹è¿›è¡Œè¯„ä¼°ï¼Œæ›´æ–°æ¨¡å‹è·¯å¾„`Global.checkpoints`ã€‚å¦‚éœ€è·å–å·²è®­ç»ƒæ¨¡å‹ï¼Œè¯·æ‰«ç å¡«å†™é—®å·ï¼ŒåŠ å…¥PaddleOCRå®˜æ–¹äº¤æµç¾¤è·å–å…¨éƒ¨OCRå‚ç±»æ¨¡å‹ä¸‹è½½é“¾æ¥ã€ã€ŠåŠ¨æ‰‹å­¦OCRã€‹ç”µå­ä¹¦ç­‰å…¨å¥—OCRå­¦ä¹ èµ„æ–™ğŸ

<div align="left">
<img src="https://ai-studio-static-online.cdn.bcebos.com/dd721099bd50478f9d5fb13d8dd00fad69c22d6848244fd3a1d3980d7fefc63e"  width = "150" height = "150" />
</div>

å°†ä¸‹è½½æˆ–è®­ç»ƒå®Œæˆçš„æ¨¡å‹æ”¾ç½®åœ¨å¯¹åº”ç›®å½•ä¸‹å³å¯å®Œæˆæ¨¡å‹è¯„ä¼°


```python
%cd /home/aistudio/PaddleOCR/
python tools/eval.py \
    -c configs/det/ch_PP-OCRv2/ch_PP-OCRv2_det_student.yml \
    -o Global.checkpoints="pretrain/ch_db_mv3-student1600-finetune/best_accuracy"
```

åŒæ—¶æˆ‘ä»¬æä¾›äº†æœªfinetuençš„æ¨¡å‹ï¼Œé…ç½®æ–‡ä»¶å‚æ•°(`pretrained_model`è®¾ç½®ä¸ºç©ºï¼Œ`learning_rate` è®¾ç½®ä¸º0.001)


```python
%cd /home/aistudio/PaddleOCR/
python tools/eval.py \
    -c configs/det/ch_PP-OCRv2/ch_PP-OCRv2_det_student.yml \
    -o Global.checkpoints="pretrain/ch_db_mv3-student1600/best_accuracy"
```

ä½¿ç”¨è®­ç»ƒå¥½çš„æ¨¡å‹è¿›è¡Œè¯„ä¼°ï¼ŒæŒ‡æ ‡å¦‚ä¸‹æ‰€ç¤ºï¼š

| æ–¹æ¡ˆ | hmeans |
| -------- | -------- |
| XFUNDæ•°æ®é›†     | 79.27%     |
| XFUNDæ•°æ®é›†+fine-tune    | 85.24%     |

å¯¹æ¯”ä»…ä½¿ç”¨XFUNDæ•°æ®é›†è®­ç»ƒçš„æ¨¡å‹ï¼Œä½¿ç”¨XFUNDæ•°æ®é›†+finetuneè®­ç»ƒï¼Œåœ¨éªŒè¯é›†ä¸Šè¯„ä¼°è¾¾åˆ°85%å·¦å³ï¼Œè¯´æ˜Â finetuneä¼šæå‡å‚ç±»åœºæ™¯æ•ˆæœã€‚

**3ï¼‰å¯¼å‡ºæ¨¡å‹**

<center><img src="https://ai-studio-static-online.cdn.bcebos.com/07c3b060c54e4b00be7de8d41a8a4696ff53835343cc4981aab0555183306e79"></center>
<center>å›¾9 æ–‡æœ¬æ£€æµ‹æ–¹æ¡ˆ2-æ¨¡å‹å¯¼å‡º</center>

åœ¨æ¨¡å‹è®­ç»ƒè¿‡ç¨‹ä¸­ä¿å­˜çš„æ¨¡å‹æ–‡ä»¶æ˜¯åŒ…å«å‰å‘é¢„æµ‹å’Œåå‘ä¼ æ’­çš„è¿‡ç¨‹ï¼Œåœ¨å®é™…çš„å·¥ä¸šéƒ¨ç½²åˆ™ä¸éœ€è¦åå‘ä¼ æ’­ï¼Œå› æ­¤éœ€è¦å°†æ¨¡å‹è¿›è¡Œå¯¼æˆéƒ¨ç½²éœ€è¦çš„æ¨¡å‹æ ¼å¼ã€‚ æ‰§è¡Œä¸‹é¢å‘½ä»¤ï¼Œå³å¯å¯¼å‡ºæ¨¡å‹ã€‚


```python
# åŠ è½½é…ç½®æ–‡ä»¶`ch_PP-OCRv2_det_student.yml`ï¼Œä»`pretrain/ch_db_mv3-student1600-finetune`ç›®å½•ä¸‹åŠ è½½`best_accuracy`æ¨¡å‹
# inferenceæ¨¡å‹ä¿å­˜åœ¨`./output/det_db_inference`ç›®å½•ä¸‹
%cd /home/aistudio/PaddleOCR/
python tools/export_model.py \
    -c configs/det/ch_PP-OCRv2/ch_PP-OCRv2_det_student.yml \
    -o Global.pretrained_model="pretrain/ch_db_mv3-student1600-finetune/best_accuracy" \
    Global.save_inference_dir="./output/det_db_inference/"
```

è½¬æ¢æˆåŠŸåï¼Œåœ¨ç›®å½•ä¸‹æœ‰ä¸‰ä¸ªæ–‡ä»¶ï¼š
```
/inference/rec_crnn/
    â”œâ”€â”€ inference.pdiparams         # è¯†åˆ«inferenceæ¨¡å‹çš„å‚æ•°æ–‡ä»¶
    â”œâ”€â”€ inference.pdiparams.info    # è¯†åˆ«inferenceæ¨¡å‹çš„å‚æ•°ä¿¡æ¯ï¼Œå¯å¿½ç•¥
    â””â”€â”€ inference.pdmodel           # è¯†åˆ«inferenceæ¨¡å‹çš„programæ–‡ä»¶
```

**4ï¼‰æ¨¡å‹é¢„æµ‹**

<center><img src="https://ai-studio-static-online.cdn.bcebos.com/0d582de9aa46474791e08654f84a614a6510e98bfe5f4ad3a26501cbf49ec151"></center>
<center>å›¾10 æ–‡æœ¬æ£€æµ‹æ–¹æ¡ˆ2-æ¨¡å‹é¢„æµ‹</center>

åŠ è½½ä¸Šé¢å¯¼å‡ºçš„æ¨¡å‹ï¼Œæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤å¯¹éªŒè¯é›†æˆ–æµ‹è¯•é›†å›¾ç‰‡è¿›è¡Œé¢„æµ‹ï¼š

```
det_model_dirï¼šé¢„æµ‹æ¨¡å‹
image_dirï¼šæµ‹è¯•å›¾ç‰‡è·¯å¾„
use_gpuï¼šæ˜¯å¦ä½¿ç”¨GPU
```

æ£€æµ‹å¯è§†åŒ–ç»“æœä¿å­˜åœ¨`/home/aistudio/inference_results/`ç›®å½•ä¸‹ï¼ŒæŸ¥çœ‹æ£€æµ‹æ•ˆæœã€‚


```python
%pwd
!python tools/infer/predict_det.py \
    --det_algorithm="DB" \
    --det_model_dir="./output/det_db_inference/" \
    --image_dir="./doc/vqa/input/zh_val_21.jpg" \
    --use_gpu=True
```

æ€»ç»“ï¼Œæˆ‘ä»¬åˆ†åˆ«ä½¿ç”¨PP-OCRv2ä¸­è‹±æ–‡è¶…è½»é‡æ£€æµ‹é¢„è®­ç»ƒæ¨¡å‹ã€XFUNDæ•°æ®é›†+finetune2ç§æ–¹æ¡ˆè¿›è¡Œè¯„ä¼°ã€è®­ç»ƒç­‰ï¼ŒæŒ‡æ ‡å¯¹æ¯”å¦‚ä¸‹ï¼š

| æ–¹æ¡ˆ | hmeans | ç»“æœåˆ†æ |
| -------- | -------- | -------- |
| PP-OCRv2ä¸­è‹±æ–‡è¶…è½»é‡æ£€æµ‹é¢„è®­ç»ƒæ¨¡å‹     | 77.26%     | ppocræä¾›çš„é¢„è®­ç»ƒæ¨¡å‹æœ‰æ³›åŒ–èƒ½åŠ›     |
| XFUNDæ•°æ®é›†     | 79.27%     |     |
| XFUNDæ•°æ®é›†+finetune     | 85.24%     | finetuneä¼šæå‡å‚ç±»åœºæ™¯æ•ˆæœ    |

### 4.2 æ–‡æœ¬è¯†åˆ«

æˆ‘ä»¬åˆ†åˆ«ä½¿ç”¨å¦‚ä¸‹3ç§æ–¹æ¡ˆè¿›è¡Œè®­ç»ƒã€è¯„ä¼°ï¼š

- PP-OCRv2ä¸­è‹±æ–‡è¶…è½»é‡è¯†åˆ«é¢„è®­ç»ƒæ¨¡å‹
- XFUNDæ•°æ®é›†+fine-tune
- XFUNDæ•°æ®é›†+fine-tune+çœŸå®é€šç”¨è¯†åˆ«æ•°æ®

#### 4.2.1 æ–¹æ¡ˆ1ï¼šé¢„è®­ç»ƒæ¨¡å‹

**1ï¼‰ä¸‹è½½é¢„è®­ç»ƒæ¨¡å‹**

<center><img src="https://ai-studio-static-online.cdn.bcebos.com/b7230e9964074181837e1132029f9da8178bf564ac5c43a9a93a30e975c0d8b4"></center>

<center>å›¾11 æ–‡æœ¬è¯†åˆ«æ–¹æ¡ˆ1-ä¸‹è½½é¢„è®­ç»ƒæ¨¡å‹</center>

æˆ‘ä»¬ä½¿ç”¨PP-OCRv2ä¸­è‹±æ–‡è¶…è½»é‡æ–‡æœ¬è¯†åˆ«æ¨¡å‹ï¼Œä¸‹è½½å¹¶è§£å‹é¢„è®­ç»ƒæ¨¡å‹ï¼š


```python
%cd /home/aistudio/PaddleOCR/pretrain/
wget https://paddleocr.bj.bcebos.com/PP-OCRv2/chinese/ch_PP-OCRv2_rec_train.tar
tar -xf ch_PP-OCRv2_rec_train.tar && rm -rf ch_PP-OCRv2_rec_train.tar
% cd ..
```

**2ï¼‰æ¨¡å‹è¯„ä¼°**

<center><img src="https://ai-studio-static-online.cdn.bcebos.com/166ce56d634c4c7589fe68fbc6e7ae663305dcc82ba144c781507341ffae7fe8"></center>

<center>å›¾12 æ–‡æœ¬è¯†åˆ«æ–¹æ¡ˆ1-æ¨¡å‹è¯„ä¼°</center>

é¦–å…ˆä¿®æ”¹é…ç½®æ–‡ä»¶`configs/det/ch_PP-OCRv2/ch_PP-OCRv2_rec_distillation.yml`ä¸­çš„ä»¥ä¸‹å­—æ®µï¼š

```
Eval.dataset.data_dirï¼šæŒ‡å‘éªŒè¯é›†å›¾ç‰‡å­˜æ”¾ç›®å½•
Eval.dataset.label_file_listï¼šæŒ‡å‘éªŒè¯é›†æ ‡æ³¨æ–‡ä»¶
```

æˆ‘ä»¬ä½¿ç”¨ä¸‹è½½çš„é¢„è®­ç»ƒæ¨¡å‹è¿›è¡Œè¯„ä¼°ï¼š


```python
%cd /home/aistudio/PaddleOCR
CUDA_VISIBLE_DEVICES=0 python tools/eval.py \
    -c configs/rec/ch_PP-OCRv2/ch_PP-OCRv2_rec_distillation.yml \
    -o Global.checkpoints=./pretrain/ch_PP-OCRv2_rec_train/best_accuracy
```

ä½¿ç”¨é¢„è®­ç»ƒæ¨¡å‹è¿›è¡Œè¯„ä¼°ï¼ŒæŒ‡æ ‡å¦‚ä¸‹æ‰€ç¤ºï¼š

| æ–¹æ¡ˆ |  acc  | 
| -------- | -------- | 
| PP-OCRv2ä¸­è‹±æ–‡è¶…è½»é‡è¯†åˆ«é¢„è®­ç»ƒæ¨¡å‹     | 67.48%     | 

ä½¿ç”¨æ–‡æœ¬é¢„è®­ç»ƒæ¨¡å‹åœ¨XFUNDéªŒè¯é›†ä¸Šè¯„ä¼°ï¼Œaccè¾¾åˆ°67%å·¦å³ï¼Œå……åˆ†è¯´æ˜ppocræä¾›çš„é¢„è®­ç»ƒæ¨¡å‹å…·æœ‰æ³›åŒ–èƒ½åŠ›ã€‚

#### 4.2.2 æ–¹æ¡ˆ2ï¼šXFUNDæ•°æ®é›†+finetune

åŒæ£€æµ‹æ¨¡å‹ï¼Œæˆ‘ä»¬æå–Studentæ¨¡å‹çš„å‚æ•°ï¼Œåœ¨XFUNDæ•°æ®é›†ä¸Šè¿›è¡Œfinetuneï¼Œå¯ä»¥å‚è€ƒå¦‚ä¸‹ä»£ç ï¼š


```python
import paddle
# åŠ è½½é¢„è®­ç»ƒæ¨¡å‹
all_params = paddle.load("pretrain/ch_PP-OCRv2_rec_train/best_accuracy.pdparams")
# æŸ¥çœ‹æƒé‡å‚æ•°çš„keys
print(all_params.keys())
# å­¦ç”Ÿæ¨¡å‹çš„æƒé‡æå–
s_params = {key[len("Student."):]: all_params[key] for key in all_params if "Student." in key}
# æŸ¥çœ‹å­¦ç”Ÿæ¨¡å‹æƒé‡å‚æ•°çš„keys
print(s_params.keys())
# ä¿å­˜
paddle.save(s_params, "pretrain/ch_PP-OCRv2_rec_train/student.pdparams")
```

**1)æ¨¡å‹è®­ç»ƒ**

<center><img src="https://ai-studio-static-online.cdn.bcebos.com/06dad690219b42a59a27c84a060af1436bcd05de10b843209c6270e04e4dda10"></center>
<center>å›¾13 æ–‡æœ¬è¯†åˆ«æ–¹æ¡ˆ2-æ¨¡å‹è®­ç»ƒ</center>

ä¿®æ”¹é…ç½®æ–‡ä»¶`configs/rec/ch_PP-OCRv2/ch_PP-OCRv2_rec.yml`ä¸­çš„ä»¥ä¸‹å­—æ®µï¼š

```
Global.pretrained_modelï¼šæŒ‡å‘é¢„è®­ç»ƒæ¨¡å‹è·¯å¾„
Global.character_dict_path: å­—å…¸è·¯å¾„
Optimizer.lr.valuesï¼šå­¦ä¹ ç‡
Train.dataset.data_dirï¼šæŒ‡å‘è®­ç»ƒé›†å›¾ç‰‡å­˜æ”¾ç›®å½•
Train.dataset.label_file_listï¼šæŒ‡å‘è®­ç»ƒé›†æ ‡æ³¨æ–‡ä»¶
Eval.dataset.data_dirï¼šæŒ‡å‘éªŒè¯é›†å›¾ç‰‡å­˜æ”¾ç›®å½•
Eval.dataset.label_file_listï¼šæŒ‡å‘éªŒè¯é›†æ ‡æ³¨æ–‡ä»¶
```
æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤å¯åŠ¨è®­ç»ƒï¼š

```python
%cd /home/aistudio/PaddleOCR/
CUDA_VISIBLE_DEVICES=0 python tools/train.py \
        -c configs/rec/ch_PP-OCRv2/ch_PP-OCRv2_rec.yml
```

**2ï¼‰æ¨¡å‹è¯„ä¼°**

<center><img src="https://ai-studio-static-online.cdn.bcebos.com/c07c88f708ad43cc8cd615861626d0e8333c0e3d4dda49ac8cba1f8939fa8a94"></center>

<center>å›¾14 æ–‡æœ¬è¯†åˆ«æ–¹æ¡ˆ2-æ¨¡å‹è¯„ä¼°</center>

ä½¿ç”¨è®­ç»ƒå¥½çš„æ¨¡å‹è¿›è¡Œè¯„ä¼°ï¼Œæ›´æ–°æ¨¡å‹è·¯å¾„`Global.checkpoints`ï¼Œè¿™é‡Œä¸ºå¤§å®¶æä¾›è®­ç»ƒå¥½çš„æ¨¡å‹`./pretrain/rec_mobile_pp-OCRv2-student-finetune/best_accuracy`


```python
%cd /home/aistudio/PaddleOCR/
CUDA_VISIBLE_DEVICES=0 python tools/eval.py \
    -c configs/rec/ch_PP-OCRv2/ch_PP-OCRv2_rec.yml \
    -o Global.checkpoints=./pretrain/rec_mobile_pp-OCRv2-student-finetune/best_accuracy
```

ä½¿ç”¨é¢„è®­ç»ƒæ¨¡å‹è¿›è¡Œè¯„ä¼°ï¼ŒæŒ‡æ ‡å¦‚ä¸‹æ‰€ç¤ºï¼š

| æ–¹æ¡ˆ | acc  | 
| -------- | -------- | 
| XFUNDæ•°æ®é›†+finetune    | 72.33%     | 

ä½¿ç”¨XFUNDæ•°æ®é›†+finetuneè®­ç»ƒï¼Œåœ¨éªŒè¯é›†ä¸Šè¯„ä¼°è¾¾åˆ°72%å·¦å³ï¼Œè¯´æ˜ finetuneä¼šæå‡å‚ç±»åœºæ™¯æ•ˆæœã€‚

#### 4.2.3 æ–¹æ¡ˆ3ï¼šXFUNDæ•°æ®é›†+finetune+çœŸå®é€šç”¨è¯†åˆ«æ•°æ®

æ¥ç€æˆ‘ä»¬åœ¨ä¸Šè¿°`XFUNDæ•°æ®é›†+finetune`å®éªŒçš„åŸºç¡€ä¸Šï¼Œæ·»åŠ çœŸå®é€šç”¨è¯†åˆ«æ•°æ®ï¼Œè¿›ä¸€æ­¥æå‡è¯†åˆ«æ•ˆæœã€‚é¦–å…ˆå‡†å¤‡çœŸå®é€šç”¨è¯†åˆ«æ•°æ®ï¼Œå¹¶ä¸Šä¼ åˆ°AIStudioï¼š

**1)æ¨¡å‹è®­ç»ƒ**

<center><img src="https://ai-studio-static-online.cdn.bcebos.com/45f288ce8b2c45d8aa5407785b4b40f4876fc3da23744bd7a78060797fba0190"></center>

<center>å›¾15 æ–‡æœ¬è¯†åˆ«æ–¹æ¡ˆ3-æ¨¡å‹è®­ç»ƒ</center>

åœ¨ä¸Šè¿°`XFUNDæ•°æ®é›†+finetune`å®éªŒä¸­ä¿®æ”¹é…ç½®æ–‡ä»¶`configs/rec/ch_PP-OCRv2/ch_PP-OCRv2_rec.yml`çš„åŸºç¡€ä¸Šï¼Œç»§ç»­ä¿®æ”¹ä»¥ä¸‹å­—æ®µï¼š

```
Train.dataset.label_file_listï¼šæŒ‡å‘çœŸå®è¯†åˆ«è®­ç»ƒé›†å›¾ç‰‡å­˜æ”¾ç›®å½•
Train.dataset.ratio_listï¼šåŠ¨æ€é‡‡æ ·
```
æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤å¯åŠ¨è®­ç»ƒï¼š



```python
%cd /home/aistudio/PaddleOCR/
CUDA_VISIBLE_DEVICES=0 python tools/train.py \
        -c configs/rec/ch_PP-OCRv2/ch_PP-OCRv2_rec.yml
```

**2ï¼‰æ¨¡å‹è¯„ä¼°**

<center><img src="https://ai-studio-static-online.cdn.bcebos.com/965db9f758614c6f9be301286cd5918f21110603c8aa4a1dbf5371e3afeec782"></center>

<center>å›¾16 æ–‡æœ¬è¯†åˆ«æ–¹æ¡ˆ3-æ¨¡å‹è¯„ä¼°</center>

ä½¿ç”¨è®­ç»ƒå¥½çš„æ¨¡å‹è¿›è¡Œè¯„ä¼°ï¼Œæ›´æ–°æ¨¡å‹è·¯å¾„`Global.checkpoints`ã€‚


```python
CUDA_VISIBLE_DEVICES=0 python tools/eval.py \
    -c configs/rec/ch_PP-OCRv2/ch_PP-OCRv2_rec.yml \
    -o Global.checkpoints=./pretrain/rec_mobile_pp-OCRv2-student-realdata/best_accuracy
```

ä½¿ç”¨é¢„è®­ç»ƒæ¨¡å‹è¿›è¡Œè¯„ä¼°ï¼ŒæŒ‡æ ‡å¦‚ä¸‹æ‰€ç¤ºï¼š

| æ–¹æ¡ˆ | acc  |
| -------- | -------- |
| XFUNDæ•°æ®é›†+fine-tune+çœŸå®é€šç”¨è¯†åˆ«æ•°æ®   | 85.29%     |

ä½¿ç”¨XFUNDæ•°æ®é›†+finetuneè®­ç»ƒï¼Œåœ¨éªŒè¯é›†ä¸Šè¯„ä¼°è¾¾åˆ°85%å·¦å³ï¼Œè¯´æ˜çœŸå®é€šç”¨è¯†åˆ«æ•°æ®å¯¹äºæ€§èƒ½æå‡å¾ˆæœ‰å¸®åŠ©ã€‚

**3)å¯¼å‡ºæ¨¡å‹**

<center><img src="https://ai-studio-static-online.cdn.bcebos.com/3dc7f69fac174cde96b9d08b5e2353a1d88dc63e7be9410894c0783660b35b76"></center>
<center>å›¾17 æ–‡æœ¬è¯†åˆ«æ–¹æ¡ˆ3-å¯¼å‡ºæ¨¡å‹</center>

å¯¼å‡ºæ¨¡å‹åªä¿ç•™å‰å‘é¢„æµ‹çš„è¿‡ç¨‹ï¼š


```python
!python tools/export_model.py \
    -c configs/rec/ch_PP-OCRv2/ch_PP-OCRv2_rec.yml \
    -o Global.pretrained_model=pretrain/rec_mobile_pp-OCRv2-student-realdata/best_accuracy  \
    Global.save_inference_dir=./output/rec_crnn_inference/
```

**4)æ¨¡å‹é¢„æµ‹**

<center><img src="https://ai-studio-static-online.cdn.bcebos.com/60b95b4945954f81a080a8f308cee66f83146479cd1142b9b6b1290938fd1df8"></center>

<center>å›¾18 æ–‡æœ¬è¯†åˆ«æ–¹æ¡ˆ3-æ¨¡å‹é¢„æµ‹</center>

åŠ è½½ä¸Šé¢å¯¼å‡ºçš„æ¨¡å‹ï¼Œæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤å¯¹éªŒè¯é›†æˆ–æµ‹è¯•é›†å›¾ç‰‡è¿›è¡Œé¢„æµ‹ï¼Œæ£€æµ‹å¯è§†åŒ–ç»“æœä¿å­˜åœ¨`/home/aistudio/inference_results/`ç›®å½•ä¸‹ï¼ŒæŸ¥çœ‹æ£€æµ‹ã€è¯†åˆ«æ•ˆæœã€‚éœ€è¦é€šè¿‡`--rec_char_dict_path`æŒ‡å®šä½¿ç”¨çš„å­—å…¸è·¯å¾„


```python
python tools/infer/predict_system.py \
    --image_dir="./doc/vqa/input/zh_val_21.jpg" \
    --det_model_dir="./output/det_db_inference/" \
    --rec_model_dir="./output/rec_crnn_inference/" \
    --rec_image_shape="3, 32, 320" \
    --rec_char_dict_path="/home/aistudio/XFUND/word_dict.txt"
```

æ€»ç»“ï¼Œæˆ‘ä»¬åˆ†åˆ«ä½¿ç”¨PP-OCRv2ä¸­è‹±æ–‡è¶…è½»é‡æ£€æµ‹é¢„è®­ç»ƒæ¨¡å‹ã€XFUNDæ•°æ®é›†+finetune2ç§æ–¹æ¡ˆè¿›è¡Œè¯„ä¼°ã€è®­ç»ƒç­‰ï¼ŒæŒ‡æ ‡å¯¹æ¯”å¦‚ä¸‹ï¼š

| æ–¹æ¡ˆ | acc  | ç»“æœåˆ†æ |
| -------- | -------- | -------- |
| PP-OCRv2ä¸­è‹±æ–‡è¶…è½»é‡è¯†åˆ«é¢„è®­ç»ƒæ¨¡å‹     | 67.48%    | ppocræä¾›çš„é¢„è®­ç»ƒæ¨¡å‹å…·æœ‰æ³›åŒ–èƒ½åŠ›  |
| XFUNDæ•°æ®é›†+fine-tune    |72.33%     | finetuneä¼šæå‡å‚ç±»åœºæ™¯æ•ˆæœ    |
| XFUNDæ•°æ®é›†+fine-tune+çœŸå®é€šç”¨è¯†åˆ«æ•°æ®    | 85.29%     | çœŸå®é€šç”¨è¯†åˆ«æ•°æ®å¯¹äºæ€§èƒ½æå‡å¾ˆæœ‰å¸®åŠ©    |

## 5 æ–‡æ¡£è§†è§‰é—®ç­”(DOC-VQA)

VQAæŒ‡è§†è§‰é—®ç­”ï¼Œä¸»è¦é’ˆå¯¹å›¾åƒå†…å®¹è¿›è¡Œæé—®å’Œå›ç­”,DOC-VQAæ˜¯VQAä»»åŠ¡ä¸­çš„ä¸€ç§ï¼ŒDOC-VQAä¸»è¦é’ˆå¯¹æ–‡æœ¬å›¾åƒçš„æ–‡å­—å†…å®¹æå‡ºé—®é¢˜ã€‚

PaddleOCRä¸­DOC-VQAç³»åˆ—ç®—æ³•åŸºäºPaddleNLPè‡ªç„¶è¯­è¨€å¤„ç†ç®—æ³•åº“å®ç°LayoutXLMè®ºæ–‡ï¼Œæ”¯æŒåŸºäºå¤šæ¨¡æ€æ–¹æ³•çš„ **è¯­ä¹‰å®ä½“è¯†åˆ« (Semantic Entity Recognition, SER)** ä»¥åŠ **å…³ç³»æŠ½å– (Relation Extraction, RE)**    ä»»åŠ¡ã€‚

å¦‚æœå¸Œæœ›ç›´æ¥ä½“éªŒé¢„æµ‹è¿‡ç¨‹ï¼Œå¯ä»¥ä¸‹è½½æˆ‘ä»¬æä¾›çš„é¢„è®­ç»ƒæ¨¡å‹ï¼Œè·³è¿‡è®­ç»ƒè¿‡ç¨‹ï¼Œç›´æ¥é¢„æµ‹å³å¯ã€‚


```python
%cd pretrain
#ä¸‹è½½SERæ¨¡å‹
wget https://paddleocr.bj.bcebos.com/pplayout/ser_LayoutXLM_xfun_zh.tar && tar -xvf ser_LayoutXLM_xfun_zh.tar
#ä¸‹è½½REæ¨¡å‹
wget https://paddleocr.bj.bcebos.com/pplayout/re_LayoutXLM_xfun_zh.tar && tar -xvf re_LayoutXLM_xfun_zh.tar
%cd ../
```

### 5.1 SER

SER: è¯­ä¹‰å®ä½“è¯†åˆ« (Semantic Entity Recognitionï¼‰, å¯ä»¥å®Œæˆå¯¹å›¾åƒä¸­çš„æ–‡æœ¬è¯†åˆ«ä¸åˆ†ç±»ã€‚ 

<center><img src='https://ai-studio-static-online.cdn.bcebos.com/a3b25766f3074d2facdf88d4a60fc76612f51992fd124cf5bd846b213130665b' width='700'></center>
<center>å›¾19 SERæµ‹è¯•æ•ˆæœå›¾</center>

**å›¾19** ä¸­ä¸åŒé¢œè‰²çš„æ¡†è¡¨ç¤ºä¸åŒçš„ç±»åˆ«ï¼Œå¯¹äºXFUNDæ•°æ®é›†ï¼Œæœ‰QUESTION, ANSWER, HEADER 3ç§ç±»åˆ«

- æ·±ç´«è‰²ï¼šHEADER
- æµ…ç´«è‰²ï¼šQUESTION
- å†›ç»¿è‰²ï¼šANSWER

åœ¨OCRæ£€æµ‹æ¡†çš„å·¦ä¸Šæ–¹ä¹Ÿæ ‡å‡ºäº†å¯¹åº”çš„ç±»åˆ«å’ŒOCRè¯†åˆ«ç»“æœã€‚

#### 5.1.1 æ¨¡å‹è®­ç»ƒ

<center><img src="https://ai-studio-static-online.cdn.bcebos.com/2e45f297c9d44ca5b8718ae100a365f7348eaeed4cb8495b904f28a9c8075d8a"></center>

<center>å›¾20 SER-æ¨¡å‹è®­ç»ƒ</center>

å¯åŠ¨è®­ç»ƒä¹‹å‰ï¼Œéœ€è¦ä¿®æ”¹é…ç½®æ–‡ä»¶ `configs/vqa/ser/layoutxlm.yml`  ä»¥ä¸‹å››ä¸ªå­—æ®µï¼š

    1. Train.dataset.data_dirï¼šæŒ‡å‘è®­ç»ƒé›†å›¾ç‰‡å­˜æ”¾ç›®å½•
    2. Train.dataset.label_file_listï¼šæŒ‡å‘è®­ç»ƒé›†æ ‡æ³¨æ–‡ä»¶
    3. Eval.dataset.data_dirï¼šæŒ‡æŒ‡å‘éªŒè¯é›†å›¾ç‰‡å­˜æ”¾ç›®å½•
    4. Eval.dataset.label_file_listï¼šæŒ‡å‘éªŒè¯é›†æ ‡æ³¨æ–‡ä»¶



```python
%cd /home/aistudio/PaddleOCR/
CUDA_VISIBLE_DEVICES=0 python tools/train.py -c configs/vqa/ser/layoutxlm.yml
```

æœ€ç»ˆä¼šæ‰“å°å‡º`precision`, `recall`, `hmean`ç­‰æŒ‡æ ‡ã€‚ åœ¨`./output/ser_layoutxlm/`æ–‡ä»¶å¤¹ä¸­ä¼šä¿å­˜è®­ç»ƒæ—¥å¿—ï¼Œæœ€ä¼˜çš„æ¨¡å‹å’Œæœ€æ–°epochçš„æ¨¡å‹ã€‚

#### 5.1.2 æ¨¡å‹è¯„ä¼°

<center><img src="https://ai-studio-static-online.cdn.bcebos.com/5df160ac39ee4d9e92a937094bc53a737272f9f2abeb4ddfaebb48e8eccf1be2"></center>

<center>å›¾21 SER-æ¨¡å‹è¯„ä¼°</center>

æˆ‘ä»¬ä½¿ç”¨ä¸‹è½½çš„é¢„è®­ç»ƒæ¨¡å‹è¿›è¡Œè¯„ä¼°ï¼Œå¦‚æœä½¿ç”¨è‡ªå·±è®­ç»ƒå¥½çš„æ¨¡å‹è¿›è¡Œè¯„ä¼°ï¼Œå°†å¾…è¯„ä¼°çš„æ¨¡å‹æ‰€åœ¨æ–‡ä»¶å¤¹è·¯å¾„èµ‹å€¼ç»™ `Architecture.Backbone.checkpoints` å­—æ®µå³å¯ã€‚




```python
CUDA_VISIBLE_DEVICES=0 python tools/eval.py \
    -c configs/vqa/ser/layoutxlm.yml \
    -o Architecture.Backbone.checkpoints=pretrain/ser_LayoutXLM_xfun_zh/
```

æœ€ç»ˆä¼šæ‰“å°å‡º`precision`, `recall`, `hmean`ç­‰æŒ‡æ ‡ï¼Œé¢„è®­ç»ƒæ¨¡å‹è¯„ä¼°æŒ‡æ ‡å¦‚ä¸‹ï¼š

<center><img src='https://ai-studio-static-online.cdn.bcebos.com/2854aee557a74079a82dd5cd57e48bc2ce97974d5637477fb4deea137d0e312c' width='700'></center>
<center>å›¾ SERé¢„è®­ç»ƒæ¨¡å‹è¯„ä¼°æŒ‡æ ‡</center>

#### 5.1.3 æ¨¡å‹é¢„æµ‹

<center><img src="https://ai-studio-static-online.cdn.bcebos.com/0f7d50a0fb924b408b93e1fbd6ca64148eed34a2e6724280acd3e113fef7dc48"></center>

<center>å›¾22 SER-æ¨¡å‹é¢„æµ‹</center>

ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤å³å¯å®Œæˆ`OCRå¼•æ“ + SER`çš„ä¸²è”é¢„æµ‹, ä»¥SERé¢„è®­ç»ƒæ¨¡å‹ä¸ºä¾‹:


```python
CUDA_VISIBLE_DEVICES=0 python tools/infer_vqa_token_ser.py \
    -c configs/vqa/ser/layoutxlm.yml  \
    -o Architecture.Backbone.checkpoints=pretrain/ser_LayoutXLM_xfun_zh/ \
    Global.infer_img=doc/vqa/input/zh_val_42.jpg
```

æœ€ç»ˆä¼šåœ¨`config.Global.save_res_path`å­—æ®µæ‰€é…ç½®çš„ç›®å½•ä¸‹ä¿å­˜é¢„æµ‹ç»“æœå¯è§†åŒ–å›¾åƒä»¥åŠé¢„æµ‹ç»“æœæ–‡æœ¬æ–‡ä»¶ï¼Œé¢„æµ‹ç»“æœæ–‡æœ¬æ–‡ä»¶åä¸º`infer_results.txt`ã€‚é€šè¿‡å¦‚ä¸‹å‘½ä»¤æŸ¥çœ‹é¢„æµ‹å›¾ç‰‡ï¼š


```python
import cv2
from matplotlib import pyplot as plt
# åœ¨notebookä¸­ä½¿ç”¨matplotlib.pyplotç»˜å›¾æ—¶ï¼Œéœ€è¦æ·»åŠ è¯¥å‘½ä»¤è¿›è¡Œæ˜¾ç¤º
%matplotlib inline

img = cv2.imread('output/ser/zh_val_42_ser.jpg')
plt.figure(figsize=(48,24))
plt.imshow(img)
```

### 5.2 RE

åŸºäº RE ä»»åŠ¡ï¼Œå¯ä»¥å®Œæˆå¯¹å›¾è±¡ä¸­çš„æ–‡æœ¬å†…å®¹çš„å…³ç³»æå–ï¼Œå¦‚åˆ¤æ–­é—®é¢˜å¯¹(pair)ã€‚

<center><img src='https://ai-studio-static-online.cdn.bcebos.com/4de19ca3e54343e88961e816cad28bbacdc807f40b9440be914d871b0a914570' width='700'></center>
<center>å›¾23 REé¢„æµ‹æ•ˆæœå›¾</center>

å›¾ä¸­çº¢è‰²æ¡†è¡¨ç¤ºé—®é¢˜ï¼Œè“è‰²æ¡†è¡¨ç¤ºç­”æ¡ˆï¼Œé—®é¢˜å’Œç­”æ¡ˆä¹‹é—´ä½¿ç”¨ç»¿è‰²çº¿è¿æ¥ã€‚åœ¨OCRæ£€æµ‹æ¡†çš„å·¦ä¸Šæ–¹ä¹Ÿæ ‡å‡ºäº†å¯¹åº”çš„ç±»åˆ«å’ŒOCRè¯†åˆ«ç»“æœã€‚

#### 5.2.1 æ¨¡å‹è®­ç»ƒ

<center><img src="https://ai-studio-static-online.cdn.bcebos.com/268c707a62c54e93958d2b2ab29e0932953aad41819e44aaaaa05c8ad85c6491"></center>

<center>å›¾24 RE-æ¨¡å‹è®­ç»ƒ</center>

å¯åŠ¨è®­ç»ƒä¹‹å‰ï¼Œéœ€è¦ä¿®æ”¹é…ç½®æ–‡ä»¶`configs/vqa/re/layoutxlm.yml`ä¸­çš„ä»¥ä¸‹å››ä¸ªå­—æ®µ

    Train.dataset.data_dirï¼šæŒ‡å‘è®­ç»ƒé›†å›¾ç‰‡å­˜æ”¾ç›®å½•
    Train.dataset.label_file_listï¼šæŒ‡å‘è®­ç»ƒé›†æ ‡æ³¨æ–‡ä»¶
    Eval.dataset.data_dirï¼šæŒ‡æŒ‡å‘éªŒè¯é›†å›¾ç‰‡å­˜æ”¾ç›®å½•
    Eval.dataset.label_file_listï¼šæŒ‡å‘éªŒè¯é›†æ ‡æ³¨æ–‡ä»¶



```python
CUDA_VISIBLE_DEVICES=0 python3 tools/train.py -c configs/vqa/re/layoutxlm.yml
```

æœ€ç»ˆä¼šæ‰“å°å‡º`precision`, `recall`, `hmean`ç­‰æŒ‡æ ‡ã€‚ åœ¨`./output/re_layoutxlm/`æ–‡ä»¶å¤¹ä¸­ä¼šä¿å­˜è®­ç»ƒæ—¥å¿—ï¼Œæœ€ä¼˜çš„æ¨¡å‹å’Œæœ€æ–°epochçš„æ¨¡å‹

#### 5.2.2 æ¨¡å‹è¯„ä¼°

<center><img src="https://ai-studio-static-online.cdn.bcebos.com/93c66a43a69e472899c1c6732408b7a42e99a43721e94e9ca3c0a64e080306e4"></center>
<center>å›¾25 RE-æ¨¡å‹è¯„ä¼°</center>


æˆ‘ä»¬ä½¿ç”¨ä¸‹è½½çš„é¢„è®­ç»ƒæ¨¡å‹è¿›è¡Œè¯„ä¼°ï¼Œå¦‚æœä½¿ç”¨è‡ªå·±è®­ç»ƒå¥½çš„æ¨¡å‹è¿›è¡Œè¯„ä¼°ï¼Œå°†å¾…è¯„ä¼°çš„æ¨¡å‹æ‰€åœ¨æ–‡ä»¶å¤¹è·¯å¾„èµ‹å€¼ç»™ `Architecture.Backbone.checkpoints` å­—æ®µå³å¯ã€‚


```python
CUDA_VISIBLE_DEVICES=0 python3 tools/eval.py \
    -c configs/vqa/re/layoutxlm.yml \
    -o Architecture.Backbone.checkpoints=pretrain/re_LayoutXLM_xfun_zh/
```

æœ€ç»ˆä¼šæ‰“å°å‡º`precision`, `recall`, `hmean`ç­‰æŒ‡æ ‡ï¼Œé¢„è®­ç»ƒæ¨¡å‹è¯„ä¼°æŒ‡æ ‡å¦‚ä¸‹ï¼š

<center><img src='https://ai-studio-static-online.cdn.bcebos.com/f99af54fb2d14691a73b1a748e0ca22618aeddfded0c4da58bbbb03edb8c2340' width='700'></center>
<center>å›¾ REé¢„è®­ç»ƒæ¨¡å‹è¯„ä¼°æŒ‡æ ‡</center>

#### 5.2.3 æ¨¡å‹é¢„æµ‹

<center><img src="https://ai-studio-static-online.cdn.bcebos.com/bab32d32bdec4339b9a3e5f911e4b41f77996f3faabc40bd8309b5b20cad31e4"></center>

<center>å›¾26 RE-æ¨¡å‹é¢„æµ‹</center>

ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤å³å¯å®ŒæˆOCRå¼•æ“ + SER + REçš„ä¸²è”é¢„æµ‹, ä»¥é¢„è®­ç»ƒSERå’ŒREæ¨¡å‹ä¸ºä¾‹ï¼Œ

æœ€ç»ˆä¼šåœ¨config.Global.save_res_pathå­—æ®µæ‰€é…ç½®çš„ç›®å½•ä¸‹ä¿å­˜é¢„æµ‹ç»“æœå¯è§†åŒ–å›¾åƒä»¥åŠé¢„æµ‹ç»“æœæ–‡æœ¬æ–‡ä»¶ï¼Œé¢„æµ‹ç»“æœæ–‡æœ¬æ–‡ä»¶åä¸ºinfer_results.txtã€‚


```python
cd /home/aistudio/PaddleOCR
CUDA_VISIBLE_DEVICES=0 python3 tools/infer_vqa_token_ser_re.py \
    -c configs/vqa/re/layoutxlm.yml \
    -o Architecture.Backbone.checkpoints=pretrain/re_LayoutXLM_xfun_zh/ \
    Global.infer_img=test_imgs/ \
    -c_ser configs/vqa/ser/layoutxlm.yml \
    -o_ser Architecture.Backbone.checkpoints=pretrain/ser_LayoutXLM_xfun_zh/
```

æœ€ç»ˆä¼šåœ¨config.Global.save_res_pathå­—æ®µæ‰€é…ç½®çš„ç›®å½•ä¸‹ä¿å­˜é¢„æµ‹ç»“æœå¯è§†åŒ–å›¾åƒä»¥åŠé¢„æµ‹ç»“æœæ–‡æœ¬æ–‡ä»¶ï¼Œé¢„æµ‹ç»“æœæ–‡æœ¬æ–‡ä»¶åä¸ºinfer_results.txt, æ¯ä¸€è¡Œè¡¨ç¤ºä¸€å¼ å›¾ç‰‡çš„ç»“æœï¼Œæ¯å¼ å›¾ç‰‡çš„ç»“æœå¦‚ä¸‹æ‰€ç¤ºï¼Œå‰é¢è¡¨ç¤ºæµ‹è¯•å›¾ç‰‡è·¯å¾„ï¼Œåé¢ä¸ºæµ‹è¯•ç»“æœï¼škeyå­—æ®µåŠå¯¹åº”çš„valueå­—æ®µã€‚

```
test_imgs/t131.jpg	{"æ”¿æ²»é¢ç¨": "ç¾¤ä¼—", "æ€§åˆ«": "ç”·", "ç±è´¯": "æ²³åŒ—çœé‚¯éƒ¸å¸‚", "å©šå§»çŠ¶å†µ": "äºæœ«å©šå£å·²å©šå£å·²å¨‡", "é€šè®¯åœ°å€": "é‚¯éƒ¸å¸‚é˜³å…‰è‹‘7å·æ¥¼003", "æ°‘æ—": "æ±‰æ—", "æ¯•ä¸šé™¢æ ¡": "æ²³å—å·¥ä¸šå¤§å­¦", "æˆ·å£æ€§è´¨": "å£å†œæ‘åŸé•‡", "æˆ·å£åœ°å€": "æ²³åŒ—çœé‚¯éƒ¸å¸‚", "è”ç³»ç”µè¯": "13288888888", "å¥åº·çŠ¶å†µ": "å¥åº·", "å§“å": "å°å…­", "å¥½é«˜cm": "180", "å‡ºç”Ÿå¹´æœˆ": "1996å¹´8æœˆ9æ—¥", "æ–‡åŒ–ç¨‹åº¦": "æœ¬ç§‘", "èº«ä»½è¯å·ç ": "458933777777777777"}
````

å±•ç¤ºé¢„æµ‹ç»“æœ

```python
import cv2
from matplotlib import pyplot as plt
%matplotlib inline

img = cv2.imread('./output/re/t131_ser.jpg')
plt.figure(figsize=(48,24))
plt.imshow(img)
```

## 6 å¯¼å‡ºExcel

<center><img src="https://ai-studio-static-online.cdn.bcebos.com/ab93d3d90d77437a81c9534b2dd1d3e39ef81e8473054fd3aeff6e837ebfb827"></center>
<center>å›¾27 å¯¼å‡ºExcel</center>

ä¸ºäº†è¾“å‡ºä¿¡æ¯åŒ¹é…å¯¹ï¼Œæˆ‘ä»¬ä¿®æ”¹`tools/infer_vqa_token_ser_re.py`æ–‡ä»¶ä¸­çš„`line 194-197`ã€‚
```
 fout.write(img_path + "\t" + json.dumps(
                {
                    "ser_result": result,
                }, ensure_ascii=False) + "\n")

```
æ›´æ”¹ä¸º
```
result_key = {}
for ocr_info_head, ocr_info_tail in result:
    result_key[ocr_info_head['text']] = ocr_info_tail['text']

fout.write(img_path + "\t" + json.dumps(
    result_key, ensure_ascii=False) + "\n")
```

åŒæ—¶å°†è¾“å‡ºç»“æœå¯¼å‡ºåˆ°Excelä¸­ï¼Œæ•ˆæœå¦‚ å›¾28 æ‰€ç¤ºï¼š

<center><img src='https://ai-studio-static-online.cdn.bcebos.com/9f45d3eef75e4842a0828bb9e518c2438300264aec0646cc9addfce860a04196' width='700'></center>
<center>å›¾28 Excelæ•ˆæœå›¾</center>


```python
import json
import xlsxwriter as xw

workbook = xw.Workbook('output/re/infer_results.xlsx')
format1 = workbook.add_format({
    'align': 'center',
    'valign': 'vcenter',
    'text_wrap': True,
})
worksheet1 = workbook.add_worksheet('sheet1')
worksheet1.activate()
title = ['å§“å', 'æ€§åˆ«', 'æ°‘æ—', 'æ–‡åŒ–ç¨‹åº¦', 'èº«ä»½è¯å·ç ', 'è”ç³»ç”µè¯', 'é€šè®¯åœ°å€']
worksheet1.write_row('A1', title)
i = 2

with open('output/re/infer_results.txt', 'r', encoding='utf-8') as fin:
    lines = fin.readlines()
    for line in lines:
        img_path, result = line.strip().split('\t')
        result_key = json.loads(result)
        # å†™å…¥Excel
        row_data = [result_key['å§“å'], result_key['æ€§åˆ«'], result_key['æ°‘æ—'], result_key['æ–‡åŒ–ç¨‹åº¦'], result_key['èº«ä»½è¯å·ç '], 
                    result_key['è”ç³»ç”µè¯'], result_key['é€šè®¯åœ°å€']]
        row = 'A' + str(i)
        worksheet1.write_row(row, row_data, format1)
        i+=1
workbook.close()
```

## æ›´å¤šèµ„æº

- æ›´å¤šæ·±åº¦å­¦ä¹ çŸ¥è¯†ã€äº§ä¸šæ¡ˆä¾‹ã€é¢è¯•å®å…¸ç­‰ï¼Œè¯·å‚è€ƒï¼š[awesome-DeepLearning](https://github.com/paddlepaddle/awesome-DeepLearning)

- æ›´å¤šPaddleOCRä½¿ç”¨æ•™ç¨‹ï¼Œè¯·å‚è€ƒï¼š[PaddleOCR](https://github.com/PaddlePaddle/PaddleOCR/tree/dygraph)

- æ›´å¤šPaddleNLPä½¿ç”¨æ•™ç¨‹ï¼Œè¯·å‚è€ƒï¼š[PaddleNLP](https://github.com/PaddlePaddle/PaddleNLP)

- é£æ¡¨æ¡†æ¶ç›¸å…³èµ„æ–™ï¼Œè¯·å‚è€ƒï¼š[é£æ¡¨æ·±åº¦å­¦ä¹ å¹³å°](https://www.paddlepaddle.org.cn/?fr=paddleEdu_aistudio)

## å‚è€ƒé“¾æ¥

-  LayoutXLM: Multimodal Pre-training for Multilingual Visually-rich Document Understanding, https://arxiv.org/pdf/2104.08836.pdf

- microsoft/unilm/layoutxlm, https://github.com/microsoft/unilm/tree/master/layoutxlm

- XFUND dataset, https://github.com/doc-analysis/XFUND

