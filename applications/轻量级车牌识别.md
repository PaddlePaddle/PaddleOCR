# ä¸€ç§åŸºäºPaddleOCRçš„è½»é‡çº§è½¦ç‰Œè¯†åˆ«æ¨¡å‹

- [1. é¡¹ç›®ä»‹ç»](#1-é¡¹ç›®ä»‹ç»)
- [2. ç¯å¢ƒæ­å»º](#2-ç¯å¢ƒæ­å»º)
- [3. æ•°æ®é›†å‡†å¤‡](#3-æ•°æ®é›†å‡†å¤‡)
  - [3.1 æ•°æ®é›†æ ‡æ³¨è§„åˆ™](#31-æ•°æ®é›†æ ‡æ³¨è§„åˆ™)
  - [3.2 åˆ¶ä½œç¬¦åˆPP-OCRè®­ç»ƒæ ¼å¼çš„æ ‡æ³¨æ–‡ä»¶](#32-åˆ¶ä½œç¬¦åˆpp-ocrè®­ç»ƒæ ¼å¼çš„æ ‡æ³¨æ–‡ä»¶)
- [4. å®éªŒ](#4-å®éªŒ)
  - [4.1 æ£€æµ‹](#41-æ£€æµ‹)
    - [4.1.1 é¢„è®­ç»ƒæ¨¡å‹ç›´æ¥é¢„æµ‹](#411-é¢„è®­ç»ƒæ¨¡å‹ç›´æ¥é¢„æµ‹)
    - [4.1.2 CCPDè½¦ç‰Œæ•°æ®é›†fine-tune](#412-ccpdè½¦ç‰Œæ•°æ®é›†fine-tune)
    - [4.1.3 CCPDè½¦ç‰Œæ•°æ®é›†fine-tune+é‡åŒ–è®­ç»ƒ](#413-ccpdè½¦ç‰Œæ•°æ®é›†fine-tuneé‡åŒ–è®­ç»ƒ)
    - [4.1.4 æ¨¡å‹å¯¼å‡º](#414-æ¨¡å‹å¯¼å‡º)
  - [4.2 è¯†åˆ«](#42-è¯†åˆ«)
    - [4.2.1 é¢„è®­ç»ƒæ¨¡å‹ç›´æ¥é¢„æµ‹](#421-é¢„è®­ç»ƒæ¨¡å‹ç›´æ¥é¢„æµ‹)
    - [4.2.2 é¢„è®­ç»ƒæ¨¡å‹ç›´æ¥é¢„æµ‹+æ”¹åŠ¨åå¤„ç†](#422-é¢„è®­ç»ƒæ¨¡å‹ç›´æ¥é¢„æµ‹æ”¹åŠ¨åå¤„ç†)
    - [4.2.3 CCPDè½¦ç‰Œæ•°æ®é›†fine-tune](#423-ccpdè½¦ç‰Œæ•°æ®é›†fine-tune)
    - [4.2.4 CCPDè½¦ç‰Œæ•°æ®é›†fine-tune+é‡åŒ–è®­ç»ƒ](#424-ccpdè½¦ç‰Œæ•°æ®é›†fine-tuneé‡åŒ–è®­ç»ƒ)
    - [4.2.5 æ¨¡å‹å¯¼å‡º](#425-æ¨¡å‹å¯¼å‡º)
  - [4.3 è®¡ç®—End2EndæŒ‡æ ‡](#43-è®¡ç®—End2EndæŒ‡æ ‡)
  - [4.4 éƒ¨ç½²](#44-éƒ¨ç½²)
  - [4.5 å®éªŒæ€»ç»“](#45-å®éªŒæ€»ç»“)

## 1. é¡¹ç›®ä»‹ç»

è½¦ç‰Œè¯†åˆ«(Vehicle License Plate Recognitionï¼ŒVLPR) æ˜¯è®¡ç®—æœºè§†é¢‘å›¾åƒè¯†åˆ«æŠ€æœ¯åœ¨è½¦è¾†ç‰Œç…§è¯†åˆ«ä¸­çš„ä¸€ç§åº”ç”¨ã€‚è½¦ç‰Œè¯†åˆ«æŠ€æœ¯è¦æ±‚èƒ½å¤Ÿå°†è¿åŠ¨ä¸­çš„æ±½è½¦ç‰Œç…§ä»å¤æ‚èƒŒæ™¯ä¸­æå–å¹¶è¯†åˆ«å‡ºæ¥ï¼Œåœ¨é«˜é€Ÿå…¬è·¯è½¦è¾†ç®¡ç†ï¼Œåœè½¦åœºç®¡ç†å’ŒåŸå¸‚äº¤é€šä¸­å¾—åˆ°å¹¿æ³›åº”ç”¨ã€‚

æœ¬é¡¹ç›®éš¾ç‚¹å¦‚ä¸‹ï¼š

1. è½¦ç‰Œåœ¨å›¾åƒä¸­çš„å°ºåº¦å·®å¼‚å¤§ã€åœ¨è½¦è¾†ä¸Šçš„æ‚¬æŒ‚ä½ç½®ä¸å›ºå®š
2. è½¦ç‰Œå›¾åƒè´¨é‡å±‚æ¬¡ä¸é½: è§’åº¦å€¾æ–œã€å›¾ç‰‡æ¨¡ç³Šã€å…‰ç…§ä¸è¶³ã€è¿‡æ›ç­‰é—®é¢˜ä¸¥é‡
3. è¾¹ç¼˜å’Œç«¯æµ‹åœºæ™¯åº”ç”¨å¯¹æ¨¡å‹å¤§å°æœ‰é™åˆ¶ï¼Œæ¨ç†é€Ÿåº¦æœ‰è¦æ±‚

é’ˆå¯¹ä»¥ä¸Šé—®é¢˜ï¼Œ æœ¬ä¾‹é€‰ç”¨ PP-OCRv3 è¿™ä¸€å¼€æºè¶…è½»é‡OCRç³»ç»Ÿè¿›è¡Œè½¦ç‰Œè¯†åˆ«ç³»ç»Ÿçš„å¼€å‘ã€‚åŸºäºPP-OCRv3æ¨¡å‹ï¼Œåœ¨CCPDæ•°æ®é›†è¾¾åˆ°99%çš„æ£€æµ‹å’Œ94%çš„è¯†åˆ«ç²¾åº¦ï¼Œæ¨¡å‹å¤§å°12.8M(2.5M+10.3M)ã€‚åŸºäºé‡åŒ–å¯¹æ¨¡å‹ä½“ç§¯è¿›è¡Œè¿›ä¸€æ­¥å‹ç¼©åˆ°5.8M(1M+4.8M), åŒæ—¶æ¨ç†é€Ÿåº¦æå‡25%ã€‚



aistudioé¡¹ç›®é“¾æ¥: [åŸºäºPaddleOCRçš„è½»é‡çº§è½¦ç‰Œè¯†åˆ«èŒƒä¾‹](https://aistudio.baidu.com/aistudio/projectdetail/3919091?contributionType=1)

## 2. ç¯å¢ƒæ­å»º

æœ¬ä»»åŠ¡åŸºäºAistudioå®Œæˆ, å…·ä½“ç¯å¢ƒå¦‚ä¸‹ï¼š

- æ“ä½œç³»ç»Ÿ: Linux
- PaddlePaddle: 2.3
- paddleslim: 2.2.2
- PaddleOCR: Release/2.5

ä¸‹è½½ PaddleOCRä»£ç 

```bash
git clone -b dygraph https://github.com/PaddlePaddle/PaddleOCR
```

å®‰è£…ä¾èµ–åº“

```bash
pip install -r PaddleOCR/requirements.txt
```

## 3. æ•°æ®é›†å‡†å¤‡

æ‰€ä½¿ç”¨çš„æ•°æ®é›†ä¸º CCPD2020 æ–°èƒ½æºè½¦ç‰Œæ•°æ®é›†ï¼Œè¯¥æ•°æ®é›†ä¸º

è¯¥æ•°æ®é›†åˆ†å¸ƒå¦‚ä¸‹ï¼š

|æ•°æ®é›†ç±»å‹|æ•°é‡|
|---|---|
|è®­ç»ƒé›†| 5769|
|éªŒè¯é›†| 1001|
|æµ‹è¯•é›†| 5006|

æ•°æ®é›†å›¾ç‰‡ç¤ºä¾‹å¦‚ä¸‹:
![](https://ai-studio-static-online.cdn.bcebos.com/3bce057a8e0c40a0acbd26b2e29e4e2590a31bc412764be7b9e49799c69cb91c)

æ•°æ®é›†å¯ä»¥ä»è¿™é‡Œä¸‹è½½ https://aistudio.baidu.com/aistudio/datasetdetail/101595

ä¸‹è½½å¥½æ•°æ®é›†åå¯¹æ•°æ®é›†è¿›è¡Œè§£å‹

```bash
unzip -d /home/aistudio/data /home/aistudio/data/data101595/CCPD2020.zip
```

### 3.1 æ•°æ®é›†æ ‡æ³¨è§„åˆ™

CPPDæ•°æ®é›†çš„å›¾ç‰‡æ–‡ä»¶åå…·æœ‰ç‰¹æ®Šè§„åˆ™ï¼Œè¯¦ç»†å¯æŸ¥çœ‹ï¼šhttps://github.com/detectRecog/CCPD

å…·ä½“è§„åˆ™å¦‚ä¸‹ï¼š

ä¾‹å¦‚: 025-95_113-154&383_386&473-386&473_177&454_154&383_363&402-0_0_22_27_27_33_16-37-15.jpg

æ¯ä¸ªåç§°å¯ä»¥åˆ†ä¸ºä¸ƒä¸ªå­—æ®µï¼Œä»¥-ç¬¦å·ä½œä¸ºåˆ†å‰²ã€‚è¿™äº›å­—æ®µè§£é‡Šå¦‚ä¸‹ã€‚

- 025ï¼šè½¦ç‰Œé¢ç§¯ä¸æ•´ä¸ªå›¾ç‰‡åŒºåŸŸçš„é¢ç§¯æ¯”ã€‚025 (25%)

- 95_113ï¼šæ°´å¹³å€¾æ–œç¨‹åº¦å’Œå‚ç›´å€¾æ–œåº¦ã€‚æ°´å¹³ 95åº¦ å‚ç›´ 113åº¦

- 154&383_386&473ï¼šå·¦ä¸Šå’Œå³ä¸‹é¡¶ç‚¹çš„åæ ‡ã€‚å·¦ä¸Š(154,383) å³ä¸‹(386,473)

- 386&473_177&454_154&383_363&402ï¼šæ•´ä¸ªå›¾åƒä¸­è½¦ç‰Œçš„å››ä¸ªé¡¶ç‚¹çš„ç²¾ç¡®ï¼ˆxï¼Œyï¼‰åæ ‡ã€‚è¿™äº›åæ ‡ä»å³ä¸‹è§’é¡¶ç‚¹å¼€å§‹ã€‚(386,473) (177,454) (154,383) (363,402)

- 0_0_22_27_27_33_16ï¼šCCPDä¸­çš„æ¯ä¸ªå›¾åƒåªæœ‰ä¸€ä¸ªè½¦ç‰Œã€‚æ¯ä¸ªè½¦ç‰Œå·ç ç”±ä¸€ä¸ªæ±‰å­—ï¼Œä¸€ä¸ªå­—æ¯å’Œäº”ä¸ªå­—æ¯æˆ–æ•°å­—ç»„æˆã€‚æœ‰æ•ˆçš„ä¸­æ–‡è½¦ç‰Œç”±ä¸ƒä¸ªå­—ç¬¦ç»„æˆï¼šçœï¼ˆ1ä¸ªå­—ç¬¦ï¼‰ï¼Œå­—æ¯ï¼ˆ1ä¸ªå­—ç¬¦ï¼‰ï¼Œå­—æ¯+æ•°å­—ï¼ˆ5ä¸ªå­—ç¬¦ï¼‰ã€‚â€œ 0_0_22_27_27_33_16â€æ˜¯æ¯ä¸ªå­—ç¬¦çš„ç´¢å¼•ã€‚è¿™ä¸‰ä¸ªæ•°ç»„å®šä¹‰å¦‚ä¸‹ã€‚æ¯ä¸ªæ•°ç»„çš„æœ€åä¸€ä¸ªå­—ç¬¦æ˜¯å­—æ¯Oï¼Œè€Œä¸æ˜¯æ•°å­—0ã€‚æˆ‘ä»¬å°†Oç”¨ä½œâ€œæ— å­—ç¬¦â€çš„ç¬¦å·ï¼Œå› ä¸ºä¸­æ–‡è½¦ç‰Œå­—ç¬¦ä¸­æ²¡æœ‰Oã€‚å› æ­¤ä»¥ä¸Šè½¦ç‰Œæ‹¼èµ·æ¥å³ä¸º çš–AY339S

- 37ï¼šç‰Œç…§åŒºåŸŸçš„äº®åº¦ã€‚ 37 (37%)

- 15ï¼šè½¦ç‰ŒåŒºåŸŸçš„æ¨¡ç³Šåº¦ã€‚15 (15%)

```python
provinces = ["çš–", "æ²ª", "æ´¥", "æ¸", "å†€", "æ™‹", "è’™", "è¾½", "å‰", "é»‘", "è‹", "æµ™", "äº¬", "é—½", "èµ£", "é²", "è±«", "é„‚", "æ¹˜", "ç²¤", "æ¡‚", "ç¼", "å·", "è´µ", "äº‘", "è—", "é™•", "ç”˜", "é’", "å®", "æ–°", "è­¦", "å­¦", "O"]
alphabets = ['A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'J', 'K', 'L', 'M', 'N', 'P', 'Q', 'R', 'S', 'T', 'U', 'V', 'W','X', 'Y', 'Z', 'O']
ads = ['A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'J', 'K', 'L', 'M', 'N', 'P', 'Q', 'R', 'S', 'T', 'U', 'V', 'W', 'X','Y', 'Z', '0', '1', '2', '3', '4', '5', '6', '7', '8', '9', 'O']
```

### 3.2 åˆ¶ä½œç¬¦åˆPP-OCRè®­ç»ƒæ ¼å¼çš„æ ‡æ³¨æ–‡ä»¶

åœ¨å¼€å§‹è®­ç»ƒä¹‹å‰ï¼Œå¯ä½¿ç”¨å¦‚ä¸‹ä»£ç åˆ¶ä½œç¬¦åˆPP-OCRè®­ç»ƒæ ¼å¼çš„æ ‡æ³¨æ–‡ä»¶ã€‚


```python
import cv2
import os
import json
from tqdm import tqdm
import numpy as np

provinces = ["çš–", "æ²ª", "æ´¥", "æ¸", "å†€", "æ™‹", "è’™", "è¾½", "å‰", "é»‘", "è‹", "æµ™", "äº¬", "é—½", "èµ£", "é²", "è±«", "é„‚", "æ¹˜", "ç²¤", "æ¡‚", "ç¼", "å·", "è´µ", "äº‘", "è—", "é™•", "ç”˜", "é’", "å®", "æ–°", "è­¦", "å­¦", "O"]
alphabets = ['A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'J', 'K', 'L', 'M', 'N', 'P', 'Q', 'R', 'S', 'T', 'U', 'V', 'W', 'X', 'Y', 'Z', 'O']
ads = ['A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'J', 'K', 'L', 'M', 'N', 'P', 'Q', 'R', 'S', 'T', 'U', 'V', 'W', 'X', 'Y', 'Z', '0', '1', '2', '3', '4', '5', '6', '7', '8', '9', 'O']

def make_label(img_dir, save_gt_folder, phase):
    crop_img_save_dir = os.path.join(save_gt_folder, phase, 'crop_imgs')
    os.makedirs(crop_img_save_dir, exist_ok=True)

    f_det = open(os.path.join(save_gt_folder, phase, 'det.txt'), 'w', encoding='utf-8')
    f_rec = open(os.path.join(save_gt_folder, phase, 'rec.txt'), 'w', encoding='utf-8')

    i = 0
    for filename in tqdm(os.listdir(os.path.join(img_dir, phase))):
        str_list = filename.split('-')
        if len(str_list) < 5:
            continue
        coord_list = str_list[3].split('_')
        txt_list = str_list[4].split('_')
        boxes = []
        for coord in coord_list:
            boxes.append([int(x) for x in coord.split("&")])
        boxes = [boxes[2], boxes[3], boxes[0], boxes[1]]
        lp_number = provinces[int(txt_list[0])] + alphabets[int(txt_list[1])] + ''.join([ads[int(x)] for x in txt_list[2:]])

        # det
        det_info = [{'points':boxes, 'transcription':lp_number}]
        f_det.write('{}\t{}\n'.format(os.path.join(phase, filename), json.dumps(det_info, ensure_ascii=False)))

        # rec
        boxes = np.float32(boxes)
        img = cv2.imread(os.path.join(img_dir, phase, filename))
        # crop_img = img[int(boxes[:,1].min()):int(boxes[:,1].max()),int(boxes[:,0].min()):int(boxes[:,0].max())]
        crop_img = get_rotate_crop_image(img, boxes)
        crop_img_save_filename = '{}_{}.jpg'.format(i,'_'.join(txt_list))
        crop_img_save_path = os.path.join(crop_img_save_dir, crop_img_save_filename)
        cv2.imwrite(crop_img_save_path, crop_img)
        f_rec.write('{}/crop_imgs/{}\t{}\n'.format(phase, crop_img_save_filename, lp_number))
        i+=1
    f_det.close()
    f_rec.close()

def get_rotate_crop_image(img, points):
    '''
    img_height, img_width = img.shape[0:2]
    left = int(np.min(points[:, 0]))
    right = int(np.max(points[:, 0]))
    top = int(np.min(points[:, 1]))
    bottom = int(np.max(points[:, 1]))
    img_crop = img[top:bottom, left:right, :].copy()
    points[:, 0] = points[:, 0] - left
    points[:, 1] = points[:, 1] - top
    '''
    assert len(points) == 4, "shape of points must be 4*2"
    img_crop_width = int(
        max(
            np.linalg.norm(points[0] - points[1]),
            np.linalg.norm(points[2] - points[3])))
    img_crop_height = int(
        max(
            np.linalg.norm(points[0] - points[3]),
            np.linalg.norm(points[1] - points[2])))
    pts_std = np.float32([[0, 0], [img_crop_width, 0],
                          [img_crop_width, img_crop_height],
                          [0, img_crop_height]])
    M = cv2.getPerspectiveTransform(points, pts_std)
    dst_img = cv2.warpPerspective(
        img,
        M, (img_crop_width, img_crop_height),
        borderMode=cv2.BORDER_REPLICATE,
        flags=cv2.INTER_CUBIC)
    dst_img_height, dst_img_width = dst_img.shape[0:2]
    if dst_img_height * 1.0 / dst_img_width >= 1.5:
        dst_img = np.rot90(dst_img)
    return dst_img

img_dir = '/home/aistudio/data/CCPD2020/ccpd_green'
save_gt_folder = '/home/aistudio/data/CCPD2020/PPOCR'
# phase = 'train' # change to val and test to make val dataset and test dataset
for phase in ['train','val','test']:
    make_label(img_dir, save_gt_folder, phase)
```

é€šè¿‡ä¸Šè¿°å‘½ä»¤å¯ä»¥å®Œæˆäº†`è®­ç»ƒé›†`ï¼Œ`éªŒè¯é›†`å’Œ`æµ‹è¯•é›†`çš„åˆ¶ä½œï¼Œåˆ¶ä½œå®Œæˆçš„æ•°æ®é›†ä¿¡æ¯å¦‚ä¸‹ï¼š

| ç±»å‹ | æ•°æ®é›† | å›¾ç‰‡åœ°å€ | æ ‡ç­¾åœ°å€ | å›¾ç‰‡æ•°é‡ |
| --- | --- | --- | --- | --- |
| æ£€æµ‹ | è®­ç»ƒé›† | /home/aistudio/data/CCPD2020/ccpd_green/train | /home/aistudio/data/CCPD2020/PPOCR/train/det.txt | 5769 |
| æ£€æµ‹ | éªŒè¯é›† | /home/aistudio/data/CCPD2020/ccpd_green/val | /home/aistudio/data/CCPD2020/PPOCR/val/det.txt | 1001 |
| æ£€æµ‹ | æµ‹è¯•é›† | /home/aistudio/data/CCPD2020/ccpd_green/test | /home/aistudio/data/CCPD2020/PPOCR/test/det.txt | 5006 |
| è¯†åˆ« | è®­ç»ƒé›† | /home/aistudio/data/CCPD2020/PPOCR/train/crop_imgs | /home/aistudio/data/CCPD2020/PPOCR/train/rec.txt | 5769 |
| è¯†åˆ« | éªŒè¯é›† | /home/aistudio/data/CCPD2020/PPOCR/val/crop_imgs | /home/aistudio/data/CCPD2020/PPOCR/val/rec.txt | 1001 |
| è¯†åˆ« | æµ‹è¯•é›† | /home/aistudio/data/CCPD2020/PPOCR/test/crop_imgs | /home/aistudio/data/CCPD2020/PPOCR/test/rec.txt | 5006 |

åœ¨æ™®éçš„æ·±åº¦å­¦ä¹ æµç¨‹ä¸­ï¼Œéƒ½æ˜¯åœ¨è®­ç»ƒé›†è®­ç»ƒï¼Œåœ¨éªŒè¯é›†é€‰æ‹©æœ€ä¼˜æ¨¡å‹ååœ¨æµ‹è¯•é›†ä¸Šè¿›è¡Œæµ‹è¯•ã€‚åœ¨æœ¬ä¾‹ä¸­ï¼Œæˆ‘ä»¬çœç•¥ä¸­é—´æ­¥éª¤ï¼Œç›´æ¥åœ¨è®­ç»ƒé›†è®­ç»ƒï¼Œåœ¨æµ‹è¯•é›†é€‰æ‹©æœ€ä¼˜æ¨¡å‹ï¼Œå› æ­¤æˆ‘ä»¬åªä½¿ç”¨è®­ç»ƒé›†å’Œæµ‹è¯•é›†ã€‚

## 4. å®éªŒ

ç”±äºæ•°æ®é›†æ¯”è¾ƒå°‘ï¼Œä¸ºäº†æ¨¡å‹æ›´å¥½å’Œæ›´å¿«çš„æ”¶æ•›ï¼Œè¿™é‡Œé€‰ç”¨ PaddleOCR ä¸­çš„ PP-OCRv3 æ¨¡å‹è¿›è¡Œæ–‡æœ¬æ£€æµ‹å’Œè¯†åˆ«ï¼Œå¹¶ä¸”ä½¿ç”¨ PP-OCRv3 æ¨¡å‹å‚æ•°ä½œä¸ºé¢„è®­ç»ƒæ¨¡å‹ã€‚PP-OCRv3åœ¨PP-OCRv2çš„åŸºç¡€ä¸Šï¼Œä¸­æ–‡åœºæ™¯ç«¯åˆ°ç«¯HmeanæŒ‡æ ‡ç›¸æ¯”äºPP-OCRv2æå‡5%, è‹±æ–‡æ•°å­—æ¨¡å‹ç«¯åˆ°ç«¯æ•ˆæœæå‡11%ã€‚è¯¦ç»†ä¼˜åŒ–ç»†èŠ‚è¯·å‚è€ƒ[PP-OCRv3](../doc/doc_ch/PP-OCRv3_introduction.md)æŠ€æœ¯æŠ¥å‘Šã€‚

ç”±äºè½¦ç‰Œåœºæ™¯å‡ä¸ºç«¯ä¾§è®¾å¤‡éƒ¨ç½²ï¼Œå› æ­¤å¯¹é€Ÿåº¦å’Œæ¨¡å‹å¤§å°æœ‰æ¯”è¾ƒé«˜çš„è¦æ±‚ï¼Œå› æ­¤è¿˜éœ€è¦é‡‡ç”¨é‡åŒ–è®­ç»ƒçš„æ–¹å¼è¿›è¡Œæ¨¡å‹å¤§å°çš„å‹ç¼©å’Œæ¨¡å‹æ¨ç†é€Ÿåº¦çš„åŠ é€Ÿã€‚æ¨¡å‹é‡åŒ–å¯ä»¥åœ¨åŸºæœ¬ä¸æŸå¤±æ¨¡å‹çš„ç²¾åº¦çš„æƒ…å†µä¸‹ï¼Œå°†FP32ç²¾åº¦çš„æ¨¡å‹å‚æ•°è½¬æ¢ä¸ºInt8ç²¾åº¦ï¼Œå‡å°æ¨¡å‹å‚æ•°å¤§å°å¹¶åŠ é€Ÿè®¡ç®—ï¼Œä½¿ç”¨é‡åŒ–åçš„æ¨¡å‹åœ¨ç§»åŠ¨ç«¯ç­‰éƒ¨ç½²æ—¶æ›´å…·å¤‡é€Ÿåº¦ä¼˜åŠ¿ã€‚

å› æ­¤ï¼Œæœ¬å®éªŒä¸­å¯¹äºè½¦ç‰Œæ£€æµ‹å’Œè¯†åˆ«æœ‰å¦‚ä¸‹3ç§æ–¹æ¡ˆï¼š

1. PP-OCRv3ä¸­è‹±æ–‡è¶…è½»é‡é¢„è®­ç»ƒæ¨¡å‹ç›´æ¥é¢„æµ‹
2. CCPDè½¦ç‰Œæ•°æ®é›†åœ¨PP-OCRv3æ¨¡å‹ä¸Šfine-tune
3. CCPDè½¦ç‰Œæ•°æ®é›†åœ¨PP-OCRv3æ¨¡å‹ä¸Šfine-tuneåé‡åŒ–

### 4.1 æ£€æµ‹
#### 4.1.1 é¢„è®­ç»ƒæ¨¡å‹ç›´æ¥é¢„æµ‹

ä»ä¸‹è¡¨ä¸­ä¸‹è½½PP-OCRv3æ–‡æœ¬æ£€æµ‹é¢„è®­ç»ƒæ¨¡å‹

|æ¨¡å‹åç§°|æ¨¡å‹ç®€ä»‹|é…ç½®æ–‡ä»¶|æ¨ç†æ¨¡å‹å¤§å°|ä¸‹è½½åœ°å€|
| --- | --- | --- | --- | --- |
|ch_PP-OCRv3_det| ã€æœ€æ–°ã€‘åŸå§‹è¶…è½»é‡æ¨¡å‹ï¼Œæ”¯æŒä¸­è‹±æ–‡ã€å¤šè¯­ç§æ–‡æœ¬æ£€æµ‹ |[ch_PP-OCRv3_det_cml.yml](https://github.com/PaddlePaddle/PaddleOCR/blob/dygraph/configs/det/ch_PP-OCRv3/ch_PP-OCRv3_det_cml.yml)| 3.8M |[æ¨ç†æ¨¡å‹](https://paddleocr.bj.bcebos.com/PP-OCRv3/chinese/ch_PP-OCRv3_det_infer.tar) / [è®­ç»ƒæ¨¡å‹](https://paddleocr.bj.bcebos.com/PP-OCRv3/chinese/ch_PP-OCRv3_det_distill_train.tar)|

ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤ä¸‹è½½é¢„è®­ç»ƒæ¨¡å‹

```bash
mkdir models
cd models
wget https://paddleocr.bj.bcebos.com/PP-OCRv3/chinese/ch_PP-OCRv3_det_distill_train.tar
tar -xf ch_PP-OCRv3_det_distill_train.tar
cd /home/aistudio/PaddleOCR
```

é¢„è®­ç»ƒæ¨¡å‹ä¸‹è½½å®Œæˆåï¼Œæˆ‘ä»¬ä½¿ç”¨[ch_PP-OCRv3_det_student.yml](../configs/det/ch_PP-OCRv3/ch_PP-OCRv3_det_student.yml) é…ç½®æ–‡ä»¶è¿›è¡Œåç»­å®éªŒï¼Œåœ¨å¼€å§‹è¯„ä¼°ä¹‹å‰éœ€è¦å¯¹é…ç½®æ–‡ä»¶ä¸­éƒ¨åˆ†å­—æ®µè¿›è¡Œè®¾ç½®ï¼Œå…·ä½“å¦‚ä¸‹ï¼š

1. æ¨¡å‹å­˜å‚¨å’Œè®­ç»ƒç›¸å…³:
   1. Global.pretrained_model: æŒ‡å‘PP-OCRv3æ–‡æœ¬æ£€æµ‹é¢„è®­ç»ƒæ¨¡å‹åœ°å€
2. æ•°æ®é›†ç›¸å…³
   1. Eval.dataset.data_dirï¼šæŒ‡å‘æµ‹è¯•é›†å›¾ç‰‡å­˜æ”¾ç›®å½•
   2. Eval.dataset.label_file_listï¼šæŒ‡å‘æµ‹è¯•é›†æ ‡æ³¨æ–‡ä»¶

ä¸Šè¿°å­—æ®µå‡ä¸ºå¿…é¡»ä¿®æ”¹çš„å­—æ®µï¼Œå¯ä»¥é€šè¿‡ä¿®æ”¹é…ç½®æ–‡ä»¶çš„æ–¹å¼æ”¹åŠ¨ï¼Œä¹Ÿå¯åœ¨ä¸éœ€è¦ä¿®æ”¹é…ç½®æ–‡ä»¶çš„æƒ…å†µä¸‹ï¼Œæ”¹å˜è®­ç»ƒçš„å‚æ•°ã€‚è¿™é‡Œä½¿ç”¨ä¸æ”¹å˜é…ç½®æ–‡ä»¶çš„æ–¹å¼ ã€‚ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤è¿›è¡ŒPP-OCRv3æ–‡æœ¬æ£€æµ‹é¢„è®­ç»ƒæ¨¡å‹çš„è¯„ä¼°


```bash
python tools/eval.py -c configs/det/ch_PP-OCRv3/ch_PP-OCRv3_det_student.yml -o \
    Global.pretrained_model=models/ch_PP-OCRv3_det_distill_train/student.pdparams \
    Eval.dataset.data_dir=/home/aistudio/data/CCPD2020/ccpd_green \
    Eval.dataset.label_file_list=[/home/aistudio/data/CCPD2020/PPOCR/test/det.txt]
```
ä¸Šè¿°æŒ‡ä»¤ä¸­ï¼Œé€šè¿‡-c é€‰æ‹©è®­ç»ƒä½¿ç”¨é…ç½®æ–‡ä»¶ï¼Œé€šè¿‡-oå‚æ•°åœ¨ä¸éœ€è¦ä¿®æ”¹é…ç½®æ–‡ä»¶çš„æƒ…å†µä¸‹ï¼Œæ”¹å˜è®­ç»ƒçš„å‚æ•°ã€‚

ä½¿ç”¨é¢„è®­ç»ƒæ¨¡å‹è¿›è¡Œè¯„ä¼°ï¼ŒæŒ‡æ ‡å¦‚ä¸‹æ‰€ç¤ºï¼š

| æ–¹æ¡ˆ                        |hmeans|
|---------------------------|---|
| PP-OCRv3ä¸­è‹±æ–‡è¶…è½»é‡æ£€æµ‹é¢„è®­ç»ƒæ¨¡å‹ç›´æ¥é¢„æµ‹ |76.12%|

#### 4.1.2 CCPDè½¦ç‰Œæ•°æ®é›†fine-tune

**è®­ç»ƒ**

ä¸ºäº†è¿›è¡Œfine-tuneè®­ç»ƒï¼Œæˆ‘ä»¬éœ€è¦åœ¨é…ç½®æ–‡ä»¶ä¸­è®¾ç½®éœ€è¦ä½¿ç”¨çš„é¢„è®­ç»ƒæ¨¡å‹åœ°å€ï¼Œå­¦ä¹ ç‡å’Œæ•°æ®é›†ç­‰å‚æ•°ã€‚ å…·ä½“å¦‚ä¸‹:

1. æ¨¡å‹å­˜å‚¨å’Œè®­ç»ƒç›¸å…³:
   1. Global.pretrained_model: æŒ‡å‘PP-OCRv3æ–‡æœ¬æ£€æµ‹é¢„è®­ç»ƒæ¨¡å‹åœ°å€
   2. Global.eval_batch_step: æ¨¡å‹å¤šå°‘stepè¯„ä¼°ä¸€æ¬¡ï¼Œè¿™é‡Œè®¾ä¸ºä»ç¬¬0ä¸ªstepå¼€å§‹æ²¡éš”772ä¸ªstepè¯„ä¼°ä¸€æ¬¡ï¼Œ772ä¸ºä¸€ä¸ªepochæ€»çš„stepæ•°ã€‚
2. ä¼˜åŒ–å™¨ç›¸å…³:
   1. Optimizer.lr.name: å­¦ä¹ ç‡è¡°å‡å™¨è®¾ä¸ºå¸¸é‡ Const
   2. Optimizer.lr.learning_rate: åš fine-tune å®éªŒï¼Œå­¦ä¹ ç‡éœ€è¦è®¾ç½®çš„æ¯”è¾ƒå°ï¼Œæ­¤å¤„å­¦ä¹ ç‡è®¾ä¸ºé…ç½®æ–‡ä»¶ä¸­çš„0.05å€
   3. Optimizer.lr.warmup_epoch: warmup_epochè®¾ä¸º0
3. æ•°æ®é›†ç›¸å…³:
   1. Train.dataset.data_dirï¼šæŒ‡å‘è®­ç»ƒé›†å›¾ç‰‡å­˜æ”¾ç›®å½•
   2. Train.dataset.label_file_listï¼šæŒ‡å‘è®­ç»ƒé›†æ ‡æ³¨æ–‡ä»¶
   3. Eval.dataset.data_dirï¼šæŒ‡å‘æµ‹è¯•é›†å›¾ç‰‡å­˜æ”¾ç›®å½•
   4. Eval.dataset.label_file_listï¼šæŒ‡å‘æµ‹è¯•é›†æ ‡æ³¨æ–‡ä»¶

ä½¿ç”¨å¦‚ä¸‹ä»£ç å³å¯å¯åŠ¨åœ¨CCPDè½¦ç‰Œæ•°æ®é›†ä¸Šçš„fine-tuneã€‚

```bash
python tools/train.py -c configs/det/ch_PP-OCRv3/ch_PP-OCRv3_det_student.yml -o \
    Global.pretrained_model=models/ch_PP-OCRv3_det_distill_train/student.pdparams \
    Global.save_model_dir=output/CCPD/det \
    Global.eval_batch_step="[0, 772]" \
    Optimizer.lr.name=Const \
    Optimizer.lr.learning_rate=0.0005 \
    Optimizer.lr.warmup_epoch=0 \
    Train.dataset.data_dir=/home/aistudio/data/CCPD2020/ccpd_green \
    Train.dataset.label_file_list=[/home/aistudio/data/CCPD2020/PPOCR/train/det.txt] \
    Eval.dataset.data_dir=/home/aistudio/data/CCPD2020/ccpd_green \
    Eval.dataset.label_file_list=[/home/aistudio/data/CCPD2020/PPOCR/test/det.txt]
```

åœ¨ä¸Šè¿°å‘½ä»¤ä¸­ï¼Œé€šè¿‡`-o`çš„æ–¹å¼ä¿®æ”¹äº†é…ç½®æ–‡ä»¶ä¸­çš„å‚æ•°ã€‚


**è¯„ä¼°**

è®­ç»ƒå®Œæˆåä½¿ç”¨å¦‚ä¸‹å‘½ä»¤è¿›è¡Œè¯„ä¼°


```bash
python tools/eval.py -c configs/det/ch_PP-OCRv3/ch_PP-OCRv3_det_student.yml -o \
    Global.pretrained_model=output/CCPD/det/best_accuracy.pdparams \
    Eval.dataset.data_dir=/home/aistudio/data/CCPD2020/ccpd_green \
    Eval.dataset.label_file_list=[/home/aistudio/data/CCPD2020/PPOCR/test/det.txt]
```

ä½¿ç”¨é¢„è®­ç»ƒæ¨¡å‹å’ŒCCPDè½¦ç‰Œæ•°æ®é›†fine-tuneï¼ŒæŒ‡æ ‡åˆ†åˆ«å¦‚ä¸‹ï¼š

|æ–¹æ¡ˆ|hmeans|
|---|---|
|PP-OCRv3ä¸­è‹±æ–‡è¶…è½»é‡æ£€æµ‹é¢„è®­ç»ƒæ¨¡å‹ç›´æ¥é¢„æµ‹|76.12%|
|PP-OCRv3ä¸­è‹±æ–‡è¶…è½»é‡æ£€æµ‹é¢„è®­ç»ƒæ¨¡å‹ fine-tune|99.00%|

å¯ä»¥çœ‹åˆ°è¿›è¡Œfine-tuneèƒ½æ˜¾è‘—æå‡è½¦ç‰Œæ£€æµ‹çš„æ•ˆæœã€‚

#### 4.1.3 CCPDè½¦ç‰Œæ•°æ®é›†fine-tune+é‡åŒ–è®­ç»ƒ

æ­¤å¤„é‡‡ç”¨ PaddleOCR ä¸­æä¾›å¥½çš„[é‡åŒ–æ•™ç¨‹](../deploy/slim/quantization/README.md)å¯¹æ¨¡å‹è¿›è¡Œé‡åŒ–è®­ç»ƒã€‚

é‡åŒ–è®­ç»ƒå¯é€šè¿‡å¦‚ä¸‹å‘½ä»¤å¯åŠ¨:

```bash
python3.7 deploy/slim/quantization/quant.py -c configs/det/ch_PP-OCRv3/ch_PP-OCRv3_det_student.yml -o \
    Global.pretrained_model=output/CCPD/det/best_accuracy.pdparams \
    Global.save_model_dir=output/CCPD/det_quant \
    Global.eval_batch_step="[0, 772]" \
    Optimizer.lr.name=Const \
    Optimizer.lr.learning_rate=0.0005 \
    Optimizer.lr.warmup_epoch=0 \
    Train.dataset.data_dir=/home/aistudio/data/CCPD2020/ccpd_green \
    Train.dataset.label_file_list=[/home/aistudio/data/CCPD2020/PPOCR/train/det.txt] \
    Eval.dataset.data_dir=/home/aistudio/data/CCPD2020/ccpd_green \
    Eval.dataset.label_file_list=[/home/aistudio/data/CCPD2020/PPOCR/test/det.txt]
```

é‡åŒ–åæŒ‡æ ‡å¯¹æ¯”å¦‚ä¸‹

|æ–¹æ¡ˆ|hmeans| æ¨¡å‹å¤§å° | é¢„æµ‹é€Ÿåº¦(lite) |
|---|---|------|------------|
|PP-OCRv3ä¸­è‹±æ–‡è¶…è½»é‡æ£€æµ‹é¢„è®­ç»ƒæ¨¡å‹ fine-tune|99.00%| 2.5M | 223ms      |
|PP-OCRv3ä¸­è‹±æ–‡è¶…è½»é‡æ£€æµ‹é¢„è®­ç»ƒæ¨¡å‹ fine-tune+é‡åŒ–|98.91%| 1.0M   | 189ms      |

å¯ä»¥çœ‹åˆ°é€šè¿‡é‡åŒ–è®­ç»ƒåœ¨ç²¾åº¦å‡ ä¹æ— æŸçš„æƒ…å†µä¸‹ï¼Œé™ä½æ¨¡å‹ä½“ç§¯60%å¹¶ä¸”æ¨ç†é€Ÿåº¦æå‡15%ã€‚

é€Ÿåº¦æµ‹è¯•åŸºäº[PaddleOCR liteæ•™ç¨‹](../deploy/lite/readme_ch.md)å®Œæˆã€‚

#### 4.1.4 æ¨¡å‹å¯¼å‡º

ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤å¯ä»¥å°†è®­ç»ƒå¥½çš„æ¨¡å‹è¿›è¡Œå¯¼å‡º

* éé‡åŒ–æ¨¡å‹
```bash
python tools/export_model.py -c configs/det/ch_PP-OCRv3/ch_PP-OCRv3_det_student.yml -o \
    Global.pretrained_model=output/CCPD/det/best_accuracy.pdparams \
    Global.save_inference_dir=output/det/infer
```
* é‡åŒ–æ¨¡å‹
```bash
python deploy/slim/quantization/export_model.py -c configs/det/ch_PP-OCRv3/ch_PP-OCRv3_det_student.yml -o \
    Global.pretrained_model=output/CCPD/det_quant/best_accuracy.pdparams \
    Global.save_inference_dir=output/det/infer
```

### 4.2 è¯†åˆ«
#### 4.2.1 é¢„è®­ç»ƒæ¨¡å‹ç›´æ¥é¢„æµ‹

ä»ä¸‹è¡¨ä¸­ä¸‹è½½PP-OCRv3æ–‡æœ¬è¯†åˆ«é¢„è®­ç»ƒæ¨¡å‹

|æ¨¡å‹åç§°|æ¨¡å‹ç®€ä»‹|é…ç½®æ–‡ä»¶|æ¨ç†æ¨¡å‹å¤§å°|ä¸‹è½½åœ°å€|
| --- | --- | --- | --- | --- |
|ch_PP-OCRv3_rec|ã€æœ€æ–°ã€‘åŸå§‹è¶…è½»é‡æ¨¡å‹ï¼Œæ”¯æŒä¸­è‹±æ–‡ã€æ•°å­—è¯†åˆ«|[ch_PP-OCRv3_rec_distillation.yml](https://github.com/PaddlePaddle/PaddleOCR/blob/dygraph/configs/rec/PP-OCRv3/ch_PP-OCRv3_rec_distillation.yml)| 12.4M |[æ¨ç†æ¨¡å‹](https://paddleocr.bj.bcebos.com/PP-OCRv3/chinese/ch_PP-OCRv3_rec_infer.tar) / [è®­ç»ƒæ¨¡å‹](https://paddleocr.bj.bcebos.com/PP-OCRv3/chinese/ch_PP-OCRv3_rec_train.tar) |

ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤ä¸‹è½½é¢„è®­ç»ƒæ¨¡å‹

```bash
mkdir models
cd models
wget https://paddleocr.bj.bcebos.com/PP-OCRv3/chinese/ch_PP-OCRv3_rec_train.tar
tar -xf ch_PP-OCRv3_rec_train.tar
cd /home/aistudio/PaddleOCR
```

PaddleOCRæä¾›çš„PP-OCRv3è¯†åˆ«æ¨¡å‹é‡‡ç”¨è’¸é¦è®­ç»ƒç­–ç•¥ï¼Œå› æ­¤æä¾›çš„é¢„è®­ç»ƒæ¨¡å‹ä¸­ä¼šåŒ…å«`Teacher`å’Œ`Student`æ¨¡å‹çš„å‚æ•°ï¼Œè¯¦ç»†ä¿¡æ¯å¯å‚è€ƒ[knowledge_distillation.md](../doc/doc_ch/knowledge_distillation.md)ã€‚ å› æ­¤ï¼Œæ¨¡å‹ä¸‹è½½å®Œæˆåéœ€è¦ä½¿ç”¨å¦‚ä¸‹ä»£ç æå–`Student`æ¨¡å‹çš„å‚æ•°ï¼š

```python
import paddle
# åŠ è½½é¢„è®­ç»ƒæ¨¡å‹
all_params = paddle.load("models/ch_PP-OCRv3_rec_train/best_accuracy.pdparams")
# æŸ¥çœ‹æƒé‡å‚æ•°çš„keys
print(all_params.keys())
# å­¦ç”Ÿæ¨¡å‹çš„æƒé‡æå–
s_params = {key[len("Student."):]: all_params[key] for key in all_params if "Student." in key}
# æŸ¥çœ‹å­¦ç”Ÿæ¨¡å‹æƒé‡å‚æ•°çš„keys
print(s_params.keys())
# ä¿å­˜
paddle.save(s_params, "models/ch_PP-OCRv3_rec_train/student.pdparams")
```

é¢„è®­ç»ƒæ¨¡å‹ä¸‹è½½å®Œæˆåï¼Œæˆ‘ä»¬ä½¿ç”¨[ch_PP-OCRv3_rec.yml](../configs/rec/PP-OCRv3/ch_PP-OCRv3_rec.yml) é…ç½®æ–‡ä»¶è¿›è¡Œåç»­å®éªŒï¼Œåœ¨å¼€å§‹è¯„ä¼°ä¹‹å‰éœ€è¦å¯¹é…ç½®æ–‡ä»¶ä¸­éƒ¨åˆ†å­—æ®µè¿›è¡Œè®¾ç½®ï¼Œå…·ä½“å¦‚ä¸‹ï¼š

1. æ¨¡å‹å­˜å‚¨å’Œè®­ç»ƒç›¸å…³:
   1. Global.pretrained_model: æŒ‡å‘PP-OCRv3æ–‡æœ¬è¯†åˆ«é¢„è®­ç»ƒæ¨¡å‹åœ°å€
2. æ•°æ®é›†ç›¸å…³
   1. Eval.dataset.data_dirï¼šæŒ‡å‘æµ‹è¯•é›†å›¾ç‰‡å­˜æ”¾ç›®å½•
   2. Eval.dataset.label_file_listï¼šæŒ‡å‘æµ‹è¯•é›†æ ‡æ³¨æ–‡ä»¶

ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤è¿›è¡ŒPP-OCRv3æ–‡æœ¬è¯†åˆ«é¢„è®­ç»ƒæ¨¡å‹çš„è¯„ä¼°

```bash
python tools/eval.py -c configs/rec/PP-OCRv3/ch_PP-OCRv3_rec.yml -o \
    Global.pretrained_model=models/ch_PP-OCRv3_rec_train/student.pdparams \
    Eval.dataset.data_dir=/home/aistudio/data/CCPD2020/PPOCR \
    Eval.dataset.label_file_list=[/home/aistudio/data/CCPD2020/PPOCR/test/rec.txt]
```

å¦‚éœ€è·å–å·²è®­ç»ƒæ¨¡å‹ï¼Œè¯·æ‰«ç å¡«å†™é—®å·ï¼ŒåŠ å…¥PaddleOCRå®˜æ–¹äº¤æµç¾¤è·å–å…¨éƒ¨OCRå‚ç±»æ¨¡å‹ä¸‹è½½é“¾æ¥ã€ã€ŠåŠ¨æ‰‹å­¦OCRã€‹ç”µå­ä¹¦ç­‰å…¨å¥—OCRå­¦ä¹ èµ„æ–™ğŸ
<div align="left">
<img src="https://ai-studio-static-online.cdn.bcebos.com/dd721099bd50478f9d5fb13d8dd00fad69c22d6848244fd3a1d3980d7fefc63e"  width = "150" height = "150" />
</div>


è¯„ä¼°éƒ¨åˆ†æ—¥å¿—å¦‚ä¸‹ï¼š
```bash
[2022/05/12 19:52:02] ppocr INFO: load pretrain successful from models/ch_PP-OCRv3_rec_train/best_accuracy
eval model:: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 40/40 [00:15<00:00,  2.57it/s]
[2022/05/12 19:52:17] ppocr INFO: metric eval ***************
[2022/05/12 19:52:17] ppocr INFO: acc:0.0
[2022/05/12 19:52:17] ppocr INFO: norm_edit_dis:0.8656084923002452
[2022/05/12 19:52:17] ppocr INFO: Teacher_acc:0.000399520574511545
[2022/05/12 19:52:17] ppocr INFO: Teacher_norm_edit_dis:0.8657902943394548
[2022/05/12 19:52:17] ppocr INFO: fps:1443.1801978719905

```
ä½¿ç”¨é¢„è®­ç»ƒæ¨¡å‹è¿›è¡Œè¯„ä¼°ï¼ŒæŒ‡æ ‡å¦‚ä¸‹æ‰€ç¤ºï¼š

|æ–¹æ¡ˆ|acc|
|---|---|
|PP-OCRv3ä¸­è‹±æ–‡è¶…è½»é‡è¯†åˆ«é¢„è®­ç»ƒæ¨¡å‹ç›´æ¥é¢„æµ‹|0%|

ä»è¯„ä¼°æ—¥å¿—ä¸­å¯ä»¥çœ‹åˆ°ï¼Œç›´æ¥ä½¿ç”¨PP-OCRv3é¢„è®­ç»ƒæ¨¡å‹è¿›è¡Œè¯„ä¼°ï¼Œaccéå¸¸ä½ï¼Œä½†æ˜¯norm_edit_diså¾ˆé«˜ã€‚å› æ­¤ï¼Œæˆ‘ä»¬çŒœæµ‹æ˜¯æ¨¡å‹å¤§éƒ¨åˆ†æ–‡å­—è¯†åˆ«æ˜¯å¯¹çš„ï¼Œåªæœ‰å°‘éƒ¨åˆ†æ–‡å­—è¯†åˆ«é”™è¯¯ã€‚ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤è¿›è¡ŒinferæŸ¥çœ‹æ¨¡å‹çš„æ¨ç†ç»“æœè¿›è¡ŒéªŒè¯ï¼š


```bash
python tools/infer_rec.py -c configs/rec/PP-OCRv3/ch_PP-OCRv3_rec.yml -o \
    Global.pretrained_model=models/ch_PP-OCRv3_rec_train/student.pdparams \
    Global.infer_img=/home/aistudio/data/CCPD2020/PPOCR/test/crop_imgs/0_0_0_3_32_30_31_30_30.jpg
```

è¾“å‡ºéƒ¨åˆ†æ—¥å¿—å¦‚ä¸‹ï¼š
```bash
[2022/05/01 08:51:57] ppocr INFO: train with paddle 2.2.2 and device CUDAPlace(0)
W0501 08:51:57.127391 11326 device_context.cc:447] Please NOTE: device: 0, GPU Compute Capability: 7.0, Driver API Version: 11.0, Runtime API Version: 10.1
W0501 08:51:57.132315 11326 device_context.cc:465] device: 0, cuDNN Version: 7.6.
[2022/05/01 08:52:00] ppocr INFO: load pretrain successful from models/ch_PP-OCRv3_rec_train/student
[2022/05/01 08:52:00] ppocr INFO: infer_img: /home/aistudio/data/CCPD2020/PPOCR/test/crop_imgs/0_0_3_32_30_31_30_30.jpg
[2022/05/01 08:52:00] ppocr INFO:      result: {"Student": {"label": "çš–AÂ·D86766", "score": 0.9552637934684753}, "Teacher": {"label": "çš–AÂ·D86766", "score": 0.9917094707489014}}
[2022/05/01 08:52:00] ppocr INFO: success!
```

ä»inferç»“æœå¯ä»¥çœ‹åˆ°ï¼Œè½¦ç‰Œä¸­çš„æ–‡å­—å¤§éƒ¨åˆ†éƒ½è¯†åˆ«æ­£ç¡®ï¼Œåªæ˜¯å¤šè¯†åˆ«å‡ºäº†ä¸€ä¸ª`Â·`ã€‚é’ˆå¯¹è¿™ç§æƒ…å†µï¼Œæœ‰å¦‚ä¸‹ä¸¤ç§æ–¹æ¡ˆï¼š
1. ç›´æ¥é€šè¿‡åå¤„ç†å»æ‰å¤šè¯†åˆ«çš„`Â·`ã€‚
2. è¿›è¡Œ fine-tuneã€‚

#### 4.2.2 é¢„è®­ç»ƒæ¨¡å‹ç›´æ¥é¢„æµ‹+æ”¹åŠ¨åå¤„ç†

ç›´æ¥é€šè¿‡åå¤„ç†å»æ‰å¤šè¯†åˆ«çš„`Â·`ï¼Œåœ¨åå¤„ç†çš„æ”¹åŠ¨æ¯”è¾ƒç®€å•ï¼Œåªéœ€åœ¨ [ppocr/postprocess/rec_postprocess.py](../ppocr/postprocess/rec_postprocess.py) æ–‡ä»¶çš„76è¡Œæ·»åŠ å¦‚ä¸‹ä»£ç :
```python
text = text.replace('Â·','')
```

æ”¹åŠ¨å‰åæŒ‡æ ‡å¯¹æ¯”:

|æ–¹æ¡ˆ|acc|
|---|---|
|PP-OCRv3ä¸­è‹±æ–‡è¶…è½»é‡è¯†åˆ«é¢„è®­ç»ƒæ¨¡å‹ç›´æ¥é¢„æµ‹|0.20%|
|PP-OCRv3ä¸­è‹±æ–‡è¶…è½»é‡è¯†åˆ«é¢„è®­ç»ƒæ¨¡å‹ç›´æ¥é¢„æµ‹+åå¤„ç†å»æ‰å¤šè¯†åˆ«çš„`Â·`|90.97%|

å¯ä»¥çœ‹åˆ°ï¼Œå»æ‰å¤šä½™çš„`Â·`èƒ½å¤§å¹…æé«˜ç²¾åº¦ã€‚

#### 4.2.3 CCPDè½¦ç‰Œæ•°æ®é›†fine-tune

**è®­ç»ƒ**

ä¸ºäº†è¿›è¡Œfine-tuneè®­ç»ƒï¼Œæˆ‘ä»¬éœ€è¦åœ¨é…ç½®æ–‡ä»¶ä¸­è®¾ç½®éœ€è¦ä½¿ç”¨çš„é¢„è®­ç»ƒæ¨¡å‹åœ°å€ï¼Œå­¦ä¹ ç‡å’Œæ•°æ®é›†ç­‰å‚æ•°ã€‚ å…·ä½“å¦‚ä¸‹:

1. æ¨¡å‹å­˜å‚¨å’Œè®­ç»ƒç›¸å…³:
   1. Global.pretrained_model: æŒ‡å‘PP-OCRv3æ–‡æœ¬è¯†åˆ«é¢„è®­ç»ƒæ¨¡å‹åœ°å€
   2. Global.eval_batch_step: æ¨¡å‹å¤šå°‘stepè¯„ä¼°ä¸€æ¬¡ï¼Œè¿™é‡Œè®¾ä¸ºä»ç¬¬0ä¸ªstepå¼€å§‹æ²¡éš”45ä¸ªstepè¯„ä¼°ä¸€æ¬¡ï¼Œ45ä¸ºä¸€ä¸ªepochæ€»çš„stepæ•°ã€‚
2. ä¼˜åŒ–å™¨ç›¸å…³
   1. Optimizer.lr.name: å­¦ä¹ ç‡è¡°å‡å™¨è®¾ä¸ºå¸¸é‡ Const
   2. Optimizer.lr.learning_rate: åš fine-tune å®éªŒï¼Œå­¦ä¹ ç‡éœ€è¦è®¾ç½®çš„æ¯”è¾ƒå°ï¼Œæ­¤å¤„å­¦ä¹ ç‡è®¾ä¸ºé…ç½®æ–‡ä»¶ä¸­çš„0.05å€
   3. Optimizer.lr.warmup_epoch: warmup_epochè®¾ä¸º0
3. æ•°æ®é›†ç›¸å…³
   1. Train.dataset.data_dirï¼šæŒ‡å‘è®­ç»ƒé›†å›¾ç‰‡å­˜æ”¾ç›®å½•
   2. Train.dataset.label_file_listï¼šæŒ‡å‘è®­ç»ƒé›†æ ‡æ³¨æ–‡ä»¶
   3. Eval.dataset.data_dirï¼šæŒ‡å‘æµ‹è¯•é›†å›¾ç‰‡å­˜æ”¾ç›®å½•
   4. Eval.dataset.label_file_listï¼šæŒ‡å‘æµ‹è¯•é›†æ ‡æ³¨æ–‡ä»¶

ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤å¯åŠ¨ fine-tune

```bash
python tools/train.py -c configs/rec/PP-OCRv3/ch_PP-OCRv3_rec.yml -o \
    Global.pretrained_model=models/ch_PP-OCRv3_rec_train/student.pdparams \
    Global.save_model_dir=output/CCPD/rec/ \
    Global.eval_batch_step="[0, 90]" \
    Optimizer.lr.name=Const \
    Optimizer.lr.learning_rate=0.0005 \
    Optimizer.lr.warmup_epoch=0 \
    Train.dataset.data_dir=/home/aistudio/data/CCPD2020/PPOCR \
    Train.dataset.label_file_list=[/home/aistudio/data/CCPD2020/PPOCR/train/rec.txt] \
    Eval.dataset.data_dir=/home/aistudio/data/CCPD2020/PPOCR \
    Eval.dataset.label_file_list=[/home/aistudio/data/CCPD2020/PPOCR/test/rec.txt]
```

**è¯„ä¼°**

è®­ç»ƒå®Œæˆåä½¿ç”¨å¦‚ä¸‹å‘½ä»¤è¿›è¡Œè¯„ä¼°

```bash
python tools/eval.py -c configs/rec/PP-OCRv3/ch_PP-OCRv3_rec.yml -o \
    Global.pretrained_model=output/CCPD/rec/best_accuracy.pdparams \
    Eval.dataset.data_dir=/home/aistudio/data/CCPD2020/PPOCR \
    Eval.dataset.label_file_list=[/home/aistudio/data/CCPD2020/PPOCR/test/rec.txt]
```

ä½¿ç”¨é¢„è®­ç»ƒæ¨¡å‹å’ŒCCPDè½¦ç‰Œæ•°æ®é›†fine-tuneï¼ŒæŒ‡æ ‡åˆ†åˆ«å¦‚ä¸‹ï¼š

|æ–¹æ¡ˆ| acc    |
|---|--------|
|PP-OCRv3ä¸­è‹±æ–‡è¶…è½»é‡è¯†åˆ«é¢„è®­ç»ƒæ¨¡å‹ç›´æ¥é¢„æµ‹| 0.00%     |
|PP-OCRv3ä¸­è‹±æ–‡è¶…è½»é‡è¯†åˆ«é¢„è®­ç»ƒæ¨¡å‹ç›´æ¥é¢„æµ‹+åå¤„ç†å»æ‰å¤šè¯†åˆ«çš„`Â·`| 90.97% |
|PP-OCRv3ä¸­è‹±æ–‡è¶…è½»é‡è¯†åˆ«é¢„è®­ç»ƒæ¨¡å‹ fine-tune| 94.54% |

å¯ä»¥çœ‹åˆ°è¿›è¡Œfine-tuneèƒ½æ˜¾è‘—æå‡è½¦ç‰Œè¯†åˆ«çš„æ•ˆæœã€‚

#### 4.2.4 CCPDè½¦ç‰Œæ•°æ®é›†fine-tune+é‡åŒ–è®­ç»ƒ

æ­¤å¤„é‡‡ç”¨ PaddleOCR ä¸­æä¾›å¥½çš„[é‡åŒ–æ•™ç¨‹](../deploy/slim/quantization/README.md)å¯¹æ¨¡å‹è¿›è¡Œé‡åŒ–è®­ç»ƒã€‚

é‡åŒ–è®­ç»ƒå¯é€šè¿‡å¦‚ä¸‹å‘½ä»¤å¯åŠ¨:

```bash
python3.7 deploy/slim/quantization/quant.py -c configs/rec/PP-OCRv3/ch_PP-OCRv3_rec.yml -o \
    Global.pretrained_model=output/CCPD/rec/best_accuracy.pdparams \
    Global.save_model_dir=output/CCPD/rec_quant/ \
    Global.eval_batch_step="[0, 90]" \
    Optimizer.lr.name=Const \
    Optimizer.lr.learning_rate=0.0005 \
    Optimizer.lr.warmup_epoch=0 \
    Train.dataset.data_dir=/home/aistudio/data/CCPD2020/PPOCR \
    Train.dataset.label_file_list=[/home/aistudio/data/CCPD2020/PPOCR/train/rec.txt] \
    Eval.dataset.data_dir=/home/aistudio/data/CCPD2020/PPOCR \
    Eval.dataset.label_file_list=[/home/aistudio/data/CCPD2020/PPOCR/test/rec.txt]
```

é‡åŒ–åæŒ‡æ ‡å¯¹æ¯”å¦‚ä¸‹

|æ–¹æ¡ˆ| acc    | æ¨¡å‹å¤§å°  | é¢„æµ‹é€Ÿåº¦(lite) |
|---|--------|-------|------------|
|PP-OCRv3ä¸­è‹±æ–‡è¶…è½»é‡è¯†åˆ«é¢„è®­ç»ƒæ¨¡å‹ fine-tune| 94.54% | 10.3M | 4.2ms      |
|PP-OCRv3ä¸­è‹±æ–‡è¶…è½»é‡è¯†åˆ«é¢„è®­ç»ƒæ¨¡å‹ fine-tune + é‡åŒ–| 93.40%  | 4.8M  | 1.8ms      |

å¯ä»¥çœ‹åˆ°é‡åŒ–åèƒ½é™ä½æ¨¡å‹ä½“ç§¯53%å¹¶ä¸”æ¨ç†é€Ÿåº¦æå‡57%ï¼Œä½†æ˜¯ç”±äºè¯†åˆ«æ•°æ®è¿‡å°‘ï¼Œé‡åŒ–å¸¦æ¥äº†1%çš„ç²¾åº¦ä¸‹é™ã€‚

é€Ÿåº¦æµ‹è¯•åŸºäº[PaddleOCR liteæ•™ç¨‹](../deploy/lite/readme_ch.md)å®Œæˆã€‚

#### 4.2.5 æ¨¡å‹å¯¼å‡º

ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤å¯ä»¥å°†è®­ç»ƒå¥½çš„æ¨¡å‹è¿›è¡Œå¯¼å‡ºã€‚

* éé‡åŒ–æ¨¡å‹
```bash
python tools/export_model.py -c configs/rec/PP-OCRv3/ch_PP-OCRv3_rec.yml -o \
    Global.pretrained_model=output/CCPD/rec/best_accuracy.pdparams \
    Global.save_inference_dir=output/CCPD/rec/infer
```
* é‡åŒ–æ¨¡å‹
```bash
python deploy/slim/quantization/export_model.py -c configs/rec/PP-OCRv3/ch_PP-OCRv3_rec.yml -o \
    Global.pretrained_model=output/CCPD/rec_quant/best_accuracy.pdparams \
    Global.save_inference_dir=output/CCPD/rec_quant/infer
```

### 4.3 è®¡ç®—End2EndæŒ‡æ ‡

ç«¯åˆ°ç«¯æŒ‡æ ‡å¯é€šè¿‡ [PaddleOCRå†…ç½®è„šæœ¬](../tools/end2end/readme.md) è¿›è¡Œè®¡ç®—ï¼Œå…·ä½“æ­¥éª¤å¦‚ä¸‹ï¼š

1. å¯¼å‡ºæ¨¡å‹

é€šè¿‡å¦‚ä¸‹å‘½ä»¤è¿›è¡Œæ¨¡å‹çš„å¯¼å‡ºã€‚æ³¨æ„ï¼Œé‡åŒ–æ¨¡å‹å¯¼å‡ºæ—¶ï¼Œéœ€è¦é…ç½®evalæ•°æ®é›†

```bash
# æ£€æµ‹æ¨¡å‹

# é¢„è®­ç»ƒæ¨¡å‹
python tools/export_model.py -c configs/det/ch_PP-OCRv3/ch_PP-OCRv3_det_student.yml -o \
    Global.pretrained_model=models/ch_PP-OCRv3_det_distill_train/student.pdparams \
    Global.save_inference_dir=output/ch_PP-OCRv3_det_distill_train/infer

# éé‡åŒ–æ¨¡å‹
python tools/export_model.py -c configs/det/ch_PP-OCRv3/ch_PP-OCRv3_det_student.yml -o \
    Global.pretrained_model=output/CCPD/det/best_accuracy.pdparams \
    Global.save_inference_dir=output/CCPD/det/infer

# é‡åŒ–æ¨¡å‹
python deploy/slim/quantization/export_model.py -c configs/det/ch_PP-OCRv3/ch_PP-OCRv3_det_student.yml -o \
    Global.pretrained_model=output/CCPD/det_quant/best_accuracy.pdparams \
    Global.save_inference_dir=output/CCPD/det_quant/infer \
    Eval.dataset.data_dir=/home/aistudio/data/CCPD2020/ccpd_green \
    Eval.dataset.label_file_list=[/home/aistudio/data/CCPD2020/PPOCR/test/det.txt] \
    Eval.loader.num_workers=0

# è¯†åˆ«æ¨¡å‹

# é¢„è®­ç»ƒæ¨¡å‹
python tools/export_model.py -c configs/rec/PP-OCRv3/ch_PP-OCRv3_rec.yml -o \
    Global.pretrained_model=models/ch_PP-OCRv3_rec_train/student.pdparams \
    Global.save_inference_dir=output/ch_PP-OCRv3_rec_train/infer

# éé‡åŒ–æ¨¡å‹
python tools/export_model.py -c configs/rec/PP-OCRv3/ch_PP-OCRv3_rec.yml -o \
    Global.pretrained_model=output/CCPD/rec/best_accuracy.pdparams \
    Global.save_inference_dir=output/CCPD/rec/infer

# é‡åŒ–æ¨¡å‹
python deploy/slim/quantization/export_model.py -c configs/rec/PP-OCRv3/ch_PP-OCRv3_rec.yml -o \
    Global.pretrained_model=output/CCPD/rec_quant/best_accuracy.pdparams \
    Global.save_inference_dir=output/CCPD/rec_quant/infer \
    Eval.dataset.data_dir=/home/aistudio/data/CCPD2020/PPOCR \
    Eval.dataset.label_file_list=[/home/aistudio/data/CCPD2020/PPOCR/test/rec.txt]
```

2. ç”¨å¯¼å‡ºçš„æ¨¡å‹å¯¹æµ‹è¯•é›†è¿›è¡Œé¢„æµ‹

æ­¤å¤„ï¼Œåˆ†åˆ«ä½¿ç”¨PP-OCRv3é¢„è®­ç»ƒæ¨¡å‹ï¼Œfintuneæ¨¡å‹å’Œé‡åŒ–æ¨¡å‹å¯¹æµ‹è¯•é›†çš„æ‰€æœ‰å›¾åƒè¿›è¡Œé¢„æµ‹ï¼Œå‘½ä»¤å¦‚ä¸‹ï¼š

```bash
# PP-OCRv3ä¸­è‹±æ–‡è¶…è½»é‡æ£€æµ‹é¢„è®­ç»ƒæ¨¡å‹ï¼ŒPP-OCRv3ä¸­è‹±æ–‡è¶…è½»é‡è¯†åˆ«é¢„è®­ç»ƒæ¨¡å‹
python3 tools/infer/predict_system.py --det_model_dir=models/ch_PP-OCRv3_det_distill_train/infer --rec_model_dir=models/ch_PP-OCRv3_rec_train/infer --det_limit_side_len=736 --det_limit_type=min --image_dir=/home/aistudio/data/CCPD2020/ccpd_green/test/ --draw_img_save_dir=infer/pretrain --use_dilation=true

# PP-OCRv3ä¸­è‹±æ–‡è¶…è½»é‡æ£€æµ‹é¢„è®­ç»ƒæ¨¡å‹+fine-tuneï¼ŒPP-OCRv3ä¸­è‹±æ–‡è¶…è½»é‡è¯†åˆ«é¢„è®­ç»ƒæ¨¡å‹+fine-tune
python3 tools/infer/predict_system.py --det_model_dir=output/CCPD/det/infer --rec_model_dir=output/CCPD/rec/infer --det_limit_side_len=736 --det_limit_type=min --image_dir=/home/aistudio/data/CCPD2020/ccpd_green/test/ --draw_img_save_dir=infer/fine-tune --use_dilation=true

# PP-OCRv3ä¸­è‹±æ–‡è¶…è½»é‡æ£€æµ‹é¢„è®­ç»ƒæ¨¡å‹ fine-tune +é‡åŒ–ï¼ŒPP-OCRv3ä¸­è‹±æ–‡è¶…è½»é‡è¯†åˆ«é¢„è®­ç»ƒæ¨¡å‹ fine-tune +é‡åŒ– ç»“æœè½¬æ¢å’Œè¯„ä¼°
python3 tools/infer/predict_system.py --det_model_dir=output/CCPD/det_quant/infer --rec_model_dir=output/CCPD/rec_quant/infer --det_limit_side_len=736 --det_limit_type=min --image_dir=/home/aistudio/data/CCPD2020/ccpd_green/test/ --draw_img_save_dir=infer/quant --use_dilation=true
```

3. è½¬æ¢labelå¹¶è®¡ç®—æŒ‡æ ‡

å°†gtå’Œä¸Šä¸€æ­¥ä¿å­˜çš„é¢„æµ‹ç»“æœè½¬æ¢ä¸ºç«¯å¯¹ç«¯è¯„æµ‹éœ€è¦çš„æ•°æ®æ ¼å¼ï¼Œå¹¶æ ¹æ®è½¬æ¢åçš„æ•°æ®è¿›è¡Œç«¯åˆ°ç«¯æŒ‡æ ‡è®¡ç®—

```bash
python3 tools/end2end/convert_ppocr_label.py --mode=gt --label_path=/home/aistudio/data/CCPD2020/PPOCR/test/det.txt --save_folder=end2end/gt

# PP-OCRv3ä¸­è‹±æ–‡è¶…è½»é‡æ£€æµ‹é¢„è®­ç»ƒæ¨¡å‹ï¼ŒPP-OCRv3ä¸­è‹±æ–‡è¶…è½»é‡è¯†åˆ«é¢„è®­ç»ƒæ¨¡å‹ ç»“æœè½¬æ¢å’Œè¯„ä¼°
python3 tools/end2end/convert_ppocr_label.py --mode=pred --label_path=infer/pretrain/system_results.txt --save_folder=end2end/pretrain
python3 tools/end2end/eval_end2end.py end2end/gt end2end/pretrain

# PP-OCRv3ä¸­è‹±æ–‡è¶…è½»é‡æ£€æµ‹é¢„è®­ç»ƒæ¨¡å‹ï¼ŒPP-OCRv3ä¸­è‹±æ–‡è¶…è½»é‡è¯†åˆ«é¢„è®­ç»ƒæ¨¡å‹+åå¤„ç†å»æ‰å¤šè¯†åˆ«çš„`Â·` ç»“æœè½¬æ¢å’Œè¯„ä¼°
# éœ€æ‰‹åŠ¨ä¿®æ”¹åå¤„ç†å‡½æ•°
python3 tools/end2end/convert_ppocr_label.py --mode=pred --label_path=infer/post/system_results.txt --save_folder=end2end/post
python3 tools/end2end/eval_end2end.py end2end/gt end2end/post

# PP-OCRv3ä¸­è‹±æ–‡è¶…è½»é‡æ£€æµ‹é¢„è®­ç»ƒæ¨¡å‹ fine-tuneï¼ŒPP-OCRv3ä¸­è‹±æ–‡è¶…è½»é‡è¯†åˆ«é¢„è®­ç»ƒæ¨¡å‹ fine-tune ç»“æœè½¬æ¢å’Œè¯„ä¼°
python3 tools/end2end/convert_ppocr_label.py --mode=pred --label_path=infer/fine-tune/system_results.txt --save_folder=end2end/fine-tune
python3 tools/end2end/eval_end2end.py end2end/gt end2end/fine-tune

# PP-OCRv3ä¸­è‹±æ–‡è¶…è½»é‡æ£€æµ‹é¢„è®­ç»ƒæ¨¡å‹ fine-tune +é‡åŒ–ï¼ŒPP-OCRv3ä¸­è‹±æ–‡è¶…è½»é‡è¯†åˆ«é¢„è®­ç»ƒæ¨¡å‹ fine-tune +é‡åŒ– ç»“æœè½¬æ¢å’Œè¯„ä¼°
python3 tools/end2end/convert_ppocr_label.py --mode=pred --label_path=infer/quant/system_results.txt --save_folder=end2end/quant
python3 tools/end2end/eval_end2end.py end2end/gt end2end/quant
```

æ—¥å¿—å¦‚ä¸‹:
```bash
The convert label saved in end2end/gt
The convert label saved in end2end/pretrain
start testing...
hit, dt_count, gt_count 2 5988 5006
character_acc: 70.42%
avg_edit_dist_field: 2.37
avg_edit_dist_img: 2.37
precision: 0.03%
recall: 0.04%
fmeasure: 0.04%
The convert label saved in end2end/post
start testing...
hit, dt_count, gt_count 4224 5988 5006
character_acc: 81.59%
avg_edit_dist_field: 1.47
avg_edit_dist_img: 1.47
precision: 70.54%
recall: 84.38%
fmeasure: 76.84%
The convert label saved in end2end/fine-tune
start testing...
hit, dt_count, gt_count 4286 4898 5006
character_acc: 94.16%
avg_edit_dist_field: 0.47
avg_edit_dist_img: 0.47
precision: 87.51%
recall: 85.62%
fmeasure: 86.55%
The convert label saved in end2end/quant
start testing...
hit, dt_count, gt_count 4349 4951 5006
character_acc: 94.13%
avg_edit_dist_field: 0.47
avg_edit_dist_img: 0.47
precision: 87.84%
recall: 86.88%
fmeasure: 87.36%
```

å„ä¸ªæ–¹æ¡ˆç«¯åˆ°ç«¯æŒ‡æ ‡å¦‚ä¸‹ï¼š

|æ¨¡å‹| æŒ‡æ ‡     |
|---|--------|
|PP-OCRv3ä¸­è‹±æ–‡è¶…è½»é‡æ£€æµ‹é¢„è®­ç»ƒæ¨¡å‹ <br> PP-OCRv3ä¸­è‹±æ–‡è¶…è½»é‡è¯†åˆ«é¢„è®­ç»ƒæ¨¡å‹| 0.04%  |
|PP-OCRv3ä¸­è‹±æ–‡è¶…è½»é‡æ£€æµ‹é¢„è®­ç»ƒæ¨¡å‹ <br> PP-OCRv3ä¸­è‹±æ–‡è¶…è½»é‡è¯†åˆ«é¢„è®­ç»ƒæ¨¡å‹ + åå¤„ç†å»æ‰å¤šè¯†åˆ«çš„`Â·`| 78.27% |
|PP-OCRv3ä¸­è‹±æ–‡è¶…è½»é‡æ£€æµ‹é¢„è®­ç»ƒæ¨¡å‹+fine-tune <br> PP-OCRv3ä¸­è‹±æ–‡è¶…è½»é‡è¯†åˆ«é¢„è®­ç»ƒæ¨¡å‹+fine-tune| 87.14% |
|PP-OCRv3ä¸­è‹±æ–‡è¶…è½»é‡æ£€æµ‹é¢„è®­ç»ƒæ¨¡å‹+fine-tune+é‡åŒ– <br> PP-OCRv3ä¸­è‹±æ–‡è¶…è½»é‡è¯†åˆ«é¢„è®­ç»ƒæ¨¡å‹+fine-tune+é‡åŒ–| 88.00%    |

ä»ç»“æœä¸­å¯ä»¥çœ‹åˆ°å¯¹é¢„è®­ç»ƒæ¨¡å‹ä¸åšä¿®æ”¹ï¼Œåªæ ¹æ®åœºæ™¯ä¸‹çš„å…·ä½“æƒ…å†µè¿›è¡Œåå¤„ç†çš„ä¿®æ”¹å°±èƒ½å¤§å¹…æå‡ç«¯åˆ°ç«¯æŒ‡æ ‡åˆ°78.27%ï¼Œåœ¨CCPDæ•°æ®é›†ä¸Šè¿›è¡Œ fine-tune åæŒ‡æ ‡è¿›ä¸€æ­¥æå‡åˆ°87.14%, åœ¨ç»è¿‡é‡åŒ–è®­ç»ƒä¹‹åï¼Œç”±äºæ£€æµ‹æ¨¡å‹çš„recallå˜é«˜ï¼ŒæŒ‡æ ‡è¿›ä¸€æ­¥æå‡åˆ°88%ã€‚ä½†æ˜¯è¿™ä¸ªç»“æœä»æ—§ä¸ç¬¦åˆæ£€æµ‹æ¨¡å‹+è¯†åˆ«æ¨¡å‹çš„çœŸå®æ€§èƒ½(99%*94%=93%)ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦å¯¹ base case è¿›è¡Œå…·ä½“åˆ†æã€‚

åœ¨ä¹‹å‰çš„ç«¯åˆ°ç«¯é¢„æµ‹ç»“æœä¸­ï¼Œå¯ä»¥çœ‹åˆ°å¾ˆå¤šä¸ç¬¦åˆè½¦ç‰Œæ ‡æ³¨çš„æ–‡å­—è¢«è¯†åˆ«å‡ºæ¥, å› æ­¤å¯ä»¥è¿›è¡Œç®€å•çš„è¿‡æ»¤æ¥æå‡precision

ä¸ºäº†å¿«é€Ÿè¯„ä¼°ï¼Œæˆ‘ä»¬åœ¨ ` tools/end2end/convert_ppocr_label.py` è„šæœ¬çš„ 58 è¡ŒåŠ å…¥å¦‚ä¸‹ä»£ç ï¼Œå¯¹é8ä¸ªå­—ç¬¦çš„ç»“æœè¿›è¡Œè¿‡æ»¤
```python
if len(txt) != 8: # è½¦ç‰Œå­—ç¬¦ä¸²é•¿åº¦ä¸º8
    continue
```

æ­¤å¤–ï¼Œé€šè¿‡å¯è§†åŒ–boxå¯ä»¥å‘ç°æœ‰å¾ˆå¤šæ¡†éƒ½æ˜¯ç«–ç›´ç¿»è½¬ä¹‹åçš„æ¡†ï¼Œå¹¶ä¸”æ²¡æœ‰å®Œå…¨æ¡†ä½è½¦ç‰Œè¾¹ç•Œï¼Œå› æ­¤éœ€è¦è¿›è¡Œæ¡†çš„ç«–ç›´ç¿»è½¬ä»¥åŠè½»å¾®æ‰©å¤§ï¼Œç¤ºæ„å›¾å¦‚ä¸‹ï¼š

![](https://ai-studio-static-online.cdn.bcebos.com/59ab0411c8eb4dfd917fb2b6e5b69a17ee7ca48351444aec9ac6104b79ff1028)

ä¿®æ”¹å‰åä¸ªæ–¹æ¡ˆæŒ‡æ ‡å¯¹æ¯”å¦‚ä¸‹ï¼š


å„ä¸ªæ–¹æ¡ˆç«¯åˆ°ç«¯æŒ‡æ ‡å¦‚ä¸‹ï¼š

|æ¨¡å‹|base|A:è¯†åˆ«ç»“æœè¿‡æ»¤|B:use_dilation|C:flip_box|best|
|---|---|---|---|---|---|
|PP-OCRv3ä¸­è‹±æ–‡è¶…è½»é‡æ£€æµ‹é¢„è®­ç»ƒæ¨¡å‹ <br> PP-OCRv3ä¸­è‹±æ–‡è¶…è½»é‡è¯†åˆ«é¢„è®­ç»ƒæ¨¡å‹|0.04%|0.08%|0.02%|0.05%|0.00%(A)|
|PP-OCRv3ä¸­è‹±æ–‡è¶…è½»é‡æ£€æµ‹é¢„è®­ç»ƒæ¨¡å‹ <br> PP-OCRv3ä¸­è‹±æ–‡è¶…è½»é‡è¯†åˆ«é¢„è®­ç»ƒæ¨¡å‹ + åå¤„ç†å»æ‰å¤šè¯†åˆ«çš„`Â·`|78.27%|90.84%|78.61%|79.43%|91.66%(A+B+C)|
|PP-OCRv3ä¸­è‹±æ–‡è¶…è½»é‡æ£€æµ‹é¢„è®­ç»ƒæ¨¡å‹+fine-tune <br> PP-OCRv3ä¸­è‹±æ–‡è¶…è½»é‡è¯†åˆ«é¢„è®­ç»ƒæ¨¡å‹+fine-tune|87.14%|90.40%|87.66%|89.98%|92.50%(A+B+C)|
|PP-OCRv3ä¸­è‹±æ–‡è¶…è½»é‡æ£€æµ‹é¢„è®­ç»ƒæ¨¡å‹+fine-tune+é‡åŒ– <br> PP-OCRv3ä¸­è‹±æ–‡è¶…è½»é‡è¯†åˆ«é¢„è®­ç»ƒæ¨¡å‹+fine-tune+é‡åŒ–|88.00%|90.54%|88.50%|89.46%|92.02%(A+B+C)|


ä»ç»“æœä¸­å¯ä»¥çœ‹åˆ°å¯¹é¢„è®­ç»ƒæ¨¡å‹ä¸åšä¿®æ”¹ï¼Œåªæ ¹æ®åœºæ™¯ä¸‹çš„å…·ä½“æƒ…å†µè¿›è¡Œåå¤„ç†çš„ä¿®æ”¹å°±èƒ½å¤§å¹…æå‡ç«¯åˆ°ç«¯æŒ‡æ ‡åˆ°91.66%ï¼Œåœ¨CCPDæ•°æ®é›†ä¸Šè¿›è¡Œ fine-tune åæŒ‡æ ‡è¿›ä¸€æ­¥æå‡åˆ°92.5%, åœ¨ç»è¿‡é‡åŒ–è®­ç»ƒä¹‹åï¼ŒæŒ‡æ ‡å˜ä¸º92.02%ã€‚

### 4.4 éƒ¨ç½²

- åŸºäº Paddle Inference çš„pythonæ¨ç†

æ£€æµ‹æ¨¡å‹å’Œè¯†åˆ«æ¨¡å‹åˆ†åˆ« fine-tune å¹¶å¯¼å‡ºä¸ºinferenceæ¨¡å‹ä¹‹åï¼Œå¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤åŸºäº Paddle Inference è¿›è¡Œç«¯åˆ°ç«¯æ¨ç†å¹¶å¯¹ç»“æœè¿›è¡Œå¯è§†åŒ–ã€‚

```bash
python tools/infer/predict_system.py \
    --det_model_dir=output/CCPD/det/infer/ \
    --rec_model_dir=output/CCPD/rec/infer/ \
    --image_dir="/home/aistudio/data/CCPD2020/ccpd_green/test/04131106321839081-92_258-159&509_530&611-527&611_172&599_159&509_530&525-0_0_3_32_30_31_30_30-109-106.jpg" \
    --rec_image_shape=3,48,320
```
æ¨ç†ç»“æœå¦‚ä¸‹

![](https://ai-studio-static-online.cdn.bcebos.com/76b6a0939c2c4cf49039b6563c4b28e241e11285d7464e799e81c58c0f7707a7)

- ç«¯ä¾§éƒ¨ç½²

ç«¯ä¾§éƒ¨ç½²æˆ‘ä»¬é‡‡ç”¨åŸºäº PaddleLite çš„ cpp æ¨ç†ã€‚Paddle Liteæ˜¯é£æ¡¨è½»é‡åŒ–æ¨ç†å¼•æ“ï¼Œä¸ºæ‰‹æœºã€IOTç«¯æä¾›é«˜æ•ˆæ¨ç†èƒ½åŠ›ï¼Œå¹¶å¹¿æ³›æ•´åˆè·¨å¹³å°ç¡¬ä»¶ï¼Œä¸ºç«¯ä¾§éƒ¨ç½²åŠåº”ç”¨è½åœ°é—®é¢˜æä¾›è½»é‡åŒ–çš„éƒ¨ç½²æ–¹æ¡ˆã€‚å…·ä½“å¯å‚è€ƒ [PaddleOCR liteæ•™ç¨‹](../deploy/lite/readme_ch.md)


### 4.5 å®éªŒæ€»ç»“

æˆ‘ä»¬åˆ†åˆ«ä½¿ç”¨PP-OCRv3ä¸­è‹±æ–‡è¶…è½»é‡é¢„è®­ç»ƒæ¨¡å‹åœ¨è½¦ç‰Œæ•°æ®é›†ä¸Šè¿›è¡Œäº†ç›´æ¥è¯„ä¼°å’Œ fine-tune å’Œ fine-tune +é‡åŒ–3ç§æ–¹æ¡ˆçš„å®éªŒï¼Œå¹¶åŸºäº[PaddleOCR liteæ•™ç¨‹](../deploy/lite/readme_ch.md)è¿›è¡Œäº†é€Ÿåº¦æµ‹è¯•ï¼ŒæŒ‡æ ‡å¯¹æ¯”å¦‚ä¸‹ï¼š

- æ£€æµ‹

|æ–¹æ¡ˆ|hmeans| æ¨¡å‹å¤§å° | é¢„æµ‹é€Ÿåº¦(lite) |
|---|---|------|------------|
|PP-OCRv3ä¸­è‹±æ–‡è¶…è½»é‡æ£€æµ‹é¢„è®­ç»ƒæ¨¡å‹ç›´æ¥é¢„æµ‹|76.12%|2.5M| 233ms      |
|PP-OCRv3ä¸­è‹±æ–‡è¶…è½»é‡æ£€æµ‹é¢„è®­ç»ƒæ¨¡å‹ fine-tune|99.00%| 2.5M | 233ms      |
|PP-OCRv3ä¸­è‹±æ–‡è¶…è½»é‡æ£€æµ‹é¢„è®­ç»ƒæ¨¡å‹ fine-tune + é‡åŒ–|98.91%| 1.0M   | 189ms      |fine-tune

- è¯†åˆ«

|æ–¹æ¡ˆ| acc    | æ¨¡å‹å¤§å°  | é¢„æµ‹é€Ÿåº¦(lite) |
|---|--------|-------|------------|
|PP-OCRv3ä¸­è‹±æ–‡è¶…è½»é‡è¯†åˆ«é¢„è®­ç»ƒæ¨¡å‹ç›´æ¥é¢„æµ‹| 0.00%     |10.3M| 4.2ms      |
|PP-OCRv3ä¸­è‹±æ–‡è¶…è½»é‡è¯†åˆ«é¢„è®­ç»ƒæ¨¡å‹ç›´æ¥é¢„æµ‹+åå¤„ç†å»æ‰å¤šè¯†åˆ«çš„`Â·`| 90.97% |10.3M| 4.2ms      |
|PP-OCRv3ä¸­è‹±æ–‡è¶…è½»é‡è¯†åˆ«é¢„è®­ç»ƒæ¨¡å‹ fine-tune| 94.54% | 10.3M | 4.2ms      |
|PP-OCRv3ä¸­è‹±æ–‡è¶…è½»é‡è¯†åˆ«é¢„è®­ç»ƒæ¨¡å‹ fine-tune + é‡åŒ–| 93.40%  | 4.8M  | 1.8ms      |


- ç«¯åˆ°ç«¯æŒ‡æ ‡å¦‚ä¸‹ï¼š

|æ–¹æ¡ˆ|fmeasure|æ¨¡å‹å¤§å°|é¢„æµ‹é€Ÿåº¦(lite) |
|---|---|---|---|
|PP-OCRv3ä¸­è‹±æ–‡è¶…è½»é‡æ£€æµ‹é¢„è®­ç»ƒæ¨¡å‹ <br> PP-OCRv3ä¸­è‹±æ–‡è¶…è½»é‡è¯†åˆ«é¢„è®­ç»ƒæ¨¡å‹|0.08%|12.8M|298ms|
|PP-OCRv3ä¸­è‹±æ–‡è¶…è½»é‡æ£€æµ‹é¢„è®­ç»ƒæ¨¡å‹ <br> PP-OCRv3ä¸­è‹±æ–‡è¶…è½»é‡è¯†åˆ«é¢„è®­ç»ƒæ¨¡å‹ + åå¤„ç†å»æ‰å¤šè¯†åˆ«çš„`Â·`|91.66%|12.8M|298ms|
|PP-OCRv3ä¸­è‹±æ–‡è¶…è½»é‡æ£€æµ‹é¢„è®­ç»ƒæ¨¡å‹+fine-tune <br> PP-OCRv3ä¸­è‹±æ–‡è¶…è½»é‡è¯†åˆ«é¢„è®­ç»ƒæ¨¡å‹+fine-tune|92.50%|12.8M|298ms|
|PP-OCRv3ä¸­è‹±æ–‡è¶…è½»é‡æ£€æµ‹é¢„è®­ç»ƒæ¨¡å‹+fine-tune+é‡åŒ– <br> PP-OCRv3ä¸­è‹±æ–‡è¶…è½»é‡è¯†åˆ«é¢„è®­ç»ƒæ¨¡å‹+fine-tune+é‡åŒ–|92.02%|5.80M|224ms|


**ç»“è®º**

PP-OCRv3çš„æ£€æµ‹æ¨¡å‹åœ¨æœªç»è¿‡fine-tuneçš„æƒ…å†µä¸‹ï¼Œåœ¨è½¦ç‰Œæ•°æ®é›†ä¸Šä¹Ÿæœ‰ä¸€å®šçš„ç²¾åº¦ï¼Œç»è¿‡ fine-tune åèƒ½å¤Ÿæå¤§çš„æå‡æ£€æµ‹æ•ˆæœï¼Œç²¾åº¦è¾¾åˆ°99%ã€‚åœ¨ä½¿ç”¨é‡åŒ–è®­ç»ƒåæ£€æµ‹æ¨¡å‹çš„ç²¾åº¦å‡ ä¹æ— æŸï¼Œå¹¶ä¸”æ¨¡å‹å¤§å°å‹ç¼©60%ã€‚

PP-OCRv3çš„è¯†åˆ«æ¨¡å‹åœ¨æœªç»è¿‡fine-tuneçš„æƒ…å†µä¸‹ï¼Œåœ¨è½¦ç‰Œæ•°æ®é›†ä¸Šç²¾åº¦ä¸º0ï¼Œä½†æ˜¯ç»è¿‡åˆ†æå¯ä»¥çŸ¥é“ï¼Œæ¨¡å‹å¤§éƒ¨åˆ†å­—ç¬¦éƒ½é¢„æµ‹æ­£ç¡®ï¼Œä½†æ˜¯ä¼šå¤šé¢„æµ‹ä¸€ä¸ªç‰¹æ®Šå­—ç¬¦ï¼Œå»æ‰è¿™ä¸ªç‰¹æ®Šå­—ç¬¦åï¼Œç²¾åº¦è¾¾åˆ°90%ã€‚PP-OCRv3è¯†åˆ«æ¨¡å‹åœ¨ç»è¿‡ fine-tune åè¯†åˆ«ç²¾åº¦è¿›ä¸€æ­¥æå‡ï¼Œè¾¾åˆ°94.4%ã€‚åœ¨ä½¿ç”¨é‡åŒ–è®­ç»ƒåè¯†åˆ«æ¨¡å‹å¤§å°å‹ç¼©53%ï¼Œä½†æ˜¯ç”±äºæ•°æ®é‡å¤šå°‘ï¼Œå¸¦æ¥äº†1%çš„ç²¾åº¦æŸå¤±ã€‚

ä»ç«¯åˆ°ç«¯ç»“æœä¸­å¯ä»¥çœ‹åˆ°å¯¹é¢„è®­ç»ƒæ¨¡å‹ä¸åšä¿®æ”¹ï¼Œåªæ ¹æ®åœºæ™¯ä¸‹çš„å…·ä½“æƒ…å†µè¿›è¡Œåå¤„ç†çš„ä¿®æ”¹å°±èƒ½å¤§å¹…æå‡ç«¯åˆ°ç«¯æŒ‡æ ‡åˆ°91.66%ï¼Œåœ¨CCPDæ•°æ®é›†ä¸Šè¿›è¡Œ fine-tune åæŒ‡æ ‡è¿›ä¸€æ­¥æå‡åˆ°92.5%, åœ¨ç»è¿‡é‡åŒ–è®­ç»ƒä¹‹åï¼ŒæŒ‡æ ‡è½»å¾®ä¸‹é™åˆ°92.02%ä½†æ¨¡å‹å¤§å°é™ä½54%ã€‚
