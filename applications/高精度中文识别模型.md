# é«˜ç²¾åº¦ä¸­æ–‡åœºæ™¯æ–‡æœ¬è¯†åˆ«æ¨¡å‹SVTR

## 1. ç®€ä»‹

PP-OCRv3æ˜¯ç™¾åº¦å¼€æºçš„è¶…è½»é‡çº§åœºæ™¯æ–‡æœ¬æ£€æµ‹è¯†åˆ«æ¨¡å‹åº“ï¼Œå…¶ä¸­è¶…è½»é‡çš„åœºæ™¯ä¸­æ–‡è¯†åˆ«æ¨¡å‹SVTR_LCNetä½¿ç”¨äº†SVTRç®—æ³•ç»“æ„ã€‚ä¸ºäº†ä¿è¯é€Ÿåº¦ï¼ŒSVTR_LCNetå°†SVTRæ¨¡å‹çš„Local Blocksæ›¿æ¢ä¸ºLCNetï¼Œä½¿ç”¨ä¸¤å±‚Global Blocksã€‚åœ¨ä¸­æ–‡åœºæ™¯ä¸­ï¼ŒPP-OCRv3è¯†åˆ«ä¸»è¦ä½¿ç”¨å¦‚ä¸‹ä¼˜åŒ–ç­–ç•¥ï¼ˆ[è¯¦ç»†æŠ€æœ¯æŠ¥å‘Š](../doc/doc_ch/PP-OCRv3_introduction.md)ï¼‰ï¼š
- GTCï¼šAttentionæŒ‡å¯¼CTCè®­ç»ƒç­–ç•¥ï¼›
- TextConAugï¼šæŒ–æ˜æ–‡å­—ä¸Šä¸‹æ–‡ä¿¡æ¯çš„æ•°æ®å¢å¹¿ç­–ç•¥ï¼›
- TextRotNetï¼šè‡ªç›‘ç£çš„é¢„è®­ç»ƒæ¨¡å‹ï¼›
- UDMLï¼šè”åˆäº’å­¦ä¹ ç­–ç•¥ï¼›
- UIMï¼šæ— æ ‡æ³¨æ•°æ®æŒ–æ˜æ–¹æ¡ˆã€‚

å…¶ä¸­ *UIMï¼šæ— æ ‡æ³¨æ•°æ®æŒ–æ˜æ–¹æ¡ˆ* ä½¿ç”¨äº†é«˜ç²¾åº¦çš„SVTRä¸­æ–‡æ¨¡å‹è¿›è¡Œæ— æ ‡æ³¨æ–‡ä»¶çš„åˆ·åº“ï¼Œè¯¥æ¨¡å‹åœ¨PP-OCRv3è¯†åˆ«çš„æ•°æ®é›†ä¸Šè®­ç»ƒï¼Œç²¾åº¦å¯¹æ¯”å¦‚ä¸‹è¡¨ã€‚

|ä¸­æ–‡è¯†åˆ«ç®—æ³•|æ¨¡å‹|UIM|ç²¾åº¦|
| --- | --- | --- |--- |
|PP-OCRv3|SVTR_LCNet| w/o |78.4%|
|PP-OCRv3|SVTR_LCNet| w |79.4%|
|SVTR|SVTR-Tiny|-|82.5%|

aistudioé¡¹ç›®é“¾æ¥: [é«˜ç²¾åº¦ä¸­æ–‡åœºæ™¯æ–‡æœ¬è¯†åˆ«æ¨¡å‹SVTR](https://aistudio.baidu.com/aistudio/projectdetail/4263032)

## 2. SVTRä¸­æ–‡æ¨¡å‹ä½¿ç”¨

### ç¯å¢ƒå‡†å¤‡


æœ¬ä»»åŠ¡åŸºäºAistudioå®Œæˆ, å…·ä½“ç¯å¢ƒå¦‚ä¸‹ï¼š

- æ“ä½œç³»ç»Ÿ: Linux
- PaddlePaddle: 2.3
- PaddleOCR: dygraph

ä¸‹è½½ PaddleOCRä»£ç 

```bash
git clone -b dygraph https://github.com/PaddlePaddle/PaddleOCR
```

å®‰è£…ä¾èµ–åº“

```bash
pip install -r PaddleOCR/requirements.txt -i https://mirror.baidu.com/pypi/simple
```

### å¿«é€Ÿä½¿ç”¨

è·å–SVTRä¸­æ–‡æ¨¡å‹æ–‡ä»¶ï¼Œè¯·æ‰«ç å¡«å†™é—®å·ï¼ŒåŠ å…¥PaddleOCRå®˜æ–¹äº¤æµç¾¤è·å–å…¨éƒ¨OCRå‚ç±»æ¨¡å‹ä¸‹è½½é“¾æ¥ã€ã€ŠåŠ¨æ‰‹å­¦OCRã€‹ç”µå­ä¹¦ç­‰å…¨å¥—OCRå­¦ä¹ èµ„æ–™ğŸ
<div align="center">
<img src="https://ai-studio-static-online.cdn.bcebos.com/dd721099bd50478f9d5fb13d8dd00fad69c22d6848244fd3a1d3980d7fefc63e"  width = "150" height = "150" />
</div>

```bash
# è§£å‹æ¨¡å‹æ–‡ä»¶
tar xf svtr_ch_high_accuracy.tar
```

é¢„æµ‹ä¸­æ–‡æ–‡æœ¬ï¼Œä»¥ä¸‹å›¾ä¸ºä¾‹ï¼š
![](../doc/imgs_words/ch/word_1.jpg)

é¢„æµ‹å‘½ä»¤ï¼š

```bash
# CPUé¢„æµ‹
python tools/infer_rec.py -c configs/rec/rec_svtrnet_ch.yml -o Global.pretrained_model=./svtr_ch_high_accuracy/best_accuracy Global.infer_img=./doc/imgs_words/ch/word_1.jpg Global.use_gpu=False

# GPUé¢„æµ‹
#python tools/infer_rec.py -c configs/rec/rec_svtrnet_ch.yml -o Global.pretrained_model=./svtr_ch_high_accuracy/best_accuracy Global.infer_img=./doc/imgs_words/ch/word_1.jpg Global.use_gpu=True
```

å¯ä»¥çœ‹åˆ°æœ€åæ‰“å°ç»“æœä¸º
- result: éŸ©å›½å°é¦†    0.9853458404541016

0.9853458404541016ä¸ºé¢„æµ‹ç½®ä¿¡åº¦ã€‚

### æ¨ç†æ¨¡å‹å¯¼å‡ºä¸é¢„æµ‹

inference æ¨¡å‹ï¼ˆpaddle.jit.saveä¿å­˜çš„æ¨¡å‹ï¼‰ ä¸€èˆ¬æ˜¯æ¨¡å‹è®­ç»ƒï¼ŒæŠŠæ¨¡å‹ç»“æ„å’Œæ¨¡å‹å‚æ•°ä¿å­˜åœ¨æ–‡ä»¶ä¸­çš„å›ºåŒ–æ¨¡å‹ï¼Œå¤šç”¨äºé¢„æµ‹éƒ¨ç½²åœºæ™¯ã€‚ è®­ç»ƒè¿‡ç¨‹ä¸­ä¿å­˜çš„æ¨¡å‹æ˜¯checkpointsæ¨¡å‹ï¼Œä¿å­˜çš„åªæœ‰æ¨¡å‹çš„å‚æ•°ï¼Œå¤šç”¨äºæ¢å¤è®­ç»ƒç­‰ã€‚ ä¸checkpointsæ¨¡å‹ç›¸æ¯”ï¼Œinference æ¨¡å‹ä¼šé¢å¤–ä¿å­˜æ¨¡å‹çš„ç»“æ„ä¿¡æ¯ï¼Œåœ¨é¢„æµ‹éƒ¨ç½²ã€åŠ é€Ÿæ¨ç†ä¸Šæ€§èƒ½ä¼˜è¶Šï¼Œçµæ´»æ–¹ä¾¿ï¼Œé€‚åˆäºå®é™…ç³»ç»Ÿé›†æˆã€‚

è¿è¡Œè¯†åˆ«æ¨¡å‹è½¬inferenceæ¨¡å‹å‘½ä»¤ï¼Œå¦‚ä¸‹ï¼š

```bash
python tools/export_model.py -c configs/rec/rec_svtrnet_ch.yml -o Global.pretrained_model=./svtr_ch_high_accuracy/best_accuracy Global.save_inference_dir=./inference/svtr_ch
```

è½¬æ¢æˆåŠŸåï¼Œåœ¨ç›®å½•ä¸‹æœ‰ä¸‰ä¸ªæ–‡ä»¶ï¼š
```shell
inference/svtr_ch/
    â”œâ”€â”€ inference.pdiparams         # è¯†åˆ«inferenceæ¨¡å‹çš„å‚æ•°æ–‡ä»¶
    â”œâ”€â”€ inference.pdiparams.info    # è¯†åˆ«inferenceæ¨¡å‹çš„å‚æ•°ä¿¡æ¯ï¼Œå¯å¿½ç•¥
    â””â”€â”€ inference.pdmodel           # è¯†åˆ«inferenceæ¨¡å‹çš„programæ–‡ä»¶
```

inferenceæ¨¡å‹é¢„æµ‹ï¼Œå‘½ä»¤å¦‚ä¸‹ï¼š

```bash
# CPUé¢„æµ‹
python3 tools/infer/predict_rec.py --image_dir="./doc/imgs_words/ch/word_1.jpg" --rec_algorithm='SVTR' --rec_model_dir=./inference/svtr_ch/ --rec_image_shape='3, 32, 320'  --rec_char_dict_path=ppocr/utils/ppocr_keys_v1.txt --use_gpu=False

# GPUé¢„æµ‹
#python3 tools/infer/predict_rec.py --image_dir="./doc/imgs_words/ch/word_1.jpg" --rec_algorithm='SVTR' --rec_model_dir=./inference/svtr_ch/ --rec_image_shape='3, 32, 320'  --rec_char_dict_path=ppocr/utils/ppocr_keys_v1.txt --use_gpu=True
```

**æ³¨æ„**

- ä½¿ç”¨SVTRç®—æ³•æ—¶ï¼Œéœ€è¦æŒ‡å®š--rec_algorithm='SVTR'
- å¦‚æœä½¿ç”¨è‡ªå®šä¹‰å­—å…¸è®­ç»ƒçš„æ¨¡å‹ï¼Œéœ€è¦å°†--rec_char_dict_path=ppocr/utils/ppocr_keys_v1.txtä¿®æ”¹ä¸ºè‡ªå®šä¹‰çš„å­—å…¸
- --rec_image_shape='3, 32, 320' è¯¥å‚æ•°ä¸èƒ½å»æ‰
