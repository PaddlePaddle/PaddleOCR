---
typora-copy-images-to: images
comments: true
---


# åŸºäºPP-OCRv3çš„æ¶²æ™¶å±è¯»æ•°è¯†åˆ«

## 1. é¡¹ç›®èƒŒæ™¯åŠæ„ä¹‰

ç›®å‰å…‰å­¦å­—ç¬¦è¯†åˆ«(OCR)æŠ€æœ¯åœ¨æˆ‘ä»¬çš„ç”Ÿæ´»å½“ä¸­è¢«å¹¿æ³›ä½¿ç”¨ï¼Œä½†æ˜¯å¤§å¤šæ•°æ¨¡å‹åœ¨é€šç”¨åœºæ™¯ä¸‹çš„å‡†ç¡®æ€§è¿˜æœ‰å¾…æé«˜ï¼Œé’ˆå¯¹äºæ­¤æˆ‘ä»¬å€ŸåŠ©é£æ¡¨æä¾›çš„PaddleOCRå¥—ä»¶è¾ƒå®¹æ˜“çš„å®ç°äº†åœ¨å‚ç±»åœºæ™¯ä¸‹çš„åº”ç”¨ã€‚

è¯¥é¡¹ç›®ä»¥å›½å®¶è´¨é‡åŸºç¡€ï¼ˆNQIï¼‰ä¸ºå‡†ç»³ï¼Œå……åˆ†åˆ©ç”¨å¤§æ•°æ®ã€äº‘è®¡ç®—ã€ç‰©è”ç½‘ç­‰é«˜æ–°æŠ€æœ¯ï¼Œæ„å»ºè¦†ç›–è®¡é‡ç«¯ã€å®éªŒå®¤ç«¯ã€æ•°æ®ç«¯å’Œç¡¬ä»¶ç«¯çš„å®Œæ•´è®¡é‡è§£å†³æ–¹æ¡ˆï¼Œè§£å†³ä¼ ç»Ÿè®¡é‡æ ¡å‡†ä¸­å­˜åœ¨çš„éš¾é¢˜ï¼Œæ‹“å®½è®¡é‡æ£€æµ‹æœåŠ¡ä½“ç³»å’ŒæœåŠ¡é¢†åŸŸï¼›è§£å†³æ— æ•°ä¼ æ¥å£æˆ–æ•°ä¼ æ¥å£ä¸ç»Ÿä¸€ã€ä¸å…¬å¼€çš„è®¡é‡è®¾å¤‡ï¼Œä»¥åŠè®¡é‡è®¾å¤‡æ‰€å¤„çš„ç¯å¢ƒæ¯”è¾ƒæ¶åŠ£ï¼Œä¸é€‚åˆäººå·¥è¯»å–æ•°æ®ã€‚é€šè¿‡OCRæŠ€æœ¯å®ç°è¿œç¨‹è®¡é‡ï¼Œå¼•é¢†è®¡é‡è¡Œä¸šå‘æ™ºæ…§è®¡é‡è½¬å‹å’Œå‘å±•ã€‚

## 2. é¡¹ç›®å†…å®¹

æœ¬é¡¹ç›®åŸºäºPaddleOCRå¼€æºå¥—ä»¶ï¼Œä»¥PP-OCRv3æ£€æµ‹å’Œè¯†åˆ«æ¨¡å‹ä¸ºåŸºç¡€ï¼Œé’ˆå¯¹æ¶²æ™¶å±è¯»æ•°è¯†åˆ«åœºæ™¯è¿›è¡Œä¼˜åŒ–ã€‚

Aistudioé¡¹ç›®é“¾æ¥ï¼š[OCRæ¶²æ™¶å±è¯»æ•°è¯†åˆ«](https://aistudio.baidu.com/aistudio/projectdetail/4080130)

## 3. å®‰è£…ç¯å¢ƒ

```bash linenums="1"
# é¦–å…ˆgitå®˜æ–¹çš„PaddleOCRé¡¹ç›®ï¼Œå®‰è£…éœ€è¦çš„ä¾èµ–
# ç¬¬ä¸€æ¬¡è¿è¡Œæ‰“å¼€è¯¥æ³¨é‡Š
# git clone https://gitee.com/PaddlePaddle/PaddleOCR.git
cd PaddleOCR
pip install -r requirements.txt
```

## 4. æ–‡å­—æ£€æµ‹

æ–‡æœ¬æ£€æµ‹çš„ä»»åŠ¡æ˜¯å®šä½å‡ºè¾“å…¥å›¾åƒä¸­çš„æ–‡å­—åŒºåŸŸã€‚è¿‘å¹´æ¥å­¦æœ¯ç•Œå…³äºæ–‡æœ¬æ£€æµ‹çš„ç ”ç©¶éå¸¸ä¸°å¯Œï¼Œä¸€ç±»æ–¹æ³•å°†æ–‡æœ¬æ£€æµ‹è§†ä¸ºç›®æ ‡æ£€æµ‹ä¸­çš„ä¸€ä¸ªç‰¹å®šåœºæ™¯ï¼ŒåŸºäºé€šç”¨ç›®æ ‡æ£€æµ‹ç®—æ³•è¿›è¡Œæ”¹è¿›é€‚é…ï¼Œå¦‚TextBoxes[1]åŸºäºä¸€é˜¶æ®µç›®æ ‡æ£€æµ‹å™¨SSD[2]ç®—æ³•ï¼Œè°ƒæ•´ç›®æ ‡æ¡†ä½¿ä¹‹é€‚åˆæç«¯é•¿å®½æ¯”çš„æ–‡æœ¬è¡Œï¼ŒCTPN[3]åˆ™æ˜¯åŸºäºFaster RCNN[4]æ¶æ„æ”¹è¿›è€Œæ¥ã€‚ä½†æ˜¯æ–‡æœ¬æ£€æµ‹ä¸ç›®æ ‡æ£€æµ‹åœ¨ç›®æ ‡ä¿¡æ¯ä»¥åŠä»»åŠ¡æœ¬èº«ä¸Šä»å­˜åœ¨ä¸€äº›åŒºåˆ«ï¼Œå¦‚æ–‡æœ¬ä¸€èˆ¬é•¿å®½æ¯”è¾ƒå¤§ï¼Œå¾€å¾€å‘ˆâ€œæ¡çŠ¶â€ï¼Œæ–‡æœ¬è¡Œä¹‹é—´å¯èƒ½æ¯”è¾ƒå¯†é›†ï¼Œå¼¯æ›²æ–‡æœ¬ç­‰ï¼Œå› æ­¤åˆè¡ç”Ÿäº†å¾ˆå¤šä¸“ç”¨äºæ–‡æœ¬æ£€æµ‹çš„ç®—æ³•ã€‚æœ¬é¡¹ç›®åŸºäºPP-OCRv3ç®—æ³•è¿›è¡Œä¼˜åŒ–ã€‚

### 4.1 PP-OCRv3æ£€æµ‹ç®—æ³•ä»‹ç»

PP-OCRv3æ£€æµ‹æ¨¡å‹æ˜¯å¯¹PP-OCRv2ä¸­çš„CMLï¼ˆCollaborative Mutual Learning) ååŒäº’å­¦ä¹ æ–‡æœ¬æ£€æµ‹è’¸é¦ç­–ç•¥è¿›è¡Œäº†å‡çº§ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼ŒCMLçš„æ ¸å¿ƒæ€æƒ³ç»“åˆäº†â‘ ä¼ ç»Ÿçš„TeacheræŒ‡å¯¼Studentçš„æ ‡å‡†è’¸é¦ä¸ â‘¡Studentsç½‘ç»œä¹‹é—´çš„DMLäº’å­¦ä¹ ï¼Œå¯ä»¥è®©Studentsç½‘ç»œäº’å­¦ä¹ çš„åŒæ—¶ï¼ŒTeacherç½‘ç»œäºˆä»¥æŒ‡å¯¼ã€‚PP-OCRv3åˆ†åˆ«é’ˆå¯¹æ•™å¸ˆæ¨¡å‹å’Œå­¦ç”Ÿæ¨¡å‹è¿›è¡Œè¿›ä¸€æ­¥æ•ˆæœä¼˜åŒ–ã€‚å…¶ä¸­ï¼Œåœ¨å¯¹æ•™å¸ˆæ¨¡å‹ä¼˜åŒ–æ—¶ï¼Œæå‡ºäº†å¤§æ„Ÿå—é‡çš„PANç»“æ„LK-PANå’Œå¼•å…¥äº†DMLï¼ˆDeep Mutual Learningï¼‰è’¸é¦ç­–ç•¥ï¼›åœ¨å¯¹å­¦ç”Ÿæ¨¡å‹ä¼˜åŒ–æ—¶ï¼Œæå‡ºäº†æ®‹å·®æ³¨æ„åŠ›æœºåˆ¶çš„FPNç»“æ„RSE-FPNã€‚
![](./images/c306b2f028364805a55494d435ab553a76cf5ae5dd3f4649a948ea9aeaeb28b8.png)

è¯¦ç»†ä¼˜åŒ–ç­–ç•¥æè¿°è¯·å‚è€ƒ[PP-OCRv3ä¼˜åŒ–ç­–ç•¥](../ppocr/blog/PP-OCRv3_introduction.md#2-æ£€æµ‹ä¼˜åŒ–)

### 4.2 æ•°æ®å‡†å¤‡

[è®¡é‡è®¾å¤‡å±å¹•å­—ç¬¦æ£€æµ‹æ•°æ®é›†](https://aistudio.baidu.com/aistudio/datasetdetail/127845)æ•°æ®æ¥æºäºå®é™…é¡¹ç›®ä¸­å„ç§è®¡é‡è®¾å¤‡çš„æ•°æ˜¾å±ï¼Œä»¥åŠåœ¨ç½‘ä¸Šæœé›†çš„ä¸€äº›å…¶ä»–æ•°æ˜¾å±ï¼ŒåŒ…å«è®­ç»ƒé›†755å¼ ï¼Œæµ‹è¯•é›†355å¼ ã€‚

```bash linenums="1"
# åœ¨PaddleOCRä¸‹åˆ›å»ºæ–°çš„æ–‡ä»¶å¤¹train_data
mkdir train_data
# ä¸‹è½½æ•°æ®é›†å¹¶è§£å‹åˆ°æŒ‡å®šè·¯å¾„ä¸‹
unzip icdar2015.zip  -d train_data
```

```python linenums="1"
# éšæœºæŸ¥çœ‹æ–‡å­—æ£€æµ‹æ•°æ®é›†å›¾ç‰‡
from PIL import Image
import matplotlib.pyplot as plt
import numpy as np
import os


train = './train_data/icdar2015/text_localization/test'
# ä»æŒ‡å®šç›®å½•ä¸­é€‰å–ä¸€å¼ å›¾ç‰‡
def get_one_image(train):
    plt.figure()
    files = os.listdir(train)
    n = len(files)
    ind = np.random.randint(0,n)
    img_dir = os.path.join(train,files[ind])
    image = Image.open(img_dir)
    plt.imshow(image)
    plt.show()
    image = image.resize([208, 208])

get_one_image(train)
```

![det_png](./images/0639da09b774458096ae577e82b2c59e89ced6a00f55458f946997ab7472a4f8.jpeg)

### 4.3 æ¨¡å‹è®­ç»ƒ

#### 4.3.1 é¢„è®­ç»ƒæ¨¡å‹ç›´æ¥è¯„ä¼°

ä¸‹è½½æˆ‘ä»¬éœ€è¦çš„PP-OCRv3æ£€æµ‹é¢„è®­ç»ƒæ¨¡å‹ï¼Œæ›´å¤šé€‰æ‹©è¯·è‡ªè¡Œé€‰æ‹©å…¶ä»–çš„[æ–‡å­—æ£€æµ‹æ¨¡å‹](../ppocr/model_list.md#1-æ–‡æœ¬æ£€æµ‹æ¨¡å‹)

```bash linenums="1"
#ä½¿ç”¨è¯¥æŒ‡ä»¤ä¸‹è½½éœ€è¦çš„é¢„è®­ç»ƒæ¨¡å‹
wget -P ./pretrained_models/ https://paddleocr.bj.bcebos.com/PP-OCRv3/chinese/ch_PP-OCRv3_det_distill_train.tar
# è§£å‹é¢„è®­ç»ƒæ¨¡å‹æ–‡ä»¶
tar -xf ./pretrained_models/ch_PP-OCRv3_det_distill_train.tar -C pretrained_models
```

åœ¨è®­ç»ƒä¹‹å‰ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨ä¸‹é¢å‘½ä»¤æ¥è¯„ä¼°é¢„è®­ç»ƒæ¨¡å‹çš„æ•ˆæœ:

```bash linenums="1"
# è¯„ä¼°é¢„è®­ç»ƒæ¨¡å‹
python tools/eval.py -c configs/det/ch_PP-OCRv3/ch_PP-OCRv3_det_cml.yml -o Global.pretrained_model="./pretrained_models/ch_PP-OCRv3_det_distill_train/best_accuracy"
```

ç»“æœå¦‚ä¸‹ï¼š

|   | æ–¹æ¡ˆ                        |hmeans|
|---|---------------------------|---|
| 0 | PP-OCRv3ä¸­è‹±æ–‡è¶…è½»é‡æ£€æµ‹é¢„è®­ç»ƒæ¨¡å‹ç›´æ¥é¢„æµ‹ |47.50%|

#### 4.3.2 é¢„è®­ç»ƒæ¨¡å‹ç›´æ¥finetune

##### ä¿®æ”¹é…ç½®æ–‡ä»¶

æˆ‘ä»¬ä½¿ç”¨configs/det/ch_PP-OCRv3/ch_PP-OCRv3_det_cml.ymlï¼Œä¸»è¦ä¿®æ”¹è®­ç»ƒè½®æ•°å’Œå­¦ä¹ ç‡å‚ç›¸å…³å‚æ•°ï¼Œè®¾ç½®é¢„è®­ç»ƒæ¨¡å‹è·¯å¾„ï¼Œè®¾ç½®æ•°æ®é›†è·¯å¾„ã€‚ å¦å¤–ï¼Œbatch_sizeå¯æ ¹æ®è‡ªå·±æœºå™¨æ˜¾å­˜å¤§å°è¿›è¡Œè°ƒæ•´ã€‚ å…·ä½“ä¿®æ”¹å¦‚ä¸‹å‡ ä¸ªåœ°æ–¹ï¼š

```yaml linenums="1"
epoch:100
save_epoch_step:10
eval_batch_step:[0, 50]
save_model_dir: ./output/ch_PP-OCR_v3_det/
pretrained_model: ./pretrained_models/ch_PP-OCRv3_det_distill_train/best_accuracy
learning_rate: 0.00025
num_workers: 0 # å¦‚æœå•å¡è®­ç»ƒï¼Œå»ºè®®å°†Trainå’ŒEvalçš„loaderéƒ¨åˆ†çš„num_workersè®¾ç½®ä¸º0ï¼Œå¦åˆ™ä¼šå‡ºç°`/dev/shm insufficient`çš„æŠ¥é”™
```

##### å¼€å§‹è®­ç»ƒ

ä½¿ç”¨æˆ‘ä»¬ä¸Šé¢ä¿®æ”¹çš„é…ç½®æ–‡ä»¶configs/det/ch_PP-OCRv3/ch_PP-OCRv3_det_cml.ymlï¼Œè®­ç»ƒå‘½ä»¤å¦‚ä¸‹ï¼š

```bash linenums="1"
# å¼€å§‹è®­ç»ƒæ¨¡å‹
python tools/train.py -c configs/det/ch_PP-OCRv3/ch_PP-OCRv3_det_cml.yml -o Global.pretrained_model=./pretrained_models/ch_PP-OCRv3_det_distill_train/best_accuracy
```

è¯„ä¼°è®­ç»ƒå¥½çš„æ¨¡å‹ï¼š

```bash linenums="1"
# è¯„ä¼°è®­ç»ƒå¥½çš„æ¨¡å‹
python tools/eval.py -c configs/det/ch_PP-OCRv3/ch_PP-OCRv3_det_cml.yml -o Global.pretrained_model="./output/ch_PP-OCR_v3_det/best_accuracy"
```

ç»“æœå¦‚ä¸‹ï¼š

|   | æ–¹æ¡ˆ                        |hmeans|
|---|---------------------------|---|
| 0 | PP-OCRv3ä¸­è‹±æ–‡è¶…è½»é‡æ£€æµ‹é¢„è®­ç»ƒæ¨¡å‹ç›´æ¥é¢„æµ‹ |47.50%|
| 1 | PP-OCRv3ä¸­è‹±æ–‡è¶…è½»é‡æ£€æµ‹é¢„è®­ç»ƒæ¨¡å‹fintune |65.20%|

#### 4.3.3 åŸºäºé¢„è®­ç»ƒæ¨¡å‹Finetune_studentæ¨¡å‹

æˆ‘ä»¬ä½¿ç”¨configs/det/ch_PP-OCRv3/ch_PP-OCRv3_det_student.ymlï¼Œä¸»è¦ä¿®æ”¹è®­ç»ƒè½®æ•°å’Œå­¦ä¹ ç‡å‚ç›¸å…³å‚æ•°ï¼Œè®¾ç½®é¢„è®­ç»ƒæ¨¡å‹è·¯å¾„ï¼Œè®¾ç½®æ•°æ®é›†è·¯å¾„ã€‚ å¦å¤–ï¼Œbatch_sizeå¯æ ¹æ®è‡ªå·±æœºå™¨æ˜¾å­˜å¤§å°è¿›è¡Œè°ƒæ•´ã€‚ å…·ä½“ä¿®æ”¹å¦‚ä¸‹å‡ ä¸ªåœ°æ–¹ï¼š

```yaml linenums="1"
epoch:100
save_epoch_step:10
eval_batch_step:[0, 50]
save_model_dir: ./output/ch_PP-OCR_v3_det_student/
pretrained_model: ./pretrained_models/ch_PP-OCRv3_det_distill_train/student
learning_rate: 0.00025
num_workers: 0 # å¦‚æœå•å¡è®­ç»ƒï¼Œå»ºè®®å°†Trainå’ŒEvalçš„loaderéƒ¨åˆ†çš„num_workersè®¾ç½®ä¸º0ï¼Œå¦åˆ™ä¼šå‡ºç°`/dev/shm insufficient`çš„æŠ¥é”™
```

è®­ç»ƒå‘½ä»¤å¦‚ä¸‹ï¼š

```bash linenums="1"
python tools/train.py -c configs/det/ch_PP-OCRv3/ch_PP-OCRv3_det_student.yml -o Global.pretrained_model=./pretrained_models/ch_PP-OCRv3_det_distill_train/student
```

è¯„ä¼°è®­ç»ƒå¥½çš„æ¨¡å‹ï¼š

```bash linenums="1"
# è¯„ä¼°è®­ç»ƒå¥½çš„æ¨¡å‹
python tools/eval.py -c configs/det/ch_PP-OCRv3/ch_PP-OCRv3_det_student.yml -o Global.pretrained_model="./output/ch_PP-OCR_v3_det_student/best_accuracy"
```

ç»“æœå¦‚ä¸‹ï¼š

|   | æ–¹æ¡ˆ                        |hmeans|
|---|---------------------------|---|
| 0 | PP-OCRv3ä¸­è‹±æ–‡è¶…è½»é‡æ£€æµ‹é¢„è®­ç»ƒæ¨¡å‹ç›´æ¥é¢„æµ‹ |47.50%|
| 1 | PP-OCRv3ä¸­è‹±æ–‡è¶…è½»é‡æ£€æµ‹é¢„è®­ç»ƒæ¨¡å‹fintune |65.20%|
| 2 | PP-OCRv3ä¸­è‹±æ–‡è¶…è½»é‡æ£€æµ‹é¢„è®­ç»ƒæ¨¡å‹fintuneå­¦ç”Ÿæ¨¡å‹ |80.00%|

#### 4.3.4 åŸºäºé¢„è®­ç»ƒæ¨¡å‹Finetune_teacheræ¨¡å‹

é¦–å…ˆéœ€è¦ä»æä¾›çš„é¢„è®­ç»ƒæ¨¡å‹best_accuracy.pdparamsä¸­æå–teacherå‚æ•°ï¼Œç»„åˆæˆé€‚åˆdmlè®­ç»ƒçš„åˆå§‹åŒ–æ¨¡å‹ï¼Œæå–ä»£ç å¦‚ä¸‹ï¼š

```python linenums="1"
cd ./pretrained_models/
# transform teacher params in best_accuracy.pdparams into teacher_dml.pdparams
import paddle

# load pretrained model
all_params = paddle.load("ch_PP-OCRv3_det_distill_train/best_accuracy.pdparams")
# print(all_params.keys())

# keep teacher params
t_params = {key[len("Teacher."):]: all_params[key] for key in all_params if "Teacher." in key}

# print(t_params.keys())

s_params = {"Student." + key: t_params[key] for key in t_params}
s2_params = {"Student2." + key: t_params[key] for key in t_params}
s_params = {**s_params, **s2_params}
# print(s_params.keys())

paddle.save(s_params, "ch_PP-OCRv3_det_distill_train/teacher_dml.pdparams")

```

æˆ‘ä»¬ä½¿ç”¨configs/det/ch_PP-OCRv3/ch_PP-OCRv3_det_dml.ymlï¼Œä¸»è¦ä¿®æ”¹è®­ç»ƒè½®æ•°å’Œå­¦ä¹ ç‡å‚ç›¸å…³å‚æ•°ï¼Œè®¾ç½®é¢„è®­ç»ƒæ¨¡å‹è·¯å¾„ï¼Œè®¾ç½®æ•°æ®é›†è·¯å¾„ã€‚ å¦å¤–ï¼Œbatch_sizeå¯æ ¹æ®è‡ªå·±æœºå™¨æ˜¾å­˜å¤§å°è¿›è¡Œè°ƒæ•´ã€‚ å…·ä½“ä¿®æ”¹å¦‚ä¸‹å‡ ä¸ªåœ°æ–¹ï¼š

```yaml linenums="1"
epoch:100
save_epoch_step:10
eval_batch_step:[0, 50]
save_model_dir: ./output/ch_PP-OCR_v3_det_teacher/
pretrained_model: ./pretrained_models/ch_PP-OCRv3_det_distill_train/teacher_dml
learning_rate: 0.00025
num_workers: 0 # å¦‚æœå•å¡è®­ç»ƒï¼Œå»ºè®®å°†Trainå’ŒEvalçš„loaderéƒ¨åˆ†çš„num_workersè®¾ç½®ä¸º0ï¼Œå¦åˆ™ä¼šå‡ºç°`/dev/shm insufficient`çš„æŠ¥é”™
```

è®­ç»ƒå‘½ä»¤å¦‚ä¸‹ï¼š

```bash linenums="1"
python tools/train.py -c configs/det/ch_PP-OCRv3/ch_PP-OCRv3_det_dml.yml -o Global.pretrained_model=./pretrained_models/ch_PP-OCRv3_det_distill_train/teacher_dml
```

è¯„ä¼°è®­ç»ƒå¥½çš„æ¨¡å‹ï¼š

```bash linenums="1"
# è¯„ä¼°è®­ç»ƒå¥½çš„æ¨¡å‹
python tools/eval.py -c configs/det/ch_PP-OCRv3/ch_PP-OCRv3_det_dml.yml -o Global.pretrained_model="./output/ch_PP-OCR_v3_det_teacher/best_accuracy"
```

ç»“æœå¦‚ä¸‹ï¼š

|   | æ–¹æ¡ˆ                        |hmeans|
|---|---------------------------|---|
| 0 | PP-OCRv3ä¸­è‹±æ–‡è¶…è½»é‡æ£€æµ‹é¢„è®­ç»ƒæ¨¡å‹ç›´æ¥é¢„æµ‹ |47.50%|
| 1 | PP-OCRv3ä¸­è‹±æ–‡è¶…è½»é‡æ£€æµ‹é¢„è®­ç»ƒæ¨¡å‹fintune |65.20%|
| 2 | PP-OCRv3ä¸­è‹±æ–‡è¶…è½»é‡æ£€æµ‹é¢„è®­ç»ƒæ¨¡å‹fintuneå­¦ç”Ÿæ¨¡å‹ |80.00%|
| 3 | PP-OCRv3ä¸­è‹±æ–‡è¶…è½»é‡æ£€æµ‹é¢„è®­ç»ƒæ¨¡å‹fintuneæ•™å¸ˆæ¨¡å‹ |84.80%|

#### 4.3.5 é‡‡ç”¨CMLè’¸é¦è¿›ä¸€æ­¥æå‡studentæ¨¡å‹ç²¾åº¦

éœ€è¦ä»4.3.3å’Œ4.3.4è®­ç»ƒå¾—åˆ°çš„best_accuracy.pdparamsä¸­æå–å„è‡ªä»£è¡¨studentå’Œteacherçš„å‚æ•°ï¼Œç»„åˆæˆé€‚åˆcmlè®­ç»ƒçš„åˆå§‹åŒ–æ¨¡å‹ï¼Œæå–ä»£ç å¦‚ä¸‹ï¼š

```python linenums="1"
# transform teacher params and student parameters into cml model
import paddle

all_params = paddle.load("./pretrained_models/ch_PP-OCRv3_det_distill_train/best_accuracy.pdparams")
# print(all_params.keys())

t_params = paddle.load("./output/ch_PP-OCR_v3_det_teacher/best_accuracy.pdparams")
# print(t_params.keys())

s_params = paddle.load("./output/ch_PP-OCR_v3_det_student/best_accuracy.pdparams")
# print(s_params.keys())

for key in all_params:
    # teacher is OK
    if "Teacher." in key:
        new_key = key.replace("Teacher", "Student")
        #print("{} >> {}\n".format(key, new_key))
        assert all_params[key].shape == t_params[new_key].shape
        all_params[key] = t_params[new_key]

    if "Student." in key:
        new_key = key.replace("Student.", "")
        #print("{} >> {}\n".format(key, new_key))
        assert all_params[key].shape == s_params[new_key].shape
        all_params[key] = s_params[new_key]

    if "Student2." in key:
        new_key = key.replace("Student2.", "")
        print("{} >> {}\n".format(key, new_key))
        assert all_params[key].shape == s_params[new_key].shape
        all_params[key] = s_params[new_key]

paddle.save(all_params, "./pretrained_models/ch_PP-OCRv3_det_distill_train/teacher_cml_student.pdparams")
```

è®­ç»ƒå‘½ä»¤å¦‚ä¸‹ï¼š

```bash linenums="1"
python tools/train.py -c configs/det/ch_PP-OCRv3/ch_PP-OCRv3_det_cml.yml -o Global.pretrained_model=./pretrained_models/ch_PP-OCRv3_det_distill_train/teacher_cml_student Global.save_model_dir=./output/ch_PP-OCR_v3_det_finetune/
```

è¯„ä¼°è®­ç»ƒå¥½çš„æ¨¡å‹ï¼š

```bash linenums="1"
# è¯„ä¼°è®­ç»ƒå¥½çš„æ¨¡å‹
python tools/eval.py -c configs/det/ch_PP-OCRv3/ch_PP-OCRv3_det_cml.yml -o Global.pretrained_model="./output/ch_PP-OCR_v3_det_finetune/best_accuracy"
```

ç»“æœå¦‚ä¸‹ï¼š

|   | æ–¹æ¡ˆ                        |hmeans|
|---|---------------------------|---|
| 0 | PP-OCRv3ä¸­è‹±æ–‡è¶…è½»é‡æ£€æµ‹é¢„è®­ç»ƒæ¨¡å‹ç›´æ¥é¢„æµ‹ |47.50%|
| 1 | PP-OCRv3ä¸­è‹±æ–‡è¶…è½»é‡æ£€æµ‹é¢„è®­ç»ƒæ¨¡å‹fintune |65.20%|
| 2 | PP-OCRv3ä¸­è‹±æ–‡è¶…è½»é‡æ£€æµ‹é¢„è®­ç»ƒæ¨¡å‹fintuneå­¦ç”Ÿæ¨¡å‹ |80.00%|
| 3 | PP-OCRv3ä¸­è‹±æ–‡è¶…è½»é‡æ£€æµ‹é¢„è®­ç»ƒæ¨¡å‹fintuneæ•™å¸ˆæ¨¡å‹ |84.80%|
| 4 | åŸºäº2å’Œ3è®­ç»ƒå¥½çš„æ¨¡å‹fintune |82.70%|

å°†è®­ç»ƒå®Œæˆçš„æ¨¡å‹æ”¾ç½®åœ¨å¯¹åº”ç›®å½•ä¸‹å³å¯å®Œæˆæ¨¡å‹æ¨ç†

#### 4.3.6 æ¨¡å‹å¯¼å‡ºæ¨ç†

è®­ç»ƒå®Œæˆåï¼Œå¯ä»¥å°†è®­ç»ƒæ¨¡å‹è½¬æ¢æˆinferenceæ¨¡å‹ã€‚inference æ¨¡å‹ä¼šé¢å¤–ä¿å­˜æ¨¡å‹çš„ç»“æ„ä¿¡æ¯ï¼Œåœ¨é¢„æµ‹éƒ¨ç½²ã€åŠ é€Ÿæ¨ç†ä¸Šæ€§èƒ½ä¼˜è¶Šï¼Œçµæ´»æ–¹ä¾¿ï¼Œé€‚åˆäºå®é™…ç³»ç»Ÿé›†æˆã€‚

##### 4.3.6.1 æ¨¡å‹å¯¼å‡º

å¯¼å‡ºå‘½ä»¤å¦‚ä¸‹ï¼š

```bash linenums="1"
# è½¬åŒ–ä¸ºæ¨ç†æ¨¡å‹
python tools/export_model.py \
-c configs/det/ch_PP-OCRv3/ch_PP-OCRv3_det_cml.yml \
-o Global.pretrained_model=./output/ch_PP-OCR_v3_det_finetune/best_accuracy \
-o Global.save_inference_dir="./inference/det_ppocrv3"

```

##### 4.3.6.2 æ¨¡å‹æ¨ç†

å¯¼å‡ºæ¨¡å‹åï¼Œå¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤è¿›è¡Œæ¨ç†é¢„æµ‹ï¼š

```bash linenums="1"
# æ¨ç†é¢„æµ‹
python tools/infer/predict_det.py --image_dir="train_data/icdar2015/text_localization/test/1.jpg" --det_model_dir="./inference/det_ppocrv3/Student"
```

## 5. æ–‡å­—è¯†åˆ«

æ–‡æœ¬è¯†åˆ«çš„ä»»åŠ¡æ˜¯è¯†åˆ«å‡ºå›¾åƒä¸­çš„æ–‡å­—å†…å®¹ï¼Œä¸€èˆ¬è¾“å…¥æ¥è‡ªäºæ–‡æœ¬æ£€æµ‹å¾—åˆ°çš„æ–‡æœ¬æ¡†æˆªå–å‡ºçš„å›¾åƒæ–‡å­—åŒºåŸŸã€‚æ–‡æœ¬è¯†åˆ«ä¸€èˆ¬å¯ä»¥æ ¹æ®å¾…è¯†åˆ«æ–‡æœ¬å½¢çŠ¶åˆ†ä¸ºè§„åˆ™æ–‡æœ¬è¯†åˆ«å’Œä¸è§„åˆ™æ–‡æœ¬è¯†åˆ«ä¸¤å¤§ç±»ã€‚è§„åˆ™æ–‡æœ¬ä¸»è¦æŒ‡å°åˆ·å­—ä½“ã€æ‰«ææ–‡æœ¬ç­‰ï¼Œæ–‡æœ¬å¤§è‡´å¤„åœ¨æ°´å¹³çº¿ä½ç½®ï¼›ä¸è§„åˆ™æ–‡æœ¬å¾€å¾€ä¸åœ¨æ°´å¹³ä½ç½®ï¼Œå­˜åœ¨å¼¯æ›²ã€é®æŒ¡ã€æ¨¡ç³Šç­‰é—®é¢˜ã€‚ä¸è§„åˆ™æ–‡æœ¬åœºæ™¯å…·æœ‰å¾ˆå¤§çš„æŒ‘æˆ˜æ€§ï¼Œä¹Ÿæ˜¯ç›®å‰æ–‡æœ¬è¯†åˆ«é¢†åŸŸçš„ä¸»è¦ç ”ç©¶æ–¹å‘ã€‚æœ¬é¡¹ç›®åŸºäºPP-OCRv3ç®—æ³•è¿›è¡Œä¼˜åŒ–ã€‚

### 5.1 PP-OCRv3è¯†åˆ«ç®—æ³•ä»‹ç»

PP-OCRv3çš„è¯†åˆ«æ¨¡å—æ˜¯åŸºäºæ–‡æœ¬è¯†åˆ«ç®—æ³•[SVTR](https://arxiv.org/abs/2205.00159)ä¼˜åŒ–ã€‚SVTRä¸å†é‡‡ç”¨RNNç»“æ„ï¼Œé€šè¿‡å¼•å…¥Transformersç»“æ„æ›´åŠ æœ‰æ•ˆåœ°æŒ–æ˜æ–‡æœ¬è¡Œå›¾åƒçš„ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œä»è€Œæå‡æ–‡æœ¬è¯†åˆ«èƒ½åŠ›ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼ŒPP-OCRv3é‡‡ç”¨äº†6ä¸ªä¼˜åŒ–ç­–ç•¥ã€‚
![](./images/d4f5344b5b854d50be738671598a89a45689c6704c4d481fb904dd7cf72f2a1a.png)

ä¼˜åŒ–ç­–ç•¥æ±‡æ€»å¦‚ä¸‹ï¼š

- SVTR_LCNetï¼šè½»é‡çº§æ–‡æœ¬è¯†åˆ«ç½‘ç»œ
- GTCï¼šAttentionæŒ‡å¯¼CTCè®­ç»ƒç­–ç•¥
- TextConAugï¼šæŒ–æ˜æ–‡å­—ä¸Šä¸‹æ–‡ä¿¡æ¯çš„æ•°æ®å¢å¹¿ç­–ç•¥
- TextRotNetï¼šè‡ªç›‘ç£çš„é¢„è®­ç»ƒæ¨¡å‹
- UDMLï¼šè”åˆäº’å­¦ä¹ ç­–ç•¥
- UIMï¼šæ— æ ‡æ³¨æ•°æ®æŒ–æ˜æ–¹æ¡ˆ

è¯¦ç»†ä¼˜åŒ–ç­–ç•¥æè¿°è¯·å‚è€ƒ[PP-OCRv3ä¼˜åŒ–ç­–ç•¥](../ppocr/blog/PP-OCRv3_introduction.md#3-è¯†åˆ«ä¼˜åŒ–)

### 5.2 æ•°æ®å‡†å¤‡

[è®¡é‡è®¾å¤‡å±å¹•å­—ç¬¦è¯†åˆ«æ•°æ®é›†](https://aistudio.baidu.com/aistudio/datasetdetail/128714)æ•°æ®æ¥æºäºå®é™…é¡¹ç›®ä¸­å„ç§è®¡é‡è®¾å¤‡çš„æ•°æ˜¾å±ï¼Œä»¥åŠåœ¨ç½‘ä¸Šæœé›†çš„ä¸€äº›å…¶ä»–æ•°æ˜¾å±ï¼ŒåŒ…å«è®­ç»ƒé›†19912å¼ ï¼Œæµ‹è¯•é›†4099å¼ ã€‚

```bash linenums="1"
# è§£å‹ä¸‹è½½çš„æ•°æ®é›†åˆ°æŒ‡å®šè·¯å¾„ä¸‹
unzip ic15_data.zip -d train_data
```

```python linenums="1"
# éšæœºæŸ¥çœ‹æ–‡å­—æ£€æµ‹æ•°æ®é›†å›¾ç‰‡
from PIL import Image
import matplotlib.pyplot as plt
import numpy as np
import os

train = './train_data/ic15_data/train'
# ä»æŒ‡å®šç›®å½•ä¸­é€‰å–ä¸€å¼ å›¾ç‰‡
def get_one_image(train):
    plt.figure()
    files = os.listdir(train)
    n = len(files)
    ind = np.random.randint(0,n)
    img_dir = os.path.join(train,files[ind])
    image = Image.open(img_dir)
    plt.imshow(image)
    plt.show()
    image = image.resize([208, 208])

get_one_image(train)
```

![rec_png](./images/3de0d475c69746d0a184029001ef07c85fd68816d66d4beaa10e6ef60030f9b4.jpeg)

### 5.3 æ¨¡å‹è®­ç»ƒ

#### ä¸‹è½½é¢„è®­ç»ƒæ¨¡å‹

ä¸‹è½½æˆ‘ä»¬éœ€è¦çš„PP-OCRv3è¯†åˆ«é¢„è®­ç»ƒæ¨¡å‹ï¼Œæ›´å¤šé€‰æ‹©è¯·è‡ªè¡Œé€‰æ‹©å…¶ä»–çš„[æ–‡å­—è¯†åˆ«æ¨¡å‹](../ppocr/model_list.md#2-æ–‡æœ¬è¯†åˆ«æ¨¡å‹)

```bash linenums="1"
# ä½¿ç”¨è¯¥æŒ‡ä»¤ä¸‹è½½éœ€è¦çš„é¢„è®­ç»ƒæ¨¡å‹
wget -P ./pretrained_models/ https://paddleocr.bj.bcebos.com/PP-OCRv3/chinese/ch_PP-OCRv3_rec_train.tar
# è§£å‹é¢„è®­ç»ƒæ¨¡å‹æ–‡ä»¶
tar -xf ./pretrained_models/ch_PP-OCRv3_rec_train.tar -C pretrained_models
```

#### ä¿®æ”¹é…ç½®æ–‡ä»¶

æˆ‘ä»¬ä½¿ç”¨configs/rec/PP-OCRv3/ch_PP-OCRv3_rec_distillation.ymlï¼Œä¸»è¦ä¿®æ”¹è®­ç»ƒè½®æ•°å’Œå­¦ä¹ ç‡å‚ç›¸å…³å‚æ•°ï¼Œè®¾ç½®é¢„è®­ç»ƒæ¨¡å‹è·¯å¾„ï¼Œè®¾ç½®æ•°æ®é›†è·¯å¾„ã€‚ å¦å¤–ï¼Œbatch_sizeå¯æ ¹æ®è‡ªå·±æœºå™¨æ˜¾å­˜å¤§å°è¿›è¡Œè°ƒæ•´ã€‚ å…·ä½“ä¿®æ”¹å¦‚ä¸‹å‡ ä¸ªåœ°æ–¹ï¼š

```yaml linenums="1"
  epoch_num: 100 # è®­ç»ƒepochæ•°
  save_model_dir: ./output/ch_PP-OCR_v3_rec
  save_epoch_step: 10
  eval_batch_step: [0, 100] # è¯„ä¼°é—´éš”ï¼Œæ¯éš”100stepè¯„ä¼°ä¸€æ¬¡
  cal_metric_during_train: true
  pretrained_model: ./pretrained_models/ch_PP-OCRv3_rec_train/best_accuracy  # é¢„è®­ç»ƒæ¨¡å‹è·¯å¾„
  character_dict_path: ppocr/utils/ppocr_keys_v1.txt
  use_space_char: true  # ä½¿ç”¨ç©ºæ ¼

  lr:
    name: Cosine # ä¿®æ”¹å­¦ä¹ ç‡è¡°å‡ç­–ç•¥ä¸ºCosine
    learning_rate: 0.0002 # ä¿®æ”¹fine-tuneçš„å­¦ä¹ ç‡
    warmup_epoch: 2 # ä¿®æ”¹warmupè½®æ•°

Train:
  dataset:
    name: SimpleDataSet
    data_dir: ./train_data/ic15_data/ # è®­ç»ƒé›†å›¾ç‰‡è·¯å¾„
    ext_op_transform_idx: 1
    label_file_list:
    - ./train_data/ic15_data/rec_gt_train.txt # è®­ç»ƒé›†æ ‡ç­¾
    ratio_list:
    - 1.0
  loader:
    shuffle: true
    batch_size_per_card: 64
    drop_last: true
    num_workers: 4
Eval:
  dataset:
    name: SimpleDataSet
    data_dir: ./train_data/ic15_data/ # æµ‹è¯•é›†å›¾ç‰‡è·¯å¾„
    label_file_list:
    - ./train_data/ic15_data/rec_gt_test.txt # æµ‹è¯•é›†æ ‡ç­¾
    ratio_list:
    - 1.0
  loader:
    shuffle: false
    drop_last: false
    batch_size_per_card: 64
    num_workers: 4
```

åœ¨è®­ç»ƒä¹‹å‰ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨ä¸‹é¢å‘½ä»¤æ¥è¯„ä¼°é¢„è®­ç»ƒæ¨¡å‹çš„æ•ˆæœ:

```bash linenums="1"
# è¯„ä¼°é¢„è®­ç»ƒæ¨¡å‹
python tools/eval.py -c configs/rec/PP-OCRv3/ch_PP-OCRv3_rec_distillation.yml -o Global.pretrained_model="./pretrained_models/ch_PP-OCRv3_rec_train/best_accuracy"
```

ç»“æœå¦‚ä¸‹ï¼š

|   | æ–¹æ¡ˆ                        |accuracy|
|---|---------------------------|---|
| 0 | PP-OCRv3ä¸­è‹±æ–‡è¶…è½»é‡è¯†åˆ«é¢„è®­ç»ƒæ¨¡å‹ç›´æ¥é¢„æµ‹ |70.40%|

#### å¼€å§‹è®­ç»ƒ

æˆ‘ä»¬ä½¿ç”¨ä¸Šé¢ä¿®æ”¹å¥½çš„é…ç½®æ–‡ä»¶configs/rec/PP-OCRv3/ch_PP-OCRv3_rec_distillation.ymlï¼Œé¢„è®­ç»ƒæ¨¡å‹ï¼Œæ•°æ®é›†è·¯å¾„ï¼Œå­¦ä¹ ç‡ï¼Œè®­ç»ƒè½®æ•°ç­‰éƒ½å·²ç»è®¾ç½®å®Œæ¯•åï¼Œå¯ä»¥ä½¿ç”¨ä¸‹é¢å‘½ä»¤å¼€å§‹è®­ç»ƒã€‚

```bash linenums="1"
# å¼€å§‹è®­ç»ƒè¯†åˆ«æ¨¡å‹
python tools/train.py -c configs/rec/PP-OCRv3/ch_PP-OCRv3_rec_distillation.yml
```

è®­ç»ƒå®Œæˆåï¼Œå¯ä»¥å¯¹è®­ç»ƒæ¨¡å‹ä¸­æœ€å¥½çš„è¿›è¡Œæµ‹è¯•ï¼Œè¯„ä¼°å‘½ä»¤å¦‚ä¸‹ï¼š

```bash linenums="1"
# è¯„ä¼°finetuneæ•ˆæœ
python tools/eval.py -c configs/rec/PP-OCRv3/ch_PP-OCRv3_rec_distillation.yml -o Global.checkpoints="./output/ch_PP-OCR_v3_rec/best_accuracy"
```

ç»“æœå¦‚ä¸‹ï¼š

|   | æ–¹æ¡ˆ                        |accuracy|
|---|---------------------------|---|
| 0 | PP-OCRv3ä¸­è‹±æ–‡è¶…è½»é‡è¯†åˆ«é¢„è®­ç»ƒæ¨¡å‹ç›´æ¥é¢„æµ‹ |70.40%|
| 1 | PP-OCRv3ä¸­è‹±æ–‡è¶…è½»é‡è¯†åˆ«é¢„è®­ç»ƒæ¨¡å‹finetune |82.20%|

å¦‚éœ€è·å–å·²è®­ç»ƒæ¨¡å‹ï¼Œè¯·æ‰«ç å¡«å†™é—®å·ï¼ŒåŠ å…¥PaddleOCRå®˜æ–¹äº¤æµç¾¤è·å–å…¨éƒ¨OCRå‚ç±»æ¨¡å‹ä¸‹è½½é“¾æ¥ã€ã€ŠåŠ¨æ‰‹å­¦OCRã€‹ç”µå­ä¹¦ç­‰å…¨å¥—OCRå­¦ä¹ èµ„æ–™ğŸ

<img src="./images/dd721099bd50478f9d5fb13d8dd00fad69c22d6848244fd3a1d3980d7fefc63e.jpeg" style="zoom: 25%;" />

å°†ä¸‹è½½æˆ–è®­ç»ƒå®Œæˆçš„æ¨¡å‹æ”¾ç½®åœ¨å¯¹åº”ç›®å½•ä¸‹å³å¯å®Œæˆæ¨¡å‹æ¨ç†ã€‚

### 5.4 æ¨¡å‹å¯¼å‡ºæ¨ç†

è®­ç»ƒå®Œæˆåï¼Œå¯ä»¥å°†è®­ç»ƒæ¨¡å‹è½¬æ¢æˆinferenceæ¨¡å‹ã€‚inference æ¨¡å‹ä¼šé¢å¤–ä¿å­˜æ¨¡å‹çš„ç»“æ„ä¿¡æ¯ï¼Œåœ¨é¢„æµ‹éƒ¨ç½²ã€åŠ é€Ÿæ¨ç†ä¸Šæ€§èƒ½ä¼˜è¶Šï¼Œçµæ´»æ–¹ä¾¿ï¼Œé€‚åˆäºå®é™…ç³»ç»Ÿé›†æˆã€‚

#### æ¨¡å‹å¯¼å‡º

å¯¼å‡ºå‘½ä»¤å¦‚ä¸‹ï¼š

```bash linenums="1"
# è½¬åŒ–ä¸ºæ¨ç†æ¨¡å‹
python tools/export_model.py -c configs/rec/PP-OCRv3/ch_PP-OCRv3_rec_distillation.yml -o Global.pretrained_model="./output/ch_PP-OCR_v3_rec/best_accuracy" Global.save_inference_dir="./inference/rec_ppocrv3/"
```

#### æ¨¡å‹æ¨ç†

å¯¼å‡ºæ¨¡å‹åï¼Œå¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤è¿›è¡Œæ¨ç†é¢„æµ‹

```bash linenums="1"
# æ¨ç†é¢„æµ‹
python tools/infer/predict_rec.py --image_dir="train_data/ic15_data/test/1_crop_0.jpg" --rec_model_dir="./inference/rec_ppocrv3/Student"
```

## 6. ç³»ç»Ÿä¸²è”

æˆ‘ä»¬å°†ä¸Šé¢è®­ç»ƒå¥½çš„æ£€æµ‹å’Œè¯†åˆ«æ¨¡å‹è¿›è¡Œç³»ç»Ÿä¸²è”æµ‹è¯•ï¼Œå‘½ä»¤å¦‚ä¸‹ï¼š

```bash linenums="1"
#ä¸²è”æµ‹è¯•
python3 tools/infer/predict_system.py --image_dir="./train_data/icdar2015/text_localization/test/142.jpg" --det_model_dir="./inference/det_ppocrv3/Student"  --rec_model_dir="./inference/rec_ppocrv3/Student"
```

æµ‹è¯•ç»“æœä¿å­˜åœ¨`./inference_results/`ç›®å½•ä¸‹ï¼Œå¯ä»¥ç”¨ä¸‹é¢ä»£ç è¿›è¡Œå¯è§†åŒ–

```bash linenums="1"
%cd /home/aistudio/PaddleOCR
# æ˜¾ç¤ºç»“æœ
import matplotlib.pyplot as plt
from PIL import Image
img_path= "./inference_results/142.jpg"
img = Image.open(img_path)
plt.figure("test_img", figsize=(30,30))
plt.imshow(img)
plt.show()
```

![sys_res_png](./images/901ab741cb46441ebec510b37e63b9d8d1b7c95f63cc4e5e8757f35179ae6373-20240704185855034.png)

### 6.1 åå¤„ç†

å¦‚æœéœ€è¦è·å–key-valueä¿¡æ¯ï¼Œå¯ä»¥åŸºäºå¯å‘å¼çš„è§„åˆ™ï¼Œå°†è¯†åˆ«ç»“æœä¸å…³é”®å­—åº“è¿›è¡ŒåŒ¹é…ï¼›å¦‚æœåŒ¹é…ä¸Šäº†ï¼Œåˆ™å–è¯¥å­—æ®µä¸ºkey, åé¢ä¸€ä¸ªå­—æ®µä¸ºvalueã€‚

```python linenums="1"
def postprocess(rec_res):
    keys = ["å‹å·", "å‚å®¶", "ç‰ˆæœ¬å·", "æ£€å®šæ ¡å‡†åˆ†ç±»", "è®¡é‡å™¨å…·ç¼–å·", "çƒŸå°˜æµé‡",
            "ç´¯ç§¯ä½“ç§¯", "çƒŸæ°”æ¸©åº¦", "åŠ¨å‹", "é™å‹", "æ—¶é—´", "è¯•éªŒå°ç¼–å·", "é¢„æµ‹æµé€Ÿ",
            "å…¨å‹", "çƒŸæ¸©", "æµé€Ÿ", "å·¥å†µæµé‡", "æ ‡æ†æµé‡", "çƒŸå°˜ç›´è¯»å˜´", "çƒŸå°˜é‡‡æ ·å˜´",
            "å¤§æ°”å‹", "è®¡å‰æ¸©åº¦", "è®¡å‰å‹åŠ›", "å¹²çƒæ¸©åº¦", "æ¹¿çƒæ¸©åº¦", "æµé‡", "å«æ¹¿é‡"]
    key_value = []
    if len(rec_res) > 1:
        for i in range(len(rec_res) - 1):
            rec_str, _ = rec_res[i]
            for key in keys:
                if rec_str in key:
                    key_value.append([rec_str, rec_res[i + 1][0]])
                    break
    return key_value
key_value = postprocess(filter_rec_res)
```

## 7. PaddleServingéƒ¨ç½²

é¦–å…ˆéœ€è¦å®‰è£…PaddleServingéƒ¨ç½²ç›¸å…³çš„ç¯å¢ƒ

```bash linenums="1"
python -m pip install paddle-serving-server-gpu
python -m pip install paddle_serving_client
python -m pip install paddle-serving-app
```

### 7.1 è½¬åŒ–æ£€æµ‹æ¨¡å‹

```bash linenums="1"
cd deploy/pdserving/
python -m paddle_serving_client.convert --dirname ../../inference/det_ppocrv3/Student/  \
                                         --model_filename inference.pdmodel          \
                                         --params_filename inference.pdiparams       \
                                         --serving_server ./ppocr_det_v3_serving/ \
                                         --serving_client ./ppocr_det_v3_client/
```

### 7.2 è½¬åŒ–è¯†åˆ«æ¨¡å‹

```bash linenums="1"
python -m paddle_serving_client.convert --dirname ../../inference/rec_ppocrv3/Student \
                                         --model_filename inference.pdmodel          \
                                         --params_filename inference.pdiparams       \
                                         --serving_server ./ppocr_rec_v3_serving/ \
                                         --serving_client ./ppocr_rec_v3_client/
```

### 7.3 å¯åŠ¨æœåŠ¡

é¦–å…ˆå¯ä»¥å°†åå¤„ç†ä»£ç åŠ å…¥åˆ°web_service.pyä¸­ï¼Œå…·ä½“ä¿®æ”¹å¦‚ä¸‹ï¼š

```python linenums="1"
# ä»£ç 153è¡Œåé¢å¢åŠ ä¸‹é¢ä»£ç 
def _postprocess(rec_res):
    keys = ["å‹å·", "å‚å®¶", "ç‰ˆæœ¬å·", "æ£€å®šæ ¡å‡†åˆ†ç±»", "è®¡é‡å™¨å…·ç¼–å·", "çƒŸå°˜æµé‡",
            "ç´¯ç§¯ä½“ç§¯", "çƒŸæ°”æ¸©åº¦", "åŠ¨å‹", "é™å‹", "æ—¶é—´", "è¯•éªŒå°ç¼–å·", "é¢„æµ‹æµé€Ÿ",
            "å…¨å‹", "çƒŸæ¸©", "æµé€Ÿ", "å·¥å†µæµé‡", "æ ‡æ†æµé‡", "çƒŸå°˜ç›´è¯»å˜´", "çƒŸå°˜é‡‡æ ·å˜´",
            "å¤§æ°”å‹", "è®¡å‰æ¸©åº¦", "è®¡å‰å‹åŠ›", "å¹²çƒæ¸©åº¦", "æ¹¿çƒæ¸©åº¦", "æµé‡", "å«æ¹¿é‡"]
    key_value = []
    if len(rec_res) > 1:
        for i in range(len(rec_res) - 1):
            rec_str, _ = rec_res[i]
            for key in keys:
                if rec_str in key:
                    key_value.append([rec_str, rec_res[i + 1][0]])
                    break
    return key_value
key_value = _postprocess(rec_list)
res = {"result": str(key_value)}
# res = {"result": str(result_list)}
```

å¯åŠ¨æœåŠ¡ç«¯

```bash linenums="1"
python web_service.py 2>&1 >log.txt
```

### 7.4 å‘é€è¯·æ±‚

ç„¶åå†å¼€å¯ä¸€ä¸ªæ–°çš„ç»ˆç«¯ï¼Œè¿è¡Œä¸‹é¢çš„å®¢æˆ·ç«¯ä»£ç 

```bash linenums="1"
python pipeline_http_client.py --image_dir ../../train_data/icdar2015/text_localization/test/142.jpg
```

å¯ä»¥è·å–åˆ°æœ€ç»ˆçš„key-valueç»“æœï¼š

```text linenums="1"
å¤§æ°”å‹, 100.07kPa
å¹²çƒæ¸©åº¦, 0000â„ƒ
è®¡å‰æ¸©åº¦, 0000â„ƒ
æ¹¿çƒæ¸©åº¦, 0000â„ƒ
è®¡å‰å‹åŠ›, -0000kPa
æµé‡, 00.0L/min
é™å‹, 00000kPa
å«æ¹¿é‡, 00.0 %
```
